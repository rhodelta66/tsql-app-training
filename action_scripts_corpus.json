{
    "metadata": {
        "source": "init_full_run",
        "last_updated": "2025-05-24T21:36:44.306457"
    },
    "scripts": [
        {
            "sql_source": "--RH210215 BEZIG DOWNLOAD ALS CSV ER BIJ.. lukt nofg niet..\nDECLARE @date nvarchar(128),@date2 nvarchar(128),@button nvarchar(128),@button2 nvarchar(128),@companyname nvarchar(128), @FileName nvarchar(128)\nset @date = dbo.workDate()\nset @date2 = dbo.workDate()\nSET @companyname = (select CompanyName from xcompany where id = @id)\nset @Filename=concat(@Companyname,'.csv')\n/*EXEC sp_api_modal_text 'Zoek op transport bedrijf'\nEXEC sp_api_modal_input @name='Transporteur',@value = @TransComp OUT,@focus=1,@select=1 -- zoek veld\n*/\nEXEC sp_api_modal_text 'Van:'\nEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-24',@focus=1,@select=1  -- zoek veld\nEXEC sp_api_modal_text 'Tot en met:'\nEXEC sp_api_modal_date @name='Date2',@value = @date2 OUT,@class='w-24' -- zoek veld\n--SET @date2 = CONCAT(@date2,' 23:59:59.999')\nSET @button = 'Intrastat_Melding'\nEXEC sp_api_modal_button @name='button',@value = 'Intrastat_Melding',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nEXEC sp_api_modal_button @name='button',@value = 'Excel_CSV',@valueout = @button OUT,@class = 'btn-primary',@key = 'F5'\nEXEC sp_api_modal_text @companyname,N'h4 text-muted',@printonly=1\nEXEC sp_api_modal_print\n\nIF @button =  'Intrastat_Melding'\nBEGIN\nSELECT distinct [QUANTITY@] = sum(QUANTITY@), [ARTICLE~col-sm-5] = ARTICLE, LAND, INTRASTAT_CODE, [NETT_WEIGHT@] = sum(NETT_WEIGHT@), ISO, [AMOUNT@] = sum(AMOUNT@)\nINTO #Intrastat_Melding\nFROM          RV_INTRASTAT_MELDING\nWHERE\t\t(INTRASTAT_CODE is not NULL) AND (CompanyID = @id) AND (TransactionDate BETWEEN @date AND @date2) AND (THTDT = 2)\nGROUP BY ARTICLE,LAND,INTRASTAT_CODE,ISO\nEXEC sp_api_modal_table @tmptable=N'#Intrastat_Melding',@orderby=N'ORDER BY 2 ASC',@print=1\n\nEND \n\t\n\nIF @button =  'Excel_CSV'\nBEGIN\nSELECT distinct [QUANTITY] = sum(QUANTITY@), [ARTICLE] = ARTICLE, LAND, INTRASTAT_CODE, [NETT_WEIGHT] = sum(NETT_WEIGHT@), ISO, [AMOUNT] = sum(AMOUNT@)\nINTO #Intrastat_CSV\nFROM          RV_INTRASTAT_MELDING\nWHERE\t\t(INTRASTAT_CODE is not NULL) AND (CompanyID = @id) AND (TransactionDate BETWEEN @date AND @date2) AND (THTDT = 2)\nGROUP BY ARTICLE,LAND,INTRASTAT_CODE,ISO\n--EXEC sp_api_modal_table @tmptable=N'#Intrastat_CSV',@print=1\n--EXEC sp_api_modal_csv\t@tmptable = '#Intrastat_CSV'\t,@filename = @filename\t,@sep = ';'\n\n--EXEC sp_api_modal_table @tmptable=N'#Intrastat_CSV'\nEXEC sp_api_modal_csv @tmptable=N'#Intrastat_CSV',@ansi =1,@filename=@FileName\n\nEND \n\n\n\n\n\n\n\n",
            "action_id": 1,
            "action_name": "INTRASTAT_MELDING",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.cthFase @ID, N'closedSaleReadyForInvoice'",
            "action_id": 2,
            "action_name": "klaar voor facturatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.cthFase @ID, N'closedSaleReadyForInvoice'",
            "action_id": 3,
            "action_name": "klaar voor facturatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @MES NVARCHAR(200)\r\nSET @MES=concat(N'Verloop van de koers ',{[currency].CodeISO})\r\nif @MES IS NULL SET @MES=concat(N'Verloop van de waarde ''',{[xvalrate].code},''' voor ',(select companyname from xCompany where id={[xvalrate].contextID}))\r\nEXEC sp_api_modal_text @text = @MES,@class = 'h3 text-muted'\r\nSELECT TOP 100 code as [code*],startdate, enddate,f as [koers] INTO #table1 FROM xValrate where code={[xvalrate].code} and contextID={[xvalrate].contextID}\r\nEXEC sp_api_modal_table @tmptable=N'#table1'\r\n",
            "action_id": 4,
            "action_name": "koerslijst",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.[dbo].[Create_CTR_ForOwnNegativeStock] @ID",
            "action_id": 5,
            "action_name": "Koop alles (neg)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @clone_id INT, @sure nvarchar(255), @text nvarchar(255)\r\nEXEC sp_api_modal_get N'my_last_clone_id',@text OUT\r\nEXEC sp_api_modal_text @text,'h1'\r\nEXEC sp_api_modal_text @basetable,'h1'\r\nEXEC sp_api_modal_button @name='Sure',@value = 'Clone? (Esc=Nee)', @valueout = @sure OUT,@class='btn-danger',@key='Enter'\r\nIF @sure is not null\r\n\tBEGIN\r\n\t\tEXEC sp_api_modal_clear\r\n\t\t--EXEC @clone_id = sp_clone_record @basetable,@ids\r\n\t\tEXEC @clone_id = sp_clone_record @basetable,@ids,N'size=''EDIT'', stock=0'\r\n\t\tSET @path = @path+'/'+dbo.nv(@clone_id)\r\n\t\tEXEC sp_api_toast @text = N'Record cloned'\r\n\t\tEXEC sp_api_modal_route @name = N'Ga met Enter naar de kopie en vul de nieuwe maat in',@pathname=@path,@search='?focus=7377' ,@class = N'btn-danger' ,@key='Enter'\r\n\tEND\r\n",
            "action_id": 6,
            "action_name": "kopieer-artikel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @clone_id INT, @sure nvarchar(255), @text nvarchar(255),@size nvarchar(255)\nEXEC sp_api_modal_get N'my_last_clone_id',@text OUT\nEXEC sp_api_modal_text @text,'h1'\nEXEC sp_api_modal_text @basetable,'h1'\nEXEC sp_api_modal_input @name='Size',@max=20, @value= @size OUT,@focus=1,@select=1\nEXEC sp_api_modal_button @name='Sure',@value = 'Clone? (Esc=Nee)', @valueout = @sure OUT,@class='btn-danger',@key='Enter'\nIF @sure is not null\n\tBEGIN\n\t\tEXEC sp_api_modal_clear\n\t\t--EXEC @clone_id = sp_clone_record @basetable,@ids\n\t\tEXEC @clone_id = sp_clone_record @basetable,@ids,N'size=''EDIT'', stock=0'\n\t\tSET @path = @path+'/'+dbo.nv(@clone_id)\n\t\tUPDATE xstock SET Size = @size WHERE id = @clone_id\n\t\tEXEC sp_api_toast @text = N'Record cloned'\n\t\tEXEC sp_api_modal_route @name = N'Ga met Enter naar de kopie en vul de nieuwe maat in',@pathname=@path,@search='?focus=7377' ,@class = N'btn-danger' ,@key='Enter'\n\tEND\n",
            "action_id": 7,
            "action_name": "kopieer-artikel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "coretype in ('CRATE','PALLET') ",
            "action_id": 9,
            "action_name": "Leeg Fust",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "coretype in ('CRATE','PALLET') ",
            "action_id": 10,
            "action_name": "Leeg fust",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isEmptyReturnable=1 /*coretype not in (N'FOOD')*/",
            "action_id": 11,
            "action_name": "leeg fust",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'leveringsbevestiging....' \n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\t\t\n\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_toast @cid\n\t\t--dit is nu alleen voor tellers en checks, zodat we weten dat het report al is gemaakt:\n\t\t--was\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'CTH'\t,@Context_Key_ID=@cid,@Report_CODE=N'CONF_DELIVERY' -- zie runreport \n\t\t--nu\n\t\tEXEC @main_db.dbo.SetDelConf @cid --210224 Registreer verzending van DeliveryConfirmation via xMarker\n\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@cid)\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = 'deliveryconfirmation_out' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@fixedprinter_ID=2\n\t\t\t,@test=0\n\n\n\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;",
            "action_id": 12,
            "action_name": "leveringsbevestiging",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @wat nvarchar(200), @linktoME int,@text nvarchar(max)\n\nIF {[ctr2].cth_fase} NOT IN (N'openSale','openPrice')\n\tBEGIN\n\tEXEC sp_api_modal_Alert N'Let op!', N'De verkoop is reeds gesloten. U kan niet meer de toewijzing wijzigen.' \n\tEXEC sp_api_modal_clear\n\tRETURN\n\tEND\n\nSET @linktoME ={[ctr2].id}\n--201028 erbij ivm overbrengen..\nif @LinkToMe is NULL set @LinkToMe={[ctr_overbrengen].id}\n\nDECLARE @maxTeLinken INT,@maxBeschikbaar INT\nSELECT @maxTeLinken = (ctrAmount-IVTOTAL) FROM Q_xTransactionDetail WHERE ID=@LinkToME\n\nIF @maxTeLinken = 0\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'Regel is al volledig toegewezen'\n\t\tEXEC\t sp_api_go2 1 -- 1 stap terug (+list view; detailviewgebruik EXEC sp_api_go2 1,0)\n\t\tRETURN;\n\tEND\n\n\nSET @maxBeschikbaar = {[ctr1_toewijsbaar].available}\nIF @maxBeschikbaar < @maxTeLinken\n\tBEGIN\n\t\tdeclare @Melding nvarchar(200)\n\t\tset @Melding = concat(N'Niet genoeg beschikbaar! Te linken:',N' ',@maxTeLinken)\n\t\tEXEC sp_api_modal_text @Melding,N'h4 text-muted'\n\t\tSET @text = CONCAT('U kunt maximaal ',@maxBeschikbaar,' van de ',@maxTeLinken,' linken')\n\t\tEXEC sp_api_modal_text @text,N'm-4'\n\t\tSET @maxTeLinken = @maxBeschikbaar\n\tEND\n\nIF @maxTeLinken < 0\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'Probleem!',N'Regel heeft meer toegewezen dan mag. Ga naar de toewijzing (IV link) en verlaag deze.'\n\t\tEXEC sp_api_modal_clear\n\tEND\n\nDECLARE @aantalTeLinken INT = @maxTeLinken\n\t,@button nvarchar(50)\n\nEXEC sp_api_modal_input @name='Aantal',@value = @aantalTeLinken OUT,@focus=1,@select=1\nEXEC sp_api_modal_button @name='button',@value = 'Link aantal',@valueout=@button OUT,@key=N'Enter'\nIF @button IS NULL RETURN\nset @wat=N'Gekozen ID: '+str(@ID)+' wordt gekoppeld aan CTR: '+str(@LinktoME)\nexec sp_api_toast @wat\n--RETURN; --test\n\nif @linktoME is not null\n\tBEGIN\n\t\texec @main_db.dbo.map @linktoME,@ID, @aantalTeLinken\n\t\t\n\t\t--zet return path\n\t\tSET @ctr2_id = {[ctr2].id}\n\t\tSET @verkoop_id = {[verkoop].id}\n\t\tIF @ctr2_id IS NOT NULL AND @verkoop_id IS NOT NULL AND @aantalTeLinken = @maxTeLinken\n\t\t\tBEGIN\n\t\t\t\tSET @goto = CONCAT('/verkoop/',@verkoop_id,'/ctr2/',@ctr2_id,'/iv2')\n\t\t\t\tSET @referer_path = CONCAT('/verkoop/',@verkoop_id,'/ctr2')\n\t\t\t\tSET @referer_search = CONCAT(N'?id=',@ctr2_id)\n\t\t\t\tEXEC sp_api_toast N'Regel(s) is/zijn gelink bla',N'alert-primary'\t\t\t\t\n\t\t\t\tEXEC sp_api_goto @goto,@referer_path=@referer_path,@referer_search=@referer_search\n\t\t\tEND\n\t\t--210115 \n--\t\texec sp_api_go3\n\t\texec sp_api_modal_clear\n\tEND\n\n\n--if @parent_card_name='ctr2'\n--\tBEGIN\n--\t\texec @main_db.dbo.map @ID, @Parent_ID\n--\tEND\n--else --neem aan parent_parent...\n--\tBEGIN\n--\t\texec @main_db.dbo.map @ID, @Parent_Parent_ID\n--\tEND\n\n--EXEC sp_api_goto @path",
            "action_id": 13,
            "action_name": "link_this",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text @ids",
            "action_id": 14,
            "action_name": "LinkActionGroterDan",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "company_id in (select ID from @main_db.dbo.xTenantkey)\r\n--is_tenant_warehouse wordt niet gebruikt",
            "action_id": 15,
            "action_name": "EIGEN LOKATIES",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @ctrtoloc int, @ctrfromloc int ,@checkamt int-- (oorspronkelijke) advieslokaties\ndeclare @Direct int=1\ndeclare @Normaal int=2\ndeclare @isEqual bit=0\n\nselect @ctrtoloc =tocloc_id, @ctrfromloc=frmloc_id,@checkamt=iif(stockmut=1,amount,0) from xtransactiondetail where id=@ID\nupdate xtransactiondetail set Flowmodel_id=@Normaal where id=@ID\nupdate xlfctr set ltrtoloc=@ctrtoloc,ltrfromloc=@ctrfromloc, @isEqual=iif(lfctr_amount-@checkamt=0,1,0) where ctr_id=@ID and lfctr_amount=@checkamt -- let op: dit gaat alleen goed bij volledige ctr op lfctr!\n\n\nif @isEqual=1 begin\n\t--pas ook de lfctr aan van de aan deze inkoopregel gelinkte verkoopregels\n\tDECLARE @cursor_ids CURSOR,@cid INT\n\tSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR (select ITD as ivCTR from xivlink where vtd=@ID UNION select VTD as ivCTR from xivlink where itd=@ID) --SELECT value FROM string_split(@ids,',')\n\tOPEN @cursor_ids;\n\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tWHILE @@FETCH_STATUS = 0\n\t\tBEGIN\n\t\t\t--geef de lfctr van de verkoop ctr een nieuwe laadlokatie\n\t\t\tupdate xtransactiondetail set Flowmodel_id=@Normaal where id=@cid\n\t\t\tupdate xlfctr set ltrfromloc=@ctrtoloc where ctr_id=@cid\n\t\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\t\tEND\n\tCLOSE @cursor_ids;\n\tDEALLOCATE @cursor_ids;\n\nend",
            "action_id": 16,
            "action_name": "Loods Verlading (normaal)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "update xlandfreight SET transport_id = NULL WHERE id ={[xlandfreight].id}",
            "action_id": 17,
            "action_name": "Maak Los Van Transport",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.UndoUnloading_LP @xLotPallet_ID=@ID ",
            "action_id": 18,
            "action_name": "Maak Uitlossing Ongedaan",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "SET @path = REPLACE(@path,'/lotpallets','/lotartsize')\r\nEXEC sp_api_goto @path\r\n",
            "action_id": 19,
            "action_name": "maten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select company_id from xlocation where useCalculator=1)",
            "action_id": 20,
            "action_name": "Met Calculator",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT distinct counterparty_id FROM xtransactionheader WHERE (transactiondate>= getdate()-100) AND tdt=2)/*laatste 100 dagen*/",
            "action_id": 21,
            "action_name": "Met Orders",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT ID FROM @main_db.dbo.SuppliersWithOpenOrders())",
            "action_id": 22,
            "action_name": "Met Voorraad",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(lft_ColliCalc,0) <> 0",
            "action_id": 23,
            "action_name": "Met vracht",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT stock_ID FROM @main_db.dbo.StockWithTrouble())",
            "action_id": 24,
            "action_name": "misAllocated",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 25,
            "action_name": "modify",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @VerkoopPath nvarchar(200) \nSET @VerkoopPath=concat(N'/verkoop/',{[verkoop].id},N'/ctr2')\nEXEC SP_API_GOTO @VerkoopPath",
            "action_id": 26,
            "action_name": "naar CTR",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "SELECT * INTO #globecsv FROM calc_exact_globe_csv WHERE datum IS NOT NULL ORDER BY factuurnum,dagboek,regel\nEXEC sp_api_modal_csv @tmptable=N'#globecsv',@ansi =1,@filename=N'exact_globe.csv',@orderby=N'ORDER BY factuurnum,dagboek,regel'",
            "action_id": 27,
            "action_name": "Naar ExactGlobe CSV_voor210112",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "\nIF @id<>@ids --BULK naar Exact\n\tBEGIN\n\t\tDECLARE @cursor CURSOR,@idval INT,@count int = 0,@seconds int = 0\n\t\tSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\n\t\tOPEN @cursor;\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\n\t\t\t\tSET @seconds+=6\n\t\t\t\tSET @subject = CONCAT(\n\t\t\t\t\t(SELECT [xCompany].[Code] FROM [xCompany] WHERE [id] = (SELECT [Q_xInvoice].[fromCompany_ID] FROM [Q_xInvoice] WHERE [id] = @idval))\n\t\t\t\t\t,' - ',(SELECT [Q_xInvoice].[dateInvoice] FROM [Q_xInvoice] WHERE [id] = @idval)\n\t\t\t\t\t,' - ',(SELECT [Q_xInvoice].[calcLegal] FROM [Q_xInvoice] WHERE [id] = @idval)\n\t\t\t\t\t)\n\t\t\t\tSET @sql = CONCAT(N'DECLARE @base64 nvarchar(max),@filename nvarchar(4000)\n', --EXEC sp_api_report_download_base64 @context = ''invoice_out'', @context_id = ',@idval,' , @filename =  @filename OUT, @base64 =  @base64 OUT\n'BEGIN TRY\n\tEXEC @main_db.dbo.sp_iu_finance_invoice ',@idval,',@groupbycostcodes = 1\nEND TRY BEGIN CATCH\n\tUPDATE xInvoice SET status = ''Exact Error'',statusHistory = ERROR_MESSAGE() WHERE id = ',@idval,'\nEND CATCH') -- = @filename,@subject = ',dbo.escape_string(@subject),',@base64 = @base64')\n\t\t\t\tSET @subject = N'To Exact: ' + @subject\n\t\t\t\tEXEC sp_api_add_sql_task @sql=@sql,@description=@subject,@seconds = @seconds\n\t\t\t\tUPDATE xInvoice SET status='Sending to Exact' WHERE id = @idval\n\t\t\t\tSET @count+=1\n\t\t\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\t\tEND\n\t\tCLOSE @cursor;\n\t\tDEALLOCATE @cursor;\n\t\texecute sp_api_modal_clear\n\t\tIF @count > 0 EXEC sp_api_toast N'Verzenden is ingepland, F5 voor refresh'\n\t\tEXEC sp_api_modal_select_all_clear\n\t\tRETURN\n\tEND\n\nBEGIN TRY\n\tEXEC @main_db.dbo.sp_iu_finance_invoice @id, @groupbycostcodes = 1\nEND TRY BEGIN CATCH\n\tDECLARE @text nvarchar(max) = ERROR_MESSAGE(),@ERROR_SEVERITY int = ERROR_SEVERITY()\n\tIF @ERROR_SEVERITY = 17\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_url @text\n\t\t\tRETURN\n\t\tEND\n\tEXEC sp_api_modal_text @text\n\tDECLARE @valueout nvarchar(128)\n\tEXEC sp_api_modal_button @name='Retry',@value = 'Retry', @valueout = @valueout OUT\n\t\t,@class='btn-primary',@key='Enter'\nEND CATCH",
            "action_id": 28,
            "action_name": "Naar ExactOnline",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "\nIF @id<>@ids --BULK naar Exact\n\tBEGIN\n\t\tDECLARE @cursor CURSOR,@idval INT,@count int = 0,@seconds int = 0\n\t\tSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\n\t\tOPEN @cursor;\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\n\t\t\t\tSET @seconds+=6\n\t\t\t\tSET @subject = CONCAT(\n\t\t\t\t\t(SELECT [xCompany].[Code] FROM [xCompany] WHERE [id] = (SELECT [Q_xInvoice].[toCompany_ID] FROM [Q_xInvoice] WHERE [id] = @idval))\n\t\t\t\t\t,' - ',(SELECT [Q_xInvoice].[dateInvoice] FROM [Q_xInvoice] WHERE [id] = @idval)\n\t\t\t\t\t,' - ',(SELECT [Q_xInvoice].[calcLegal] FROM [Q_xInvoice] WHERE [id] = @idval)\n\t\t\t\t\t)\n\t\t\t\tSET @sql = CONCAT(N'DECLARE @base64 nvarchar(max),@filename nvarchar(4000)\n', --EXEC sp_api_report_download_base64 @context = ''invoice_out'', @context_id = ',@idval,' , @filename =  @filename OUT, @base64 =  @base64 OUT\n'BEGIN TRY\n\tEXEC @main_db.dbo.sp_iu_finance_invoice ',@idval,',@groupbycostcodes = 1\nEND TRY BEGIN CATCH\n\tUPDATE xInvoice SET status = ''Exact Error'',statusHistory = ERROR_MESSAGE() WHERE id = ',@idval,'\nEND CATCH') -- = @filename,@subject = ',dbo.escape_string(@subject),',@base64 = @base64')\n\t\t\t\tSET @subject = N'To Exact: ' + @subject\n\t\t\t\tEXEC sp_api_add_sql_task @sql=@sql,@description=@subject,@seconds = @seconds\n\t\t\t\tUPDATE xInvoice SET status='Sending to Exact' WHERE id = @idval\n\t\t\t\tSET @count+=1\n\t\t\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\t\tEND\n\t\tCLOSE @cursor;\n\t\tDEALLOCATE @cursor;\n\t\texecute sp_api_modal_clear\n\t\tIF @count > 0 EXEC sp_api_toast N'Verzenden is ingepland, F5 voor refresh'\n\t\tEXEC sp_api_modal_select_all_clear\n\t\tRETURN\n\tEND\n\nBEGIN TRY\n\tEXEC @main_db.dbo.sp_iu_finance_invoice @id, @groupbycostcodes = 1\nEND TRY BEGIN CATCH\n\tDECLARE @text nvarchar(max) = ERROR_MESSAGE(),@ERROR_SEVERITY int = ERROR_SEVERITY()\n\tIF @ERROR_SEVERITY = 17\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_url @text\n\t\t\tRETURN\n\t\tEND\n\tEXEC sp_api_modal_text @text\n\tDECLARE @valueout nvarchar(128)\n\tEXEC sp_api_modal_button @name='Retry',@value = 'Retry', @valueout = @valueout OUT\n\t\t,@class='btn-primary',@key='Enter'\nEND CATCH",
            "action_id": 29,
            "action_name": "Naar ExactOnline",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @S nvarchar(200), @P nvarchar(200)\r\nSET @P =N'/invoice'\r\nSET @S=concat(N'?id=',{[xinvcth].invoice_id})\r\n--EXEC sp_api_toast @S22\r\nEXEC sp_api_goto  @P, @S",
            "action_id": 30,
            "action_name": "naar Factuur",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @invoice_id nvarchar(40) = (SELECT TOP 1 invoice_id FROM xinvrow WHERE cth_id = @id)\nIF @invoice_id IS NULL\n\tEXEC sp_api_toast N'Geen invoice gevonden'\nELSE\n\tBEGIN\n\t\tSET @invoice_id = N'?id=' + @invoice_id\n\t\tEXEC sp_api_goto N'/invoice',@invoice_id\n\tEND",
            "action_id": 31,
            "action_name": "Naar factuur",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @invoice_id nvarchar(40) = (SELECT TOP 1 invoice_id FROM xinvrow WHERE cth_id = @id)\r\nIF @invoice_id IS NULL\r\n\tEXEC sp_api_toast N'Geen invoice gevonden'\r\nELSE\r\n\tBEGIN\r\n\t\tSET @invoice_id = N'?id=' + @invoice_id\r\n\t\tEXEC sp_api_goto N'/invoice',@invoice_id\r\n\tEND",
            "action_id": 32,
            "action_name": "Naar factuur van de order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "fromcountry_id=(SELECT countryid FROM xcountry WHERE isoCode='NL') ",
            "action_id": 33,
            "action_name": "Nederland",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @LF int = {[xlandfreight].id}\nif @LF is null\n\tbegin\n\t\texec sp_api_toast N'Er is geen landvracht om op te boeken'\n\t\treturn;\n\tend\n\nDECLARE @mes nvarchar(200), @aantal nvarchar(20) --='100'\nset @Mes =N'Overnemen van een (deel van) de vracht'\n\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\n\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tIF \tTRY_CAST(@aantal as int) >\t 0 \n\t\t\tBEGIN\n\n\t\t\t\texec @main_db.dbo.ExtraVracht_lfctr @LFCTR_ID=@ID ,@Landfreight_ID=@LF ,@TransferAmount=@Aantal\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal is niet geldig!','text-danger'\n\tEND\n",
            "action_id": 34,
            "action_name": "Neem over",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 35,
            "action_name": "negatief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<0",
            "action_id": 36,
            "action_name": "negatief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<0\n",
            "action_id": 37,
            "action_name": "Negatief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<>0 or delayedin<>0 or delayedout<>0",
            "action_id": 38,
            "action_name": "niet 0",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<>0 OR delayedin<>0 OR delayedout<>0 ",
            "action_id": 39,
            "action_name": "Niet 0",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(stock,0)<>0 OR isnull(expected,0)<>0",
            "action_id": 40,
            "action_name": "Niet 0 (rollend en vast)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC sp_api_toast @parent_parent_id\r\n--exec sp_api_toast @User\r\n\t\r\nDECLARE @CTHID INT = {[ompakken].id} --200818 curly\r\nIF @CTHID IS NULL begin\r\n\t\tEXEC sp_api_toast 'Kan geen [ompakken2] vinden'\r\n\t\tRETURN;\r\n\t\tend\r\n--ELSE EXEC sp_api_toast @CTHID\r\n\r\nIF {[ompakken].status} not in ('openRepack') BEGIN\r\n\tEXEC sp_api_modal_alert 'Toevoegen alleen bij status: openRepack'\r\n\tEXEC sp_api_modal_clear\t\t\r\n\tRETURN;\t\r\n\tend\r\n\r\n-- 200629 Uitbreiding inkoop vanuit diverse contexten: Zoek CTH ; bijv als we afkomstig zijn van een regel, dan is CTH te vinden in de regel\r\n--if @parent_card_name ='verkoop'\tset @CTHID=@parent_id\r\n--if @parent_card_name = 'ctr2' set @CTHID=(select TransactionHeader_ID from xtransactiondetail where xtransactiondetail.id=@parent_id)\r\n\r\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200)\r\nSELECT @xDesc=x.[Description],@mes= concat('Ompak in ' , x.[Description]) ,@Coretype= x.coretype,@FustID=x.Fust_ID from xstock x where x.id=@ID --@main_db.dbo.\r\n--EXEC sp_api_modal_text @mes,'h2 text-primary'\r\n------\r\nIF @coretype in('CRATE','PALLET')\r\n\tBEGIN\r\n\t\tSELECT @Fustsaldo=Fustsaldo from @main_db.dbo.FustSaldo_FC(@FustID,{[verkoop].Counterparty_ID})\r\n\t\tEXEC sp_api_toast @Fustsaldo\r\n\t\t-- breid DECLARE message uit met het fust-saldo\r\n\t\tIF @FustSaldo is not NULL\r\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') actueel saldo bij deze klant: ',@fustsaldo)\r\n\t\tELSE\r\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') => let op: deze klant heeft dit fust nooit eerder gehad!')\r\n\tEND\r\n\r\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\r\nDECLARE @aantal nvarchar(20),@opmerking nvarchar(50) --='100'\r\nDECLARE @CounterpartyID int\r\nDECLARE @FlowModel int\r\nDECLARE @THDT INT\r\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=FlowModel_ID,@THDT=TDT From xTransactionHeader CTH where CTH.ID=@CTHID\r\n--200630 was@parent_id\r\n\r\n--200708 => ??? WAAROM GAAT DIT NIET ??? select @Prijs= @main_db.dbo.StockPrice(@ID,@CTHID,NULL,NULL,NULL,NULL,NULL,NULL,NULL)\r\n\r\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\r\nEXEC sp_api_modal_text 'Aantal'\r\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\r\nEXEC sp_api_modal_text 'Opm. loods'\r\nEXEC sp_api_modal_input @name='opmerking',@value = @opmerking OUT\r\nDECLARE @button nvarchar(128)\r\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\nIF @button IS NOT NULL\r\n\tBEGIN\r\n\t\tIF \t\t--TRY_CAST(@prijs as decimal) > 0 AND \r\n\t\t\t\tTRY_CAST(@aantal as int) > 0 \r\n\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\r\n\t\t\tBEGIN\r\n\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=NULL,@Logistic=@Opmerking, @User=@User,@forcedTDT=1\r\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\tEND",
            "action_id": 42,
            "action_name": "SelectAmountOUT",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @CTHID INT = {[inkoop].id} --200818 curly\r\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\r\nDECLARE @aantal nvarchar(20) --='100'\r\nDECLARE @intAantal int\r\nDECLARE @MaxAantal int -- beschikbare hoeveelheid op de lokatie\r\nDECLARE @CounterpartyID int\r\nDECLARE @FlowModel int\r\nDECLARE @THDT INT\r\nDECLARE @LFID INT = {[xlandfreight].id}\r\n\r\nIF @CTHID IS NULL begin\r\n\t\tEXEC sp_api_toast 'Kan geen [inkoop] partij vinden'\r\n\t\tRETURN;\r\n\t\tend\r\nIF @LFID IS NULL begin\r\n\t\tEXEC sp_api_toast 'Kan geen landfreight vinden (moet open staan!)'\r\n\t\tRETURN;\r\n\t\tend\r\n\r\n\r\nDECLARE @mes nvarchar(200), @xDesc nvarchar(200)\r\nSELECT @maxAantal= (Amount-ivtotal)---(select stock from @main_db.dbo.RealStock(x.stock_id ,{[Xlandfreight].From_Location_ID}))\r\n\t\t,@xDesc=concat( x.[Detail],' ',x.[ExtraDetail]),@mes= concat('Overbrengen van ' , x.[Detail],' ',x.[ExtraDetail]) from Q_xtransactiondetail x where x.id=@ID \r\n\r\nset @Aantal=@maxAantal \r\n\r\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\r\nEXEC sp_api_modal_text 'Aantal'\r\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\r\n\r\nDECLARE @button nvarchar(128)\r\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\n\r\nIF @button IS NOT NULL\r\n\tBEGIN\r\n\t\tset @intAantal=TRY_CAST(@aantal as int)\r\n\t\tIF\t@intAantal > 0 and @intaantal <= @maxAantal\r\n\t\t\tBEGIN\r\n\t\t\t\texec @main_db.[dbo].[Add_LFCTR_TO_LF]\t@LF_ID=@LFID,@CTR_ID =@ID ,@Amount =@intaantal\r\n\r\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ concat(x.[Detail],' ',x.[ExtraDetail])+' toegevoegd aan de overbrenging' from Q_xTransactiondetail x where x.id=@ID\r\n\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\tRETURN\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tEXEC sp_api_modal_text 'Aantal is niet geldig!','text-danger'\r\n\tEND\r\n\r\n",
            "action_id": 43,
            "action_name": "Selecteer",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "\tDECLARE @ClientCode_ID INT, @GroupSubid int\r\n\t\r\n\tSELECT @ClientCode_ID = ClientCode_ID, @Groupsubid=GroupSub_ID FROM [xProduct] WHERE [id] = (SELECT id FROM #parents WHERE card_name = N'botanic')\r\n\tIF @ClientCode_ID is not null AND @GroupSubID is not NULL BEGIN\r\n--\t\tEXEC sp_api_toast N'COCO'  \t\t\t\r\n\t\tupdate xproduct SET ClientCode_ID = @ClientCode_ID WHERE ClientCode_ID is null AND GroupSub_ID=@GroupSubID\r\n\t\tEND\r\n\r\n ",
            "action_id": 44,
            "action_name": "Set ClientCode",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.xStockSetSeek\nexec sp_api_toast N'Zoekveld [Seek] is opnieuw ingesteld'",
            "action_id": 45,
            "action_name": "Set Seek Veld",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--UPDATE xTransactionHeader SET transactiondate = GETDATE() WHERE id = @id\r\nEXEC sp_api_foreach_id N'UPDATE xTransactionHeader SET advTransportDep= dbo.workdate(), transactiondate = dbo.workdate() WHERE id = @id',@ids\r\nEXEC sp_api_toast N'Today set!'",
            "action_id": 47,
            "action_name": "set to workdate",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @D DateTime\r\nSET @D={[abcCalendar].date} \r\nEXEC sp_api_modal_set N'workdate',@D",
            "action_id": 48,
            "action_name": "Set_Workdate",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "UPDATE xTransactiondetail\r\nSET TDT = 1\r\nWHERE @id = id",
            "action_id": 49,
            "action_name": "SetIN",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "UPDATE xTransactiondetail\r\nSET TDT = 2\r\nWHERE id=@id",
            "action_id": 51,
            "action_name": "SetOUT",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "/* bla bla {[verkoop].id} */\nDECLARE @cid int,@reducer nvarchar(max),@value nvarchar(128), @button nvarchar(128)\n,@from nvarchar(128) = NULL -- maar dit legt hier weer meer complexiteit neer, wat mij betreft dus allemaal om het even... als het default (=null) naar 'vansdaag' gaat is best, maar als ik ook maak blanco (= N'') kan meegeven dan.. PRIMA, mooi want dan wijzigd er niets voor bestaande boel\n\n,@to nvarchar(128) = N'' -- N'2021-01-12'--? misschien try\nSELECT @cid = id FROM api_card WHERE name = 'klant'\n\nEXEC sp_api_modal_date_from_to @from = @from OUT,@to = @to OUT\nEXEC sp_api_modal_text @from\nEXEC sp_api_modal_text @to\nEXEC sp_api_modal_button @name='Sure',@value = 'Ja', @valueout = @button OUT,@class='btn-danger',@key='Enter'\nRETURN\nEXEC sp_api_modal_select @card_name = N'country',@value = @value OUT,@focus = 1\nIF @value IS NOT NULL\n\tBEGIN\n\t\tSET @reducer = N'Country_ID = ' + @value\n\t\tEXEC sp_api_modal_table @card_id = @cid ,@reducer = @reducer --'' ,@class = 'h-auto' ,@tmptable = '#modaltable' ,@orderby = ''\n\tEND\nRETURN\nDECLARE @json nvarchar(max)\nSET @json = (SELECT * FROM fn_api_get_related_items_json_list(383,NULL))\nEXEC sp_api_modal_text @json,N'json'",
            "action_id": 53,
            "action_name": "Show Related List",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @T nvarchar(200)\r\nset @T=(select L from @main_db.dbo.[GetCompanySettings]('useDayprice'))\r\nexec sp_api_toast @T",
            "action_id": 54,
            "action_name": "showsetting",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "UPDATE xTransactionHeader SET status='closedPurchase' WHERE id IN ({@ids})\r\n/*\r\nDECLARE @currState nvarchar(50)\r\nSET @currstate = (SELECT status FROM xtransactionheader cth WHERE id=@ID)\r\nIF @currState='openPurchase'\r\n\tBEGIN\r\n\t\tupdate xtransactionheader SET status='closedPurchase' WHERE ID=@ID\r\n\tEND\r\nIF @currState='closedPurchase'\r\n\tBEGIN\r\n\t\tupdate xtransactionheader SET status='openPurchase' WHERE ID=@ID\r\n\tEND\r\n*/",
            "action_id": 55,
            "action_name": "sluit inkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @CTHID INT \nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200)\nSELECT @xDesc=x.[Description],@mes= concat('Quick Purchase ' , x.[Description]) ,@Coretype= x.coretype,@FustID=x.Fust_ID from xstock x where x.id=@ID --@main_db.dbo.\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20) --='100'\nDECLARE @CounterpartyID int\nDECLARE @FlowModel int\nDECLARE @THDT INT\nDECLARE @FRAFOT Nvarchar(3) -- 'FRA' OF 'FOT'\nDECLARE @SrcID int -- let op: slechts 'advies'\nDECLARE @DstID INT\n\n---- TEST: set supplier:\n--set @CounterpartyID =(select top 1 id from xcompany where companyname like '%4%') --4 fruit?\n\n--\tget supplier:\nDECLARE @value nvarchar(max),@SupplierID nvarchar(max)\nEXEC sp_api_modal_text N'Kies de leverancier',N'h3'\nEXEC sp_api_modal_select @card_name=N'leverancier',@value = @SupplierID OUT,@focus=1,@placeholder=N'Kies de leverancier voor de snelle inkoop'\nif @SupplierID is not NULL \n\tset @CounterpartyID=convert(int, @SupplierID)\nelse return --ga niet verder; maak (nog) geen cth1\n\n--bepaal hoe het bedrijf werkt, met of zonder dagprijzensysteem\ndeclare @dayprice bit\nset @dayprice=isnull((select L from @main_db.dbo.[GetCompanySettings]('useDayprice')),0)\nexec sp_api_toast @dayprice\n\n--pak de eerste de beste inkooporder van de geselecteerde leverancier; deze wordt gebruikt als hulp voor prijsbepaling\nset @CTHID=(select top 1 id from xtransactionheader where tdt=1 and counterparty_ID=@CounterpartyID) -- LET OP: DUMMY; dus zeer waarschijnlijk NIET het ID waarop geboekt gaat worden\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=cth.FlowModel_ID,@THDT=cth.TDT,@FRAFOT=cth.FRAFOT, @srcID=cth.source_ID,@DstID=cth.Destination_ID From q_xTransactionHeader CTH where CTH.ID=@CTHID\n\n\nif isnull(@Prijs,0)=0\n\tbegin\n\t\tset @prijs=(select @main_db.dbo.stockprice(\t@ID --48482 --stock_ID\n\t\t\t\t\t\t\t,@CTHID --3761\t--CTH_ID\n\t\t\t\t\t\t\t,@CounterpartyID --161418\t--Counterparty_ID\n\t\t\t\t\t\t\t,@FlowModel --null\t--Flowmodel_ID\n\t\t\t\t\t\t\t,@THDT --2\t\t--DaTDT\n\t\t\t\t\t\t\t,@SrcID --NULL --SupplierLocation_ID\n\t\t\t\t\t\t\t,@DstID --NULL -- 7945\t--Receiverlocation_ID\n\t\t\t\t\t\t\t,IIF(@FRAFOT='FOT',1,0)\t\t--isFOT\n\t\t\t\t\t\t\t,@dayprice --0-- use dayprice\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\n\tend\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\nIF @coretype in('FOOD')\n\tBEGIN\n\t\tEXEC sp_api_modal_text 'Prijs'\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT\n\tEND\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.')\n\t\tIF \tTRY_CAST(@aantal as int) >\t 0 \n\n\t\t\tBEGIN\n\t\t\t\t--zoek een open CTH1 of maak een nieuwe ...\n\t\t\t\tset @CTHID=(select top 1 id from xtransactionheader where tdt=1 and counterparty_ID=@CounterpartyID and status='openPurchase')\n\t\t\t\tif @CTHID IS NULL\tEXEC @main_db.dbo.CreateCTH1 @CounterpartyID, @new_identity = @CTHID OUTPUT;\n\n\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs, @User=@User\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\n\t\t\t\texec sp_api_toast @mes\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\n\tEND\n\n",
            "action_id": 56,
            "action_name": "Snel Inkopen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock <> 0 or (id in (select DISTINCT Stock_id from p_PriceentryRow where activeCount >0 AND (pricehi<>0 OR pricelo<>0)))",
            "action_id": 58,
            "action_name": "Stock of PER",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @stock_id nvarchar(32),@button nvarchar(128),@valueout nvarchar(128)\n,@reducer nvarchar(max) = '1=1'\nEXEC sp_api_modal_button @name='button', @value=N'Stock of PER',@valueout=@button OUT,@key=N'F1'\nEXEC sp_api_modal_button @name='button', @value=N'Alles',@valueout=@button OUT,@key=N'F2'\nIF @button = N'Stock of PER'\n\tSET @reducer = N'stock <> 0 or (id in (select DISTINCT Stock_id from p_PriceentryRow where activeCount >0 AND (pricehi<>0 OR pricelo<>0)))'\n\nEXEC sp_api_modal_select @card_name = N'xstock_geert_test',@value = @stock_id OUT,@focus = 1,@top=50,@reducer=@reducer\nEXEC sp_api_modal_text @stock_id\nEXEC sp_api_modal_input @name='asdfafd',@value=@valueout OUT\n",
            "action_id": 59,
            "action_name": "stock_search",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<>0 or\nid in(select distinct p.stock_id as id from p_priceentryrow p where p.activecount >0)\n",
            "action_id": 60,
            "action_name": "StockOfPrijs",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @date nvarchar(128),@date2 nvarchar(128),@button nvarchar(128), @ProdCode nvarchar(128), @ProdCode2 nvarchar(128),@land nvarchar(128)\nset @date = dbo.workDate()\nset @date2 = dbo.workDate()\n--SET @button = 'StockSoldList'\n--EXEC sp_api_modal_modal @class = 'w75'\nEXEC sp_api_modal_text 'Lvo:'\nEXEC sp_api_modal_select @card_name = N'Country',@value = @land OUT, @focus=1\nEXEC sp_api_modal_text 'Van:'\nEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-24'  -- zoek veld\nEXEC sp_api_modal_text 'Tot en met:'\nEXEC sp_api_modal_date @name='Date2',@value = @date2 OUT,@class='w-24' -- zoek veld\n--SET @date2 = CONCAT(@date2,' 23:59:59.999')\n\nEXEC sp_api_modal_text 'Van ProdCode:'\n--EXEC sp_api_modal_select @card_name=N'xstock',@value = @ProdCode OUT,@placeholder=N'Zoek...'\nEXEC sp_api_modal_input @name='ProdCode',@value = @ProdCode OUT,@class='w-24' -- zoek veld\nEXEC sp_api_modal_text 'Tot en met ProdCode:'\n--EXEC sp_api_modal_select @card_name=N'xstock',@value = @ProdCode2 OUT,@placeholder=N'Zoek...'\nEXEC sp_api_modal_input @name='ProdCode2',@value = @ProdCode2 OUT,@class='w-24' -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'StockSoldList',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print @keycode='F9'\n\nIF @button =  'StockSoldList'\nBEGIN\nEXEC sp_api_toast @land\nSELECT [Amount@] = Amount, [Description*] = Description, [Contentdesc*] = ContentDesc, LVO, xProdCode, TransactionDate\nINTO #StockSoldList\nFROM          RV_StockSold\nWHERE\t\t(TDTDT = 2) \nAND (TransactionDate BETWEEN @date AND @date2) AND (Origin_ID = @land OR @land is null)\n\n\nAND ((@ProdCode is NULL OR @ProdCode = '') AND (@ProdCode2 is NULL OR @ProdCode2 = '') AND (Origin_ID = @land OR @land is null)\nOR (xProdCode between @ProdCode AND @ProdCode2) AND (Origin_ID = @land OR @land is null))\n\nEXEC sp_api_modal_table @tmptable=N'#StockSoldList',@orderby=N'ORDER BY 2,5,4 ASC',@print=1\nEND \n",
            "action_id": 61,
            "action_name": "StockSold",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "movement=1",
            "action_id": 62,
            "action_name": "sys_clear_filters",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 63,
            "action_name": "sys_curly_search_and_insert",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 64,
            "action_name": "sys_curly_search_and_insert",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(stock,0)<>0 OR isnull(expected,0)<>0",
            "action_id": 65,
            "action_name": "Niet 0 (rollend en vast)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--200930\r\nDECLARE @maatcode nvarchar(20), @mes nvarchar(100)=N'Nieuwe maat toevoegen'\r\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\r\nEXEC sp_api_modal_text 'Nieuwe Maat-code'\r\nEXEC sp_api_modal_input @name='maatcode',@value = @maatcode OUT,@focus=1\r\nDECLARE @button nvarchar(128)\r\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\nIF @button IS NOT NULL\r\n\tBEGIN\r\n\t\tIF @maatCode >N''\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC sp_api_toast @maatcode\r\n\t\t\t\t  exec @main_db.[dbo].[SP_IINE_xStock_LP] @xLotPalletID=@ID ,@AddSize =@maatcode\r\n\t\t\tEND\r\n\r\n\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\r\n\tEND\r\n",
            "action_id": 66,
            "action_name": "nieuwe maat",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @Code nvarchar(50) --CURRENCY, DIESEL, ...\nDECLARE @ContextID INT -- context van de huidige kaart\nDECLARE @mes nvarchar(200)--, @xDesc nvarchar(200)\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20) --='100'\n\nDECLARE @xValRateID INT = {[xValRate].id}\n\nif isnull(@xValRateID,0) = 0 -- 0 bij splinternieuwe kaart, dan geen koersen zetten op deze manier\n\tBEGIN\n\n\t\t\n\n\t\t--EXEC SP_API_TOAST N'Er kan geen nieuwe waarde worden toegevoegd. Dit kan alleen op bestaande xValrate kaarten.'\n\t\t--RETURN;\n\t\tdeclare @xCURR_ID int = {[currency].id}\n\t\tdeclare @xVALID int \n\t\tif @xCURR_ID is not null\n\t\t\tselect @xVALID = id from xValue where code='CURRENCY' and ContextID=@xCURR_ID and returntype='F'\n\n\t\tif @xVALID is not null\n\t\t\tbegin\n\t\t\t\tINSERT INTO [dbo].[xValrate]\n        \t   ([xVal_ID]\n           \t\t,[code]\n           \t\t,[contextID]\n           \t\t,[F]\n           \t\t,[StartDate]\n           \t\t,[ReturnType]\n           \t\t,[EndDate])\nselect \t[ID]\n          ,[code]\n          ,[contextID]\n          ,[F]\n          ,@main_db.dbo.ABCBOM()\n          ,[ReturnType]\n          ,NULL\nfrom xvalue where id=@xVALID\n\n\t\nreturn; -- nieuw record. stoppen. Als men een koers wil ingeven, dan nog een keer klikken..\n\t\t-- we kunnen ook het nieuwe inserted ID  hier in @ContextID stoppen...\n\n\t\t\tend\n\n\t\t\t\t\n\tEND\n\n\nselect @Code=code\n\t\t, @ContextID=ContextID\n\t\t--, @CardStartDate =startdate \n\tfrom xvalrate where ID=@xValrateID\nexec sp_api_toast @code\n--return;\n\ndeclare @datum nvarchar(512)\t--input\nDECLARE @koers nvarchar(20)\t\t--input\nset @mes=N'Invoeren van een nieuwe waarde'\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Datum'\nSET @datum = dbo.strdate(getdate())--'2020-10-30'\nEXEC sp_api_modal_date @name='Ingangsdatum:',@value= @datum OUT,@class = 'w-25' ,@focus=1\nEXEC sp_api_toast @datum\n\nEXEC sp_api_modal_text 'Waarde op deze datum:'\nEXEC sp_api_modal_input @name='koers',@value = @koers OUT\nIF @Koers>N'' SET @Koers=replace(@Koers, ',', '.') -- zorg dat punten en komma's als dec. seperator zijn toegestaan..\n\n\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\texec @main_db.dbo.SetxValRate_F \t@Code = @Code\t,@ContextID =@ContextID\t,@StartDate =@datum\t,@F =@koers\n\t\tEXEC sp_api_modal_clear\t\t\n\t\tif @Code=N'CURRENCY'\n\t\t\tbegin\n\t\t\t\tdeclare @TT nvarchar(200)=concat(N'CTHTOTALS: currency ',@ContextID,'  naar: ',@koers)\n\t\t\t\texec @main_db.dbo._Writelog @TT\n\t\t\t\tupdate T  set t.currencyXrate=@koers \n\t\t\t\tfrom xcthtotals T inner join xtransactionheader cth on cth.id=t.cth_id\n\t\t\t\twhere t.lfdate>=@datum and cth.currency_id=@contextID\n\t\t\tend\t\t\n\t\tRETURN\n\tEND\n",
            "action_id": 67,
            "action_name": "Nieuw Tarief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "movement=1 and Transport_id is null",
            "action_id": 68,
            "action_name": "Nog geen Transport",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @date nvarchar(128),@date2 nvarchar(128),@button nvarchar(128)\n--set @date = dbo.workDate()\n/*EXEC sp_api_modal_text 'Zoek op transport bedrijf'\nEXEC sp_api_modal_input @name='Transporteur',@value = @TransComp OUT,@focus=1,@select=1 -- zoek veld\n*/\nEXEC sp_api_modal_text 'Van:'\nEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-24',@focus=1,@select=1  -- zoek veld\nEXEC sp_api_modal_text 'Tot en met:'\nEXEC sp_api_modal_date @name='Date2',@value = @date2 OUT,@class='w-24' -- zoek veld\n--SET @date2 = CONCAT(@date2,' 23:59:59.999')\nSET @button = 'OpenOmpakLijst'\nEXEC sp_api_modal_button @name='button',@value = 'OpenOmpakLijst',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_button @name='button',@value = 'GeslotenOmpakLijst',@valueout = @button OUT,@class = 'btn-primary',@key = 'F2'\n\nIF @button =  'OpenOmpakLijst'\nBEGIN\nSELECT [IN/UIT], AMOUNT, DETAIL, KGN, KGB, Size, ContentDesc, BrandName, FustCode, LVO, logistic,[TID*],[cthkgninCAP*],[cthkgnin*],[seperate*],[cthkgnout CAP*],[cthkgnout*]--,Status,THTDT\nINTO #OpenOmpakLijst\nFROM          RV_OMPAKBON\nWHERE\t\t(Status = 'openRepack') AND (THTDT = 3) AND (TransactionDate BETWEEN @date AND @date2)\nEXEC sp_api_modal_table @tmptable=N'#OpenOmpakLijst',@orderby=N'ORDER BY [TID*],[cthkgninCAP*],[cthkgnin*],[seperate*],[cthkgnout CAP*],[cthkgnout*],DETAIL ASC'\nEND \n\nIF @button =  'GeslotenOmpakLijst'\nBEGIN\nSELECT [IN/UIT], AMOUNT, DETAIL, KGN, KGB, Size, ContentDesc, BrandName, FustCode, LVO, logistic,[TID*],[cthkgninCAP*],[cthkgnin*],[seperate*],[cthkgnout CAP*],[cthkgnout*]--,Status,THTDT\nINTO #GeslotenOmpakLijst\nFROM          RV_OMPAKBON\nWHERE\t\t(Status = 'closeRepack') AND (THTDT = 3) AND (TransactionDate BETWEEN @date AND @date2)\nEXEC sp_api_modal_table @tmptable=N'#GeslotenOmpakLijst',@orderby=N'ORDER BY [TID*],[cthkgninCAP*],[cthkgnin*],[seperate*],[cthkgnout CAP*],[cthkgnout*],DETAIL ASC'\nEND ",
            "action_id": 69,
            "action_name": "OMPAKBON",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select id from @main_db.dbo.CTH_Dirty_Orders())",
            "action_id": 71,
            "action_name": "Onvoltooide Orders",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE  @P nvarchar(200)\r\nSET @P=concat('/',(SELECT name FROM api_card WHERE id=@ID))\r\nEXEC sp_api_goto @path=@P",
            "action_id": 72,
            "action_name": "Open",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE  @P nvarchar(200)\nSET @P=concat('/',(SELECT name FROM api_card WHERE id=@ID))\nEXEC sp_api_goto @path=@P",
            "action_id": 74,
            "action_name": "OpenCardlist",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.CTH2INVOICE @CTHID=@ID ",
            "action_id": 75,
            "action_name": "order_factureren",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.CTH2INVOICE @CTHID=@ID ",
            "action_id": 76,
            "action_name": "order_factureren",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC @main_db.dbo.CTH2INVOICE @CTHID=@ID ",
            "action_id": 77,
            "action_name": "order_factureren",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.CTH2INVOICE @CTHID=@ID ",
            "action_id": 78,
            "action_name": "order_factureren",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @sys_report_key nvarchar(50) = N'confirmation_out'\ndeclare @test bit =1 -- 0:LIVE ; 1=TEST\nEXEC sp_api_toast @sys_report_key--N'Orderbevestiging' \n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\t\t\n\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\t--EXEC sp_api_toast @cid\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@cid)\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = @sys_report_key--'confirmation_out' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@test=@test\n\n\t\t--dit is nu alleen voor tellers en checks:\n\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'CTH'\t,@Context_Key_ID=@cid,@Report_CODE=N'CONF'\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;",
            "action_id": 79,
            "action_name": "orderbevestiging",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @sys_report_key nvarchar(50) = N'confirmation_out'\ndeclare @test bit =0 -- 0:LIVE ; 1=TEST\nEXEC sp_api_toast @sys_report_key--N'Orderbevestiging' \n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\t\t\n\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\t--EXEC sp_api_toast @cid\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@cid)\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = @sys_report_key--'confirmation_out' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@test=@test\n\n\t\t--dit is nu alleen voor tellers en checks:\n\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'CTH'\t,@Context_Key_ID=@cid,@Report_CODE=N'CONF'\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;",
            "action_id": 80,
            "action_name": "orderbevestiging",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate} < dbo.workdate()",
            "action_id": 81,
            "action_name": "oud",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate} < dbo.Workdate()",
            "action_id": 82,
            "action_name": "oud",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--text, class, translate (bit)\r\nEXEC sp_api_modal_text 'Kies Enter om de vorige prijzen te gebruiken.',@translate=1 --vertaalbaar\r\nDECLARE @button nvarchar(128) --button nodig om DECLARE oude SET nog te hebben.\r\nEXEC sp_api_modal_button @name='button',@value = 'Okay!',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter' --is initieel leeg\r\nEXEC sp_api_modal_button @name='button2',@value = 'Nah',@valueout = @button OUT,@class = 'btn-primary',@key = 'Escape' --is initieel leeg\r\nIF @button IS NULL EXEC sp_api_modal_select_all --STEP 1 SELECT all\r\n -- na klik\r\nIF @button = 'Nah' OR @button = 'Okay!'\r\n\tBEGIN\r\n\t\tEXEC sp_api_modal_clear -- einde formweergave; handel alleen nog de CURSOR af\r\n\t\tEXEC sp_api_modal_select_all_clear --STEP 2 SELECT clear all en de rest\r\n\tEND\r\nIF @button = 'Okay!'\r\n\tBEGIN\r\n\r\n\t\tDECLARE @cursor_ids CURSOR,@cid INT\r\n\t\t-- onderbreek de actie alos er meer dan 1 leverancier in DECLARE selectie voor komt\r\n\t\tif\t(SELECT count( distinct supplier_ID) FROM p_PriceEntryRow where id in (SELECT value FROM string_split(@ids,','))) > 1\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC sp_api_modal_alert N'Selecteer niet meer dan 1 leverancier!'\r\n\t\t\t\tEXEC sp_api_modal_clear \r\n\t\t\t\treturn;\r\n\t\t\tEND\r\n\r\n\t\tSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\r\n\t\tOPEN @cursor_ids;\r\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\r\n\t\tWHILE @@FETCH_STATUS = 0\r\n\t\t\tBEGIN\r\n\t\t\t\tUPDATE p_PriceEntryRow SET PriceHi = OldPriceHi, PriceLo = OldPriceLo WHERE id = @cid\r\n\t\t\t\tFETCH NEXT FROM @cursor_ids INTO @cid\r\n\t\t\tEND\r\n\t\tCLOSE @cursor_ids;\r\n\t\tDEALLOCATE @cursor_ids;\r\n\r\n\tEND\r\n\r\n",
            "action_id": 83,
            "action_name": "oude prijzen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--bewaren!\nif {[relocate].id} is null\n\tbegin\n\t\texec SP_API_MODAL_ALERT N'Dit kan alleen bij Overbrengen van goederen'\n\t\texec SP_API_MODAL_CLEAR\n\t\treturn\n\tend\n\nDECLARE @CTHID INT = {[relocate].id} --cth_id van de overbrenging\nDECLARE @xStock_ID INT ={[voorraad_op_overbrenglokatie].xStock_ID}\n--SELECT @xStock_ID = xstock_id FROM xstockLoc WHERE id=@ID\n\nIF @CTHID IS NULL \n\tbegin\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\n\t\tRETURN;\n\tend\n\n\n\nDECLARE @mes nvarchar(200)  --, @FustSaldo int, @CoreType nvarchar(10),@FustID int\n\t\t, @xDesc nvarchar(200)\nSELECT @xDesc=x.[Description],@mes= concat('Overbrengen ' , x.[Description]) --,@Coretype= x.coretype,@FustID=x.Fust_ID \n\tfrom xstock x where x.id=@xStock_ID \n--EXEC sp_api_modal_text @mes,'h2 text-primary'\n\nIF {[relocate].status} not in ('openRelocation') \n\tBEGIN \n\t\tEXEC sp_api_modal_alert 'U mag niet toevoegen OPEN deze overbrenging, want DECLARE status is ongelijk aan ''openRelocation'''\n\t\tEXEC sp_api_modal_clear\t\t\n\t\tRETURN;\t\n\tend\n\n\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\n\nDECLARE @aantal nvarchar(20) --='100'\nDECLARE @CounterpartyID int\nDECLARE @FlowModel int\nDECLARE @THDT INT\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=FlowModel_ID,@THDT=TDT From xTransactionHeader CTH where CTH.ID=@CTHID\n\n\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\n\t\tIF \tTRY_CAST(@aantal as int) >\t 0 \n\t\t\tBEGIN\n--\t\t\t\tDECLARE @mappartijregel int\n--\t\t\t\tSET @mappartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\n\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@xStock_ID,@Amount=@Aantal,@Price=NULL, @User=@User--,@mapctr_id=@mappartijregel,@Pricetype='ZERO'\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de overbrenging' from xstock x where x.id=@xStock_ID\n\t\t\t\texec sp_api_toast @mes\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal is ongeldig!','text-danger'\n\tEND\n\n",
            "action_id": 84,
            "action_name": "Overbrengen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "if {[relocate].id} is null\n\tbegin\n\t\texec SP_API_MODAL_ALERT N'Dit kan alleen bij Overbrengen van goederen'\n\t\texec SP_API_MODAL_CLEAR\n\t\treturn\n\tend\n\nDECLARE @CTHID INT = {[relocate].id} --cth_id van de overbrenging\nDECLARE @xStock_ID INT ={[voorraadlokatie].xStock_ID}\n--SELECT @xStock_ID = xstock_id FROM xstockLoc WHERE id=@ID\n\nIF @CTHID IS NULL \n\tbegin\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\n\t\tRETURN;\n\tend\n\n\n\n\n\nDECLARE @mes nvarchar(200)  --, @FustSaldo int, @CoreType nvarchar(10),@FustID int\n\t\t, @xDesc nvarchar(200)\nSELECT @xDesc=x.[Description],@mes= concat('Overbrengen ' , x.[Description]) --,@Coretype= x.coretype,@FustID=x.Fust_ID \n\tfrom xstock x where x.id=@xStock_ID \n--EXEC sp_api_modal_text @mes,'h2 text-primary'\n\nIF {[relocate].status} not in ('openRelocation') \n\tBEGIN \n\t\tEXEC sp_api_modal_alert 'U mag niet toevoegen OPEN deze overbrenging, want DECLARE status is ongelijk aan ''openRelocation'''\n\t\tEXEC sp_api_modal_clear\t\t\n\t\tRETURN;\t\n\tend\n\n\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\n\nDECLARE @aantal nvarchar(20) --='100'\nDECLARE @CounterpartyID int\nDECLARE @FlowModel int\nDECLARE @THDT INT\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=FlowModel_ID,@THDT=TDT From xTransactionHeader CTH where CTH.ID=@CTHID\n\n\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\n\t\tIF \tTRY_CAST(@aantal as int) >\t 0 \n\t\t\tBEGIN\n--\t\t\t\tDECLARE @mappartijregel int\n--\t\t\t\tSET @mappartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\n\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@xStock_ID,@Amount=@Aantal,@Price=NULL, @User=@User--,@mapctr_id=@mappartijregel,@Pricetype='ZERO'\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de overbrenging' from xstock x where x.id=@xStock_ID\n\t\t\t\texec sp_api_toast @mes\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal is ongeldig!','text-danger'\n\tEND\n\n",
            "action_id": 85,
            "action_name": "Overbrengen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @company_id nvarchar(32),@button nvarchar(128),@new_id nvarchar(32),@goto nvarchar(2000),@search nvarchar(2000)\n,@button1 nvarchar(128) = N'Nieuwe verkoop'\n,@button2 nvarchar(128) = N'Laatste open verkoop'\n\nEXEC sp_api_modal_select @card_name = N'klant',@value = @company_id OUT,@focus = 1\nIF @company_id > 0\nBEGIN\n\tEXEC sp_api_modal_button @name='button',@value=@button1,@valueout = @button OUT,@key='Insert'\n\tIF EXISTS (SELECT * FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id)\n\t\tEXEC sp_api_modal_button @name='button',@value=@button2,@valueout = @button OUT,@key='Enter'\n\n\tIF @button = @button1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'CounterParty_ID',@company_id,0\n\t\t\tEXEC @new_id = sp_api_modal_save N'verkoop',0\n\t\t\tIF @new_id > 0\n\t\t\t\tBEGIN\n\t\t\t\t\tSET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'\n\t\t\t\t\tEXEC sp_api_toast N'Nieuwe verkoop gestart',N'alert-primary'\n\t\t\t\t\tSET @search = N'?id='+@new_id\n\t\t\t\t\tEXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\t\t\tEND\n\t\t\tELSE\n\t\t\t\tEXEC sp_api_toast N'Error nieuwe verkoop',N'alert-danger'\n\t\t\tEXEC sp_api_modal_clear\n\t\tEND\n\tIF @button = @button2\n\t\tBEGIN\n\t\t\tSET @new_id = (SELECT TOP 1 id FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id ORDER BY id DESC)\n\t\t\tSET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'\n\t\t\tSET @search = N'?id='+@new_id\n\t\t\tEXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\tEND\nEND\n",
            "action_id": 86,
            "action_name": "sys_new_action",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @LinkAantal INT = {[ivhistory].LinkAantal}\nDECLARE @LinkPrice INT = {[ivhistory].iCTR_Price}\n--SET @LinkAantal = (SELECT [code_IVlinked_ctrFromTo].[LinkAantal] FROM [code_IVlinked_ctrFromTo] WHERE [id] = (SELECT id FROM #parents WHERE card_name = N'ivhistory'))\nDECLARE @ReturnAmount nvarchar(max) = @LinkAantal\nDECLARE @ReturnPrice nvarchar(max) = @LinkPrice\n,@valueout nvarchar(max) \nEXEC sp_api_modal_text N'Kies het aantal dat gecrediteerd moet worden'\nEXEC sp_api_modal_input @name='Retour colli',@max=6, @value= @ReturnAmount OUT,@focus=1\nEXEC sp_api_modal_text N'Prijs'\nEXEC sp_api_modal_input @name='Retour prijs',@max=6, @value= @ReturnPrice OUT\n\nEXEC sp_api_modal_button @name='Sure',@value = 'Boek retour', @valueout = @valueout OUT\n\t,@class='btn-primary',@key='Enter'\nIF @valueout IS NOT NULL AND TRY_CAST(@ReturnAmount as int) BETWEEN 1 AND @LinkAantal\n\tBEGIN\n\t\tEXEC sp_api_toast @ReturnAmount\n\t\tEXEC @main_db.dbo.sp_create_return_sale @id,@ReturnAmount\n\t\tEXEC sp_api_modal_clear\n\tEND\n",
            "action_id": 87,
            "action_name": "takeback",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--UPDATE xTransactionHeader SET status='openSale' WHERE id IN (SELECT * FROM string_split(@ids,','))\r\nUPDATE xTransactionHeader SET status='openSale' WHERE id IN ({@ids})",
            "action_id": 88,
            "action_name": "terug naar open verkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--UPDATE xTransactionHeader SET status='openSale' WHERE id IN (SELECT * FROM string_split(@ids,','))\r\nUPDATE xTransactionHeader SET status='openSale' WHERE id IN ({@ids})",
            "action_id": 89,
            "action_name": "terug naar open verkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--UPDATE xTransactionHeader SET status='openSale' WHERE id IN (SELECT * FROM string_split(@ids,','))\nUPDATE xTransactionHeader SET status='openSale' WHERE id IN ({@ids})\n\n",
            "action_id": 90,
            "action_name": "terug naar open verkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--UPDATE xTransactionHeader SET status='openSale' WHERE id IN (SELECT * FROM string_split(@ids,','))\r\nUPDATE xTransactionHeader SET status='openSale' WHERE id IN ({@ids})",
            "action_id": 91,
            "action_name": "terug naar open verkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC SP_API_GOTO @previous_path",
            "action_id": 92,
            "action_name": "terug naar orderkop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec sp_api_toast N'hallo'\r\n",
            "action_id": 93,
            "action_name": "test bve",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @text nvarchar(max) = {[inkoop].Counterparty_ID.Country_ID.Name_0}\r\nEXEC sp_api_modal_text @text\r\nEXEC sp_api_modal_text 'Wijzig Bruto'\r\nDECLARE @valueout nvarchar(max) = {[lotartsize].Bruto} \r\n--DECLARE @valueout nvarchar(max) = {Bruto}\r\nEXEC sp_api_modal_input @name='Naam',@max=5, @value= @valueout OUT,@focus=1\r\n{@valueout->[lotartsize].Bruto}",
            "action_id": 94,
            "action_name": "test geert",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "1 = 1 AND inPrice > 10/*Receiver_ID=@Counterparty_ID*/",
            "action_id": 95,
            "action_name": "ThisReceiver",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @TC nvarchar(50)={[verkoop2].CounterParty_ID.Currency_ID}\r\nEXEC sp_api_toast @text=@TC",
            "action_id": 96,
            "action_name": "toast_curr",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @TC nvarchar(50)={[verkoop2].CounterParty_ID.Currency_ID}\r\nEXEC sp_api_toast @text=@TC",
            "action_id": 97,
            "action_name": "toast_curr",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate} > dbo.workdate()",
            "action_id": 98,
            "action_name": "toekomst",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate} > dbo.Workdate()",
            "action_id": 99,
            "action_name": "toekomst",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @wat nvarchar(200), @LinkToME int\r\nSET @LinkToME ={[ctr1].id}\r\nIF @linkToME IS NULL RETURN;\r\n\r\nIF (SELECT (ctrAmount-IVTOTAL) FROM Q_xTransactionDetail WHERE ID=@LinkToME ) = 0 BEGIN\r\n\tEXEC sp_api_modal_alert N'Deze partijregel is al volledig verkocht (aan verkoopregels toegewezen)'\r\n\tEXEC sp_api_modal_Clear\r\n\r\n-- 200929 hier=>\tEXEC sp_api_goto @parentpath --idee? --go2\r\n\tRETURN;\r\n\tend\r\n\r\nset @wat=concat(N'MAP ID: ',@LinkToME,' aan ID: ',@ID)\r\nexec sp_api_toast @wat\r\nexec @main_db.dbo.map @ID,@LinkToME--,@ID -- link al het mogelijke\r\n",
            "action_id": 100,
            "action_name": "toewijzen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "-- {[ctr2].Amount} \r\nDECLARE @count_iv2 INT = (SELECT sum(linkaantal) FROM xIvlink WHERE ITD = @id)\r\nIF @count_iv2 <>{[ctr_coco_verkoop].Amount}*iif({[ctr_coco_verkoop].stockmut}=0,0,1)--= 0\r\nBEGIN\r\nEXECUTE sp_api_toast 'Nu volgens mij moet er iets gebeuren'\r\nEND \r\nELSE\r\nBEGIN \r\nEXECUTE sp_api_toast 'anders nu'\r\nEND \r\n/*\tSET @path = @path+'/'+@id+'/ctr1_toewijsbaar'\r\nELSE\r\n\tSET @path = @path+'/'+@id+'/iv2'\r\n\r\nEXEC sp_api_goto @path\r\n*/\r\n/*\r\n\r\n\r\n\r\nIF @count_iv2 = 0\r\n\tEXEC sp_api_keypress N'F4'\r\nELSE\r\n\tEXEC sp_api_keypress N'Alt+T'\r\n*/",
            "action_id": 101,
            "action_name": "Toewijzen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "-- {[ctr2].Amount} \n\n--EXEC sp_api_modal_set N'bewaar_kruimel_path',N'/inkoop' --@path\n--EXEC sp_api_modal_set N'bewaar_kruimel_search',N'?id=123' --@path\nif {[ctr2].Amount} is not null --we zitten op ctr2\n\tbegin\n\n\t\tDECLARE @count_iv2 INT = (SELECT sum(linkaantal) FROM xIvlink WHERE ITD = @id or vtd = @id)-- RH210116 OR vtd.. er bij (er was een overmatige toewijzing)\n\t\tDECLARE @DIFF INT \n\t\tset @DIFF=\t( select isnull({[ctr2].Amount}*iif({[ctr2].stockmut}=0,0,1),0) - @count_iv2)\n\t\tEXEC SP_API_TOAST @diff\n\t\tIF ISNULL(@count_iv2,0)=0 or @DIFF > 0 --@count_iv2 <>isnull({[ctr2].Amount}*iif({[ctr2].stockmut}=0,0,1),0)--= 0\n\t\t\tBEGIN\n\t\t\t\tIF NOT EXISTS (select * from @main_db.dbo.ctr1_Assignable(NULL,@id))\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_alert N'Geen partij met voorraad beschikbaar!'\n\t\t\t\t\t\tEXEC sp_api_modal_clear\n\t\t\t\t\t\tRETURN\n\t\t\t\t\tEND\n\t\t\t\tSET @path = @path+'/'+@id+'/ctr1_toewijsbaar'\n\t\t\tEND\n\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tIF @DIFF < 0 -- meer toegewezen dan de ctr groot is\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_alert N'Er is te veel toegewezen!, verlaag de toewijzing of verwijder een toewijzing!'\t\n\t\t\t\t\tEND\t\n\t\t\t\tSET @path = @path+'/'+@id+'/iv2'\n\t\t\tEND\n\t\n\t\tEXEC sp_api_goto @path\n\tend\n\nelse\n EXEC SP_API_TOAST @card_name\n\n/*\n\n\n\nIF @count_iv2 = 0\n\tEXEC sp_api_keypress N'F4'\nELSE\n\tEXEC sp_api_keypress N'Alt+T'\n*/\n\n/* WAS: \n-- {[ctr2].Amount} \n\n--EXEC sp_api_modal_set N'bewaar_kruimel_path',N'/inkoop' --@path\n--EXEC sp_api_modal_set N'bewaar_kruimel_search',N'?id=123' --@path\nif {[ctr2].Amount} is not null --we zitten op ctr2\n\tbegin\n\n\t\tDECLARE @count_iv2 INT = (SELECT sum(linkaantal) FROM xIvlink WHERE ITD = @id)\n\t\t--EXEC SP_API_TOAST @count_iv2\n\t\tIF ISNULL(@count_iv2,0)=0 or @count_iv2 <>isnull({[ctr2].Amount}*iif({[ctr2].stockmut}=0,0,1),0)--= 0\n\t\t\tBEGIN\n\t\t\t\tIF NOT EXISTS (select * from @main_db.dbo.ctr1_Assignable(NULL,@id))\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_alert N'Geen partij met voorraad beschikbaar!'\n\t\t\t\t\t\tEXEC sp_api_modal_clear\n\t\t\t\t\t\tRETURN\n\t\t\t\t\tEND\n\t\t\t\tSET @path = @path+'/'+@id+'/ctr1_toewijsbaar'\n\t\t\tEND\n\t\tELSE\n\t\t\tSET @path = @path+'/'+@id+'/iv2'\n\t\t\n\t\tEXEC sp_api_goto @path\n\tend\n\nelse\n EXEC SP_API_TOAST @card_name\n\n*/",
            "action_id": 102,
            "action_name": "Toewijzen/Toewijzing",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "-- {[ctr2].Amount} \nDECLARE @count_iv2 INT = (SELECT sum(linkaantal) FROM xIvlink WHERE ITD = @id)\nIF @count_iv2 <>{[ctr2].Amount}*iif({[ctr2].stockmut}=0,0,1)--= 0\n\tSET @path = @path+'/'+@id+'/ctr1_toewijsbaar'\nELSE\n\tSET @path = @path+'/'+@id+'/iv2'\n\nEXEC sp_api_goto @path\n/*\n\n\n\nIF @count_iv2 = 0\n\tEXEC sp_api_keypress N'F4'\nELSE\n\tEXEC sp_api_keypress N'Alt+T'\n*/",
            "action_id": 103,
            "action_name": "Toewijzing",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--\t201124 let op: dit is de simpele verkoop indicator wissel voor direct.. \n--;\tBij inkloop is dit veel complexer!! \ndeclare @Direct int\nselect @Direct=iif(isnull(Flowmodel_ID,2)=2,1,NULL) from xtransactiondetail where id=@ID\nupdate xtransactiondetail set Flowmodel_id=@Direct where id=@ID\n",
            "action_id": 104,
            "action_name": "Direct wel/niet",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "set @testmodus =1 --0=live; 1=test!\n\nEXEC sp_api_toast N'Transport-instructie naar Transporteur' \nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\t\t\n\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_toast @cid\n\t\t--dit is nu alleen voor tellers en checks:\n\n\t\t--even niet registreren dat er wordt afgedrukt\n\t\t--EXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'LF'\t,@Context_Key_ID=@cid,@Report_CODE=N'TRANSPORT' --transportorder\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = {[xlandfreight].transportCompany_ID}\n\t\t--DECLARE @error INT\n\t\t\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = 'transport-out' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@test=@testmodus\n\t\t\t\n\t\t--IF @error > 0 RAISERROR(N'Er is een probleem')\n\t\t\n\t\t--set @reptxt=concat(N'to transporter: ',@toCompany_ID)\n\t\t--execute sp_api_toast @reptxt\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;",
            "action_id": 105,
            "action_name": "Transportorder",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "movement=1 and TDT=2 and datum >= dbo.workdate()",
            "action_id": 106,
            "action_name": "Uitgaand vandaag++",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @T nvarchar(100)\r\nSET @T=N'Zet de setting UseCalculator op de default lokatie van '+(SELECT companyname FROM xcompany WHERE id=@ID)+' AAN'\r\nEXEC sp_api_toast @T\r\nupdate xlocation SET useCalculator=1 WHERE company_ID=@ID AND isdefault=1",
            "action_id": 107,
            "action_name": "Use Calculator",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(2000),@CalendarID INT\r\nSELECT @CalendarID = CalendarID FROM abcCalendar WHERE [Date] = dbo.abcdate()\r\nSET @search=N'?id=' + dbo.nv(@CalendarID)\r\nEXEC sp_api_goto @path,@search",
            "action_id": 108,
            "action_name": "vandaag",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "moment >= dbo.abcdate() --AND {[xpricemoment].Moment}<=getdate()",
            "action_id": 109,
            "action_name": "Vandaag",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "touchday=(select @main_db.dbo.getdoy(0))",
            "action_id": 110,
            "action_name": "Vandaag",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "TransportDate=dbo.abcdate() ",
            "action_id": 111,
            "action_name": "Vandaag",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "lfDate>=dbo.abcdate() and lfDate < dbo.abcdate()+1 --WENS: graag dbo.workdate(@User_ID) ALTIJD mogelijk maken, dus bijv. ook in lijst",
            "action_id": 113,
            "action_name": "Vandaag(werkdatum)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "lfDate>=dbo.abcdate() and lfDate < dbo.abcdate()+1 --WENS: graag dbo.workdate(@User_ID) ALTIJD mogelijk maken, dus bijv. ook in lijst",
            "action_id": 114,
            "action_name": "Vandaag(werkdatum)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "lfDate>=dbo.abcdate() and lfDate < dbo.abcdate()+1 --WENS: graag dbo.workdate(@User_ID) ALTIJD mogelijk maken, dus bijv. ook in lijst",
            "action_id": 115,
            "action_name": "Vandaag(werkdatum)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @Origin_Code nvarchar(max) = {[xstock].Origin_Code}\nDECLARE @ContentDesc nvarchar(max) = {[xstock].ContentDesc}\nDECLARE @Description nvarchar(max) = {[xstock].Description} \nDECLARE @xProduct_ID nvarchar(max) = {[xstock].xProduct_ID}  \nDECLARE @Size nvarchar(max) = {[xstock].Size}\n\nDECLARE @search nvarchar(max) = N'?filter=detail.swhas(+'+@Description+'),contentdesc.swhas(+'+@ContentDesc+'),origin_code.swhas(+'+@Origin_Code+'),size.swhas(+'+@Size+')'\nSET @path+='/'+@id+'/ctr_editor'\nEXEC sp_api_goto @path,@search\n",
            "action_id": 116,
            "action_name": "verkocht",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 117,
            "action_name": "Verkoop vanaf lokatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 118,
            "action_name": "Verkoop vanaf lokatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "IF EXISTS (SELECT * FROM Q_xtransactionheader where DeliveryCode_ID = 2 and id IN ({@ids})) AND NOT EXISTS (SELECT * FROM Q_xCostRegistration WHERE (syskey_id = 2000 OR syskey_id = 10001000) AND Transaction_ID IN ({@ids}))\nBEGIN\n\tEXEC sp_api_modal_alert N'Let op!',N'\u00c9\u00e9n van de geselecteerde verkoop orders heeft een aflevermethode Franko. U dient eerst vracht kosten te boeken via de Workflow!'\n\tEXEC sp_api_modal_clear\n\tRETURN\nEND\n\nupdate xtransactionheader set status ='ReadyForInvoice' where id IN ({@ids})\nEXEC sp_api_toast N'verkoop is gesloten'",
            "action_id": 119,
            "action_name": "verkoop_sluiten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "update xtransactionheader set status ='ReadyForInvoice' where id IN(select * FROM string_split(@IDS,','))\nEXEC sp_api_toast N'verkoop is gesloten'\nexec sp_api_modal_select_all_clear -- wis de selectie (SvR 210115)",
            "action_id": 120,
            "action_name": "verkoop_sluiten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "update xtransactionheader set status ='ReadyForInvoice' where id IN(select * FROM string_split(@IDS,','))\r\nEXEC sp_api_toast N'verkoop is gesloten'",
            "action_id": 121,
            "action_name": "verkoop_sluiten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "update xtransactionheader set status ='ReadyForInvoice' where id IN(select * FROM string_split(@IDS,','))\nEXEC sp_api_toast N'verkoop is gesloten'\nexec sp_api_modal_select_all_clear -- wis de selectie (SvR 210115)",
            "action_id": 122,
            "action_name": "verkoop_sluiten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "/*\nUpdate xtransactiondetail set amount = 0, price = 0 where id = @id\n\nEXEC @main_db.dbo.DeleteCTR @ID\n*/\n/*\nIF {[verkoop].status} NOT IN ('openSale')\n\tBEGIN\n\t\tEXEC sp_api_toast N'Status is not openSale!'\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_alert N'Zeker weten?',N'Het aantal wordt op 0 gezet, en daarna geheel verwijderd!'\nUPDATE xTransactionDetail SET amount = 0 WHERE id = @id\nEXEC @main_db.dbo.DeleteCTR @ID\nEXEC sp_api_toast N'Regel verwijderd'\nEXEC sp_api_modal_clear\n*/\nDECLARE @TH_ID int, @button nvarchar(128)\nSET @TH_ID = {[ctr2].TransactionHeader_ID}\n\nEXEC sp_api_modal_alert N'Zeker weten?',N'Het aantal wordt op 0 gezet, en daarna geheel verwijderd!'\nDECLARE @cursor CURSOR,@idval INT\nSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor;\nFETCH NEXT FROM @cursor INTO @idval\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\n\t\tDECLARE @detail nvarchar(255), @detaildelete nvarchar(255), @detailwarning nvarchar(255)\n\t\tSET @detail = (SELECT concat(Amount,' ',detail) from q_xtransactiondetail where id = @idval)\n\t\tSET @detaildelete = concat('Het transport(Pallet/Landfreight) staat op \"Departed\". U kan ',@detail,' niet verwijderen.')\n\t\tSET @detailwarning = concat('Een deel van deze regel is reeds klaargezet, Informeer de loods indien u het artikel verwijdert ',@detail,' Druk op \"OK\"(Enter) om het artikel te verwijderen')\n\t\nIF (SELECT COUNT(ID) FROM xlfctr WHERE CTR_ID = @idval AND LF_ID IN (SELECT id FROM xLandfreight WHERE STATUS = 'Departed' AND id = xlfctr.LF_ID)) > 0 /*EXISTS (SELECT id FROM xLandfreight WHERE STATUS = 'Departed' AND id = LF_ID)) > 0 */\nAND (SELECT COUNT(ID) FROM xlfctr WHERE CTR_ID = @idval AND LF_ID IN (SELECT id FROM xLandfreight WHERE STATUS = 'Loading' AND id = xlfctr.LF_ID)) = 0 /*EXISTS (SELECT id FROM xLandfreight WHERE STATUS = 'Loading' AND id = LF_ID)) = 0 */\n\tBEGIN\n\t\tEXEC sp_api_modal_Alert N'Let op!',@detaildelete\n\t\t--EXEC sp_api_modal_clear\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\tCONTINUE\n\t\tRETURN\n\tEND\n\t\nIF (SELECT COUNT(ID) FROM xlfctr WHERE CTR_ID = @idval AND LF_ID IN (SELECT id FROM xLandfreight WHERE STATUS = 'Loading' AND i_away = 1 AND id = xlfctr.LF_ID)) > 0 /*EXISTS (SELECT id FROM xLandfreight WHERE STATUS = 'Loading' AND i_away = 1 AND id = LF_ID)) > 0 AND {[verkoop].status} = 'OpenSale'*/\n\tBEGIN\n\tEXEC sp_api_modal_Alert N'Let op!',@detailwarning\n\tEND\n\n\t\tSET @TH_id = (SELECT transactionheader_id from q_xtransactiondetail where id = @idval)\n\t\tDECLARE @textlog nvarchar(255) = concat(N'actie [Verwijder] gestart op order: ',@TH_id,' op product: ',@detail)\n\t\tEXEC @main_db.dbo.actielog @Card_name , @textlog\n\t\t\n\t\tEXEC @main_db.dbo.DeleteCTR @idval\n\t\t\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\tEND\nCLOSE @cursor;\nDEALLOCATE @cursor;\nEXEC sp_api_modal_clear\nEXEC sp_api_modal_select_all_clear\n",
            "action_id": 123,
            "action_name": "Verwijder",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "SP_API_MODAL_ALERT 'LET OP!','U gaat een bedrijf verwijderen. Weet u het zeker? Druk OK(ENTER) om door te gaan.'--,@key = 'F1'\nexec @main_db.dbo.DeleteCompany @ID\nEXEC sp_api_modal_clear\nEXEC sp_api_modal_select_all_clear",
            "action_id": 124,
            "action_name": "verwijder bedrijf",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "UPDATE xTransactionHeader SET status = N'ReadyForInvoice' WHERE id IN (SELECT DISTINCT cth_id FROM xInvRow WHERE invoice_id=@ID)\ndelete FROM xinvrow WHERE invoice_id=@ID\n",
            "action_id": 125,
            "action_name": "Verwijder de regels_voor210112",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @delresult int\nexec @DelResult=@main_db.dbo.[Delete_LF_IF_NO_LFCTR] @ID\nif @DelResult = -1\n\texec sp_api_Toast N'Er kan geen landfreight worden verwijderd, omdat er nog detailregels bestaan'\nEXEC sp_api_go2\n",
            "action_id": 126,
            "action_name": "Verwijder Landfreight",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "if not exists(select id from xstock where xproduct_id = @ID) -- multi maken?\n\tbegin\n\t\tdelete from xlotartsize where xproduct_id =@ID\t--210424\n\t\tdelete from xlotartmodel where xproduct_id =@ID\t--210424\n\t\tdelete from xproductlang where xproduct_id =@ID\n\t\tdelete from xproduct where id =@ID\n\tend\nelse exec sp_api_toast N'U mag niet verwijderen, er bestaan artikelen in xStock'",
            "action_id": 128,
            "action_name": "Verwijder product",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.DeleteCTR @ID ",
            "action_id": 129,
            "action_name": "Verwijder_CTR",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.DeleteCTH @ID ",
            "action_id": 131,
            "action_name": "Verwijder_Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.DeleteCTH @ID",
            "action_id": 132,
            "action_name": "Verwijder_Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC @main_db.dbo.DeleteCTH @CTHID=@ID\r\nDECLARE @cursor_ids CURSOR,@cid INT\r\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\r\nOPEN @cursor_ids;\r\nFETCH NEXT FROM @cursor_ids INTO @cid\r\nWHILE @@FETCH_STATUS = 0\r\n\tBEGIN\r\n\t\tEXEC @main_db.dbo.DeleteCTH @CTHID=@cID -- delete enkel id\r\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\r\n\tEND\r\nCLOSE @cursor_ids;\r\nDEALLOCATE @cursor_ids;",
            "action_id": 133,
            "action_name": "Verwijder_Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC @main_db.dbo.DeleteCTH @CTHID=@ID\r\nDECLARE @cursor_ids CURSOR,@cid INT\r\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\r\nOPEN @cursor_ids;\r\nFETCH NEXT FROM @cursor_ids INTO @cid\r\nWHILE @@FETCH_STATUS = 0\r\n\tBEGIN\r\n\t\tEXEC @main_db.dbo.DeleteCTH @CTHID=@cID -- delete enkel id\r\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\r\n\tEND\r\nCLOSE @cursor_ids;\r\nDEALLOCATE @cursor_ids;",
            "action_id": 134,
            "action_name": "Verwijder_Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.DeleteCTH @ID ",
            "action_id": 135,
            "action_name": "Verwijder_Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "Update xtransactiondetail set amount = 0, price = 0 where id = @id\r\n\r\nEXEC @main_db.dbo.DeleteCTR @ID ",
            "action_id": 136,
            "action_name": "Verwijder_regel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "delete FROM xPriceMoment WHERE 1=1",
            "action_id": 137,
            "action_name": "VerwijderAllePrijsmomenten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 138,
            "action_name": "Vessel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<>0",
            "action_id": 139,
            "action_name": "Voorraad <> 0",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "supplier_id in (select id from xtenantkey)",
            "action_id": 140,
            "action_name": "Voorraad Beprijzen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--210629 RH BUSY !! koppel de ctr aan de customsrow van deze order (als die bestaat)\nupdate Q_xtransactiondetail set cthCustomsRows_ID ={[xcthcustomsrows].id} \n\twhere ID=@ID  --belangrijk alleen deze ctr!\n\t\tAND\tcthCustomsRows_ID is null \n\t\t--AND xproduct_ID={[xcthcustomsrows].xProduct_ID} \n\t\tAND  transactionHeader_ID={[xcthcustomsrows].CTH_ID} \n\t\t",
            "action_id": 141,
            "action_name": "Add Orphans",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_post @card = N'apicard',@column=N'unparsed_crud_create',@value=N'dbo.hasRole(''admin'') > 0',@id=@id\nEXEC sp_api_modal_post @card = N'apicard',@column=N'unparsed_crud_read',@value=N'dbo.hasRole(''admin'') > 0',@id=@id\nEXEC sp_api_modal_save @card = N'apicard',@id=@id",
            "action_id": 142,
            "action_name": "Admin Only",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @cth_id INT \r\nSET @cth_id = {[inkoop].id}\r\nEXEC @main_db.dbo.sp_Uitlossen_CTH @cth_id",
            "action_id": 143,
            "action_name": "AllesUitlossen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "update xlandfreight SET transport_ID={[transport].id} WHERE xlandfreight.Transport_ID is null AND (xlandfreight.Transportcompany_ID={[transport].transporter_ID} OR xlandfreight.Transportcompany_ID is null)",
            "action_id": 144,
            "action_name": "Auto Add Landfreight",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @NewID INT, @Endtxt nvarchar(200)\nexec @newID=@main_db.dbo.Create_CTR_ForOwnNegativeStock_CTH @CTH_ID=@ID\nif @newID is not NULL\n\tbegin\n\t\tset @EndTxt= N''+str(@newID)+N' regels toegevoegd aan de inkoop.'\n\t\texec sp_api_toast @text=@endtxt\n\tend",
            "action_id": 145,
            "action_name": "auto-inkoop-neg-stock",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xbol'\r\n",
            "action_id": 146,
            "action_name": "B/L",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 147,
            "action_name": "Back",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 148,
            "action_name": "Back",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock <> 0 or (id in (select DISTINCT Stock_id from p_PriceentryRow where activeCount >0 AND (pricehi<>0 OR pricelo<>0))) /*combi stock of prijs met recent:*/\r\nOR\r\nDATEDIFF(day,lastUsed, GetDate()) < 14 /* in de laatste 2 weken gebruikt */",
            "action_id": 149,
            "action_name": "Basisfilter troost",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text 'Calculator',N'mt-4 h5'\r\nDECLARE @calc nvarchar(256) = '0',@button nvarchar(128),@result nvarchar(1000),@sql nvarchar(1000)\r\nEXEC sp_api_modal_input @name='calc',@value = @calc OUT,@focus=1,@select=1\r\n\r\nEXEC sp_api_modal_button @name='button',@value = 'Bereken',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\nBEGIN TRY\r\n\r\nDECLARE @KeepValues nvarchar(50) = N'%[^0-9+*/().-]%'\r\n    While PATINDEX(@KeepValues, @calc) > 0\r\n        Set @calc = Stuff(@calc, PatIndex(@KeepValues, @calc), 1, '')\r\n\tSET @result = @calc +' = '\r\n\tSET @sql = N'SET @calc = TRY_CAST((1.0*'+@calc+') as decimal(18,2))'\r\n\tSET @calc = 0\r\n\tEXEC sp_executesql @sql,N'@calc decimal(18,2) OUT',@calc OUT\r\n\tSET @result+= @calc\r\nEND TRY BEGIN CATCH\r\n\tSET @result+= 'Err'\r\n END CATCH\r\nEXEC sp_api_modal_text @result\r\n",
            "action_id": 150,
            "action_name": "Calculator",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--update xlfctr SET ischecked=iif(ischecked=0,1,0) WHERE id=@ID;\n--EXEC sp_api_toast 'LFCTR Check gewijzigd'\nDECLARE @idval int, @docdesc nvarchar(128)\n\n-- CVG 21/10/19 Controleer of de LFCTR reeds al gelinkt is aan een verkoop welke niet meer status \"openSale\" heeft. Indien dit zo is mag ik niet meer ge unchecked worden.\nIF EXISTS (SELECT TOP 100 * FROM xIVLINK IVL WHERE EXISTS (SELECT * FROM Q_xTransactionDetail ctr where \nEXISTS (SELECT * FROM xTransactionHeader cth WHERE cth.[status] != 'openSale' AND id = ctr.transactionheader_id) \nAND ctr.id = IVL.ITD AND IVL.VTD IN (SELECT CTR_ID FROM XLFCTR WHERE ischecked = 1 AND ID IN ({@ids})))) \n\tBEGIN\n\tEXEC sp_api_modal_alert N'LET OP!',N'Regels zijn reeds toegewezen aan een verkoop welke niet meer de status \"openSale\" heeft. U kan de regel niet meer van \"checked\" afhalen.'\n\tEXEC sp_api_modal_clear\n\tRETURN\n\tEND\n\t\nIF {[inkomende_landfreight].To_Location_ID} IN (SELECT ID FROM xLocation WHERE isEntrepot = 1)\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'De regel wordt gelost op een transito lokatie!',N'Enkel (Richard of Sabine mogen dit uitlossen!)'\n\t\tEXEC sp_api_modal_clear\n\t\tRETURN\n\tEND\n\nDECLARE @cursor_xLFCTR CURSOR\n\nIF EXISTS (SELECT * FROM xlfctr where id IN ({@ids}) AND ischecked = 0)\n\tBEGIN\n\t\tSET @action = 1\n\tEND\nELSE\n\tBEGIN\n\t\tSET @action = 0\n\t\tIF {[inkomende_landfreight].id} is not null\n\t\tBEGIN\n\t\tUPDATE XLANDFREIGHT SET i_selected = 0 where ID = {[inkomende_landfreight].id}\n\t\tEND\n\tEND\n\nIF @action = 0 AND EXISTS (SELECT * FROM xlfctr where id IN ({@ids}) AND ischecked = 1)\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'Deze geselecteerde regels staan al op checked:'\n\t\tSET @cursor_xLFCTR = CURSOR LOCAL FAST_FORWARD FOR SELECT id FROM xlfctr where id IN ({@ids}) AND ischecked = 1\n\t\tOPEN @cursor_xLFCTR;\n\t\tFETCH NEXT FROM @cursor_xLFCTR INTO @idval\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\n\t\t\t\tSET @text = (SELECT docDescription FROM xlfctr where id = @idval)\n\t\t\t\tEXEC sp_api_modal_text @text\n\t\t\t\tFETCH NEXT FROM @cursor_xLFCTR INTO @idval\n\t\t\tEND\n\t\tCLOSE @cursor_xLFCTR;\n\t\tDEALLOCATE @cursor_xLFCTR;\n\t\tEXEC sp_api_modal_button @name='@button',@value = 'Doorgaan', @valueout = @button OUT,@class='btn-danger',@key='Enter'\n\t\tIF @button IS NULL RETURN\n\tEND\n\t\n\tSET @cursor_xLFCTR = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\n\tOPEN @cursor_xLFCTR;\n\tFETCH NEXT FROM @cursor_xLFCTR INTO @idval\n\tWHILE @@FETCH_STATUS = 0\n\t\tBEGIN\n\t\t\t--IF (SELECT ischecked FROM xlfctr where id = @idval) = 0\n\t\t\t--BEGIN\n\t\t\t\tUPDATE xlfctr SET ischecked = @action WHERE id = @idval\n\t\t\t\t/*\n\t\t\t\tEXEC sp_api_modal_post N'xlfctr',N'ischecked',@action,@idval\n\t\t\t\tEXEC sp_api_modal_save N'xlfctr',@idval\n\t\t\t\t*/\n/*\t\t\tEND\n\t\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tSET @docdesc = concat('Een geselecteerde regel staat al op checked zie: ',(SELECT docDescription FROM xlfctr where id = @idval))\n\t\t\t\tEXEC sp_api_modal_alert N'Zeker weten?',@docdesc\n\t\t\t\tEXEC sp_api_modal_post N'xlfctr',N'ischecked',0,@idval\n\t\t\t\tEXEC sp_api_modal_save N'xlfctr',@idval\n\t\t\tEND\n*/\n\t\t--UPDATE xlfctr SET ischecked=iif(ischecked=0,1,0) WHERE id=@ID;\n\t\t\t\n\t\tFETCH NEXT FROM @cursor_xLFCTR INTO @idval\n\t\tEND\nCLOSE @cursor_xLFCTR;\nDEALLOCATE @cursor_xLFCTR;\n\nEXEC sp_api_modal_clear\nEXEC sp_api_modal_select_all_clear\n",
            "action_id": 151,
            "action_name": "CheckUncheck",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 152,
            "action_name": "Children",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 153,
            "action_name": "Children",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @days nvarchar(32) = 7,@button nvarchar(32)\nEXEC sp_api_modal_input @name='Days',@max=5, @value= @days OUT,@focus=1,@select=1\n\nDECLARE @text nvarchar(max) = N'Completed tasks (without errors) older then '+@days+' days will be cleaned'\nEXEC sp_api_modal_text N'Clean Tasks',N'h4 text-muted'\nEXEC sp_api_modal_text @text,N'm-4 text-muted'\nEXEC sp_api_modal_button @name='Remove',@value = 'Clean', @valueout = @button OUT,@class='btn-danger',@key='Enter'\n\nIF TRY_CAST(@days as INT) IS NOT NULL AND @button IS NOT NULL\n\tBEGIN\n\t\tDELETE FROM api_sql_tasks WHERE DATEDIFF(day, completed, GETDATE()) > (@days-1)\n\t\tEXEC sp_api_modal_clear\n\tEND",
            "action_id": 154,
            "action_name": "Clean Tasks",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @set nvarchar(max) = N'name=name+''_clone''' -- CUSTOMIZE THIS!!!\n\nEXEC sp_api_modal_alert N'Clone',N'Create a clone of this record?'\nDECLARE @clone_id nvarchar(32)\nEXEC @clone_id = sp_clone_record @basetable,@ids,@set=@set\nEXEC sp_api_modal_clear\nSET @path = @path+'/'+@clone_id\nEXEC sp_api_modal_text N'Record cloned',N'h4 text-muted'\nEXEC sp_api_modal_route @name = N'Go to clone',@pathname=@path,@key='Enter'\n",
            "action_id": 155,
            "action_name": "clone",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 156,
            "action_name": "clone",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec dbo.sp_clone_record N'xLotArtSize', @ID, 'Size=NULL, xBrand_ID = NULL ' --Name_1=null,Name_0=Name_0+''_rick'',[FreeText] = 0-CAST(CountryNumber as int)'\r\n --",
            "action_id": 157,
            "action_name": "Clone",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text N'F*ck Off','h1'\r\nRETURN\r\nDECLARE @clone_id INT, @sure nvarchar(255), @text nvarchar(255)\r\nEXEC sp_api_modal_get N'my_last_clone_id',@text OUT\r\nEXEC sp_api_modal_text @text,'h1'\r\nEXEC sp_api_modal_text @basetable,'h1'\r\nEXEC sp_api_modal_button @name='Sure',@value = 'Clone? (Esc=Nee)', @valueout = @sure OUT,@class='btn-danger',@key='Enter'\r\nIF @sure is not null\r\n\tBEGIN\r\n\t\tEXEC sp_api_modal_clear\r\n\t\tEXEC @clone_id = sp_clone_record @basetable,@ids\r\n\t \t--\tvoorbeeld met veld veranderen in de clone \r\n\t\t--\tEXEC @clone_id = sp_clone_record @basetable,@ids,N'size=null'\r\n\t\tSET @path = @path+'/'+dbo.nv(@clone_id)\r\n\t\tEXEC sp_api_toast @text = N'Record cloned'\r\n\t\tEXEC sp_api_modal_route @name = N'Go to Clone?',@pathname=@path ,@class = N'btn-danger' ,@key='Enter'\r\n\tEND\r\n\r\n/*\r\n-- OLD CLONE METHOD\r\nDECLARE @clone_id INT, @sure nvarchar(255), @goto nvarchar(255)\r\n\r\nEXEC sp_api_modal_button @name='Sure',@value = 'Clone? (Esc=Nee)', @valueout = @sure OUT,@class='btn-danger',@key='Enter'\r\nIF @sure is not null\r\n\tBEGIN\r\n\t\tEXEC sp_api_modal_button @name='Goto',@value = 'Go to Clone?', @valueout = @goto OUT,@class='btn-danger',@key='Enter'\r\n\t\tIF @goto is null\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC @clone_id = sp_clone_record @tablename,@ids\r\n\t\t\t\tEXEC sp_api_modal_set N'my_last_clone_id',@clone_id\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC sp_api_modal_get N'my_last_clone_id',@clone_id OUT\r\n\t\t\t\tSET @path = @path+'/'+dbo.nv(@clone_id)\r\n\t\t\t\tEXEC sp_api_goto @path\r\n\t\t\tEND\r\n\tEND\r\n*/",
            "action_id": 158,
            "action_name": "clone",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.[dbo].[CloseCTH8] @ID",
            "action_id": 159,
            "action_name": "Close Relocation",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'CMR afdrukken' \n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\t\t\n\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_toast @cid\n\t\t--dit is nu alleen voor tellers en checks:\n\n\t\t--even niet registreren dat er wordt afgedrukt\n\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'LF'\t,@Context_Key_ID=@cid,@Report_CODE=N'CMR'\n\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select top 1 id from xTenantKey) -- een CRM wordt naar tenant gestuurd/geprint\n\t\t--DECLARE @error INT\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = 'cmr' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\n\t\t--IF @error > 0 RAISERROR(N'Er is een probleem')\n\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;",
            "action_id": 160,
            "action_name": "CMR",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_alert N'COCO'\r\nEXEC sp_api_modal_clear\r\nEXEC sp_api_toast @ID\r\n\r\nIF {[verkoop2].status} not in ('openSale') BEGIN\r\n\tEXEC sp_api_modal_alert 'Toevoegen alleen bij status: openSale'\r\n\tEXEC sp_api_modal_clear\t\t\r\n\tRETURN;\t\r\n\tend",
            "action_id": 161,
            "action_name": "coco alert",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT distinct counterparty_id FROM xtransactionheader) ",
            "action_id": 164,
            "action_name": "CompaniesWithOrders",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT distinct counterparty_id FROM xtransactionheader) ",
            "action_id": 165,
            "action_name": "CompaniesWithOrders",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC sp_api_toast @Parent_ID\nDECLARE @COPYFROMCOMPANY INT, @button nvarchar(200)\nEXEC sp_api_modal_select @card_name = N'adres',@value = @COPYFROMCOMPANY OUT,@focus = 1\n\nEXEC sp_api_modal_button @name='@button',@value = 'Opslaan', @valueout = @button OUT,@class='btn-danger',@key='Enter'\nIF @button IS NOT NULL \nBEGIN\n\tEXEC @main_db.dbo.SP_CopyCostSettings @FromCompany= @COPYFROMCOMPANY, @ToCompany = @Parent_ID\n\tEXEC sp_api_modal_clear\nEND",
            "action_id": 166,
            "action_name": "Copy Csettings from Other Company",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @NEWID INT\r\n--201007 herschrijf DECLARE size als dze niet in overeenstemming is met DE lot art size\r\nDECLARE @lasSize nvarchar(20) =(SELECT size FROM xlotartsize WHERE id=(SELECT xLotArtSize_ID FROM xlotpallets WHERE id=@ID))\r\nIF (SELECT rsize FROM xlotpallets WHERE id=@ID) <> @lasSize\r\n\tBEGIN\r\n\t\tupdate xlotpallets SET LinkedStockID = NULL, rsize=@lasSize WHERE id=@ID\r\n\tend\r\nIF 1=1 --(SELECT CTRS FROM Q_xLotpallets WHERE id=@ID)=0 \r\n\tBEGIN\r\n\r\n\t\tEXEC @NEWID=@main_db.dbo.SP_IINE_xStock_LP @ID\r\n\t\t-- binnen SP_IINE_xStock_LP wordt het stock_id gekoppeld aan DE LP als er maar precies 1 stock_id mogelijk is\r\n\tend\r\n\r\nELSE\r\n\tEXEC sp_api_toast 'CTRS moet op 0 staan. Zorg tevens dat u een unieke combinatie van velden heeft.'\r\n",
            "action_id": 167,
            "action_name": "Create StockID",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "UPDATE xmoment SET FetchPrices=1 WHERE ID= @ID\r\nEXEC sp_api_toast 'TIMER TAAK IS GEMAAKT!'\r\n--dit doet SP_AGFX nu: exec dbo.sp_CreatePriceMoment_For_Moment @MomentID\r\n--SET @TX2= (SELECT count(*) FROM tpwComm)",
            "action_id": 168,
            "action_name": "CreateMoment",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select id from @main_db.dbo.CTH_ADV_Transporters())",
            "action_id": 169,
            "action_name": "CTH_ADV_Transporters",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @R nvarchar(50),@P nvarchar(50),@ctrID int\r\nSET @ctrID={[lotpallets].linkedctrid}\r\nIF @ctrID is null BEGIN\r\n\tEXEC sp_api_Toast N'ER IS NOG GEEN CTR'\r\n\tEND\r\nELSE BEGIN\r\n\tSET @P=concat(N'/view_ctr1/',@ctrID)\r\n\tEXEC sp_api_goto @P\r\nEND ",
            "action_id": 170,
            "action_name": "CTR1",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @text nvarchar(max) = {[verkoop].status}--Counterparty_ID.CompanyName\r\nEXEC sp_api_toast @text ",
            "action_id": 171,
            "action_name": "curlytest",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xcustomsoffice'",
            "action_id": 172,
            "action_name": "CustomsOffice",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.SP_Curs_SwapDelayCTH @ID",
            "action_id": 175,
            "action_name": "Delayed On/Off",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.DeleteCompany @ID ",
            "action_id": 176,
            "action_name": "Delete Company",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.DeleteCompany @ID",
            "action_id": 177,
            "action_name": "Delete Company",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.DeleteLocation @ID",
            "action_id": 179,
            "action_name": "Delete Location",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "/*EXEC sp_api_modal_alert N'Delete',N'Regel(s) verwijderen?'\nDECLARE @cursor CURSOR,@idval INT\nSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor;\nFETCH NEXT FROM @cursor INTO @idval\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\t--DECLARE @task nvarchar(max) = CONCAT('UPDATE xtransactiondetail set amount = 0, price = 0 where id = ',@idval,';EXEC @main_db.dbo.DeleteCTR ',@idval)\n\t\t--EXEC sp_api_add_sql_task @task\n\t\t--Update xtransactiondetail set amount = 0, price = 0 where id = @idval\n\t\tEXEC @main_db.dbo.DeleteCTR @idval\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\tEND\nCLOSE @cursor;\nDEALLOCATE @cursor;\nEXEC sp_api_modal_clear\nEXEC sp_api_modal_select_all_clear\n*/\n\nIF EXISTS (SELECT * FROM xIVLINK  where (ITD IN({@IDS}) OR VTD IN({@IDS})) AND EXISTS (SELECT * FROM xtransactionheader WHERE [status] = 'openPrice'))\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'De inkoop is toegewezen aan een commissie verkoop!',N'De regel kan niet verwijderd worden!'\n\t\tEXEC sp_api_modal_clear\n\t\tRETURN;\n\tEND\n\t\nIF {[inkoop].status} IN('openPurchase','openPurchaseC') OR {[inkoop_loods].status} IN('openPurchase','openPurchaseC') OR {[ctr1].CTH_fase} IN('openPurchase','openPurchaseC')\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'Zeker weten?',N'Het aantal wordt op 0 gezet, en daarna geheel verwijderd!'\n\t\tDECLARE @cursor CURSOR,@idval INT\n\t\tSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\n\t\tOPEN @cursor;\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\t\n\t\t\t\tIF EXISTS (SELECT * FROM code_ctr_at_location WHERE ctr_id = @idval GROUP BY ctr_id HAVING SUM(amount) = SUM(available))\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tDECLARE @detail nvarchar(255), @TH_id nvarchar(255)\n\t\t\t\t\t\tSET @detail = (SELECT concat(Amount,' ',detail) from q_xtransactiondetail where id = @idval)\n\t\t\t\t\t\tSET @TH_id = (SELECT transactionheader_id from q_xtransactiondetail where id = @idval)\n\t\t\t\t\t\tDECLARE @textlog nvarchar(255) = concat(N'actie [Verwijder] gestart op order: ',@TH_id,' op product: ',@detail)\n\t\t\t\t\t\tEXEC @main_db.dbo.actielog @Card_name , @textlog\n\t\t\t\t\t\t\n\t\t\t\t\t\tEXEC @main_db.dbo.DeleteCTR @idval\n\t\t\t\t\tEND\n\t\t\t\tELSE\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_toast N'Kan ctr niet verwijderen: deels overgebracht of toegewezen'\n\t\t\t\t\tEND\n\t\t\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\t\tEND\n\t\tCLOSE @cursor;\n\t\tDEALLOCATE @cursor;\n\t\tEXEC sp_api_modal_clear\n\t\tEXEC sp_api_modal_select_all_clear\n\tEND\n\tELSE\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'De inkoop is gesloten',N'De regel kan niet verwijderd worden!'\n\t\tEXEC sp_api_modal_clear\n\t\tRETURN;\n\tEND\n",
            "action_id": 180,
            "action_name": "Verwijder",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 181,
            "action_name": "Deurbel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 182,
            "action_name": "Deurbel Ding Dong2",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--\tCONTEXT: CTR\n--\t============\n\n--declare @ctrtoloc int, @ctrfromloc int ,@checkamt int-- (oorspronkelijke) advieslokaties\n--declare @Direct int=1\n--declare @Normaal int=2\n--select @ctrtoloc =tocloc_id, @ctrfromloc=frmloc_id,@checkamt=iif(stockmut=1,amount,0) from xtransactiondetail where id=@ID\n--update xtransactiondetail set Flowmodel_id=@Direct where id=@ID\n--update xlfctr set ltrtoloc=ltrfromloc where ctr_id=@ID and lfctr_amount=@checkamt -- let op: dit gaat alleen goed bij volledige ctr op lfctr!\n\n-- hierboven was de oude, zonder meenemen van iv-gelinkte  verkoop\n\ndeclare @ctrtoloc int, @ctrfromloc int ,@checkamt int-- (oorspronkelijke) advieslokaties\ndeclare @Direct int=1\ndeclare @Normaal int=2\ndeclare @isEqual bit=0\n\n--210330 op deze plaats toegevoegd: Check op volledige en enkelvoudige IVLINK\ndeclare @linkCount int, @linkAmount int\nselect @linkCount=linkCount, @linkAmount=linked from @main_db.dbo.ctr_linkinfo(@ID) \nDECLARE @ThisAmount int\ndeclare @ThisTDT int\nselect @ThisAmount=Amount, @ThisTDT=tdt from xtransactiondetail where id=@ID\n\nif @linkCount <> 1 OR @linkAmount<>@ThisAmount\n\tbegin\n\t\texecute sp_api_modal_alert N'De IV link is niet volledig en enkelvoudig. Omzetten naar Direct kan nog niet...'\n\t\texecute sp_api_modal_clear\n\t\treturn; -- klaar kappen\n\tend\n\n--we zijn hier, dus hebben we een volledige link\ndeclare @CounterCTR int\nselect @CounterCTR= iif(itd=@id,vtd,itd) from xivlink where itd=@id or vtd=@id\n\n\n\nselect @ctrtoloc =tocloc_id, @ctrfromloc=frmloc_id,@checkamt=iif(stockmut=1,amount,0) from xtransactiondetail where id=@ID\nupdate xtransactiondetail set Flowmodel_id=@Direct where id=@ID\nupdate xlfctr set ltrtoloc=@ctrfromloc,ltrfromloc=@ctrfromloc, @isEqual=iif(lfctr_amount-@checkamt=0,1,0) where ctr_id=@ID and lfctr_amount=@checkamt \n-- let op: dit gaat alleen goed bij volledige ctr op lfctr!\n\n\nif @isEqual=1\n\tbegin\n\t\t--pas ook de lfctr aan van de aan deze inkoopregel gelinkte verkoopregels\n\t\tDECLARE @cursor_ids CURSOR,@cid INT\n\t\tSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR (select ITD as ivCTR from xivlink where vtd=@ID UNION select VTD as ivCTR from xivlink where itd=@ID) \n\t\tOPEN @cursor_ids;\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\n\t\t\t\t--geef de lfctr van de verkoop ctr een nieuwe laadlokatie\n\t\t\t\tupdate xtransactiondetail set Flowmodel_id=@Direct where id=@cid\n\t\t\t\t-- als er voor de gewijzigde lfctr lokaties geen LF is, wordt deze aangemaakt. zie trigger xlfctr\n\t\t\t\tupdate xlfctr set ltrfromloc=@ctrfromloc where ctr_id=@cid -- schrijf de fromloc van de inkooplokatie in de from van de verkoop lfctr\n\t\t\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\t\t\tEND\n\t\tCLOSE @cursor_ids;\n\t\tDEALLOCATE @cursor_ids;\n\t\t\n\n\n\t/*\t\n\t\t--210330 extra trucje hier: europalletregels toevoegen en koppelen\n\t\tdeclare @Europallet_stockID int , @NewID int , @NewEuroCTR int\n\t\tset @Europallet_stockID=78867 -- of ingewikkeld doen door iets te zoeken...(select top 1 id from xstock where .... )\n\t\texecute @NewID = @main_db.dbo.Clone_CTR_to_StockID @IDS=@ID, @Stock_ID=@Europallet_stockID, @FromLocID=@ctrfromloc\n\t\t\n\t\t--en de counter copy\n\t\texecute @NewEuroCTR = @main_db.dbo.Clone_CTR_to_StockID @IDS=@CounterCTR, @Stock_ID=@Europallet_stockID\n\t\tif @NewID >0 AND @NewEuroCTR >0\n\t\t\tinsert into xivlink(itd,vtd,stock_id,linkAantal) \n\t\t\t\tvalues (\n\t\t\t\t\tiif(@ThisTDT=1,@NewEuroCTR,@NewID)\n\t\t\t\t\t,iif(@ThisTDT=1,@NewID,@NewEuroCTR)\n\t\t\t\t\t,@Europallet_stockID\n\t\t\t\t\t,1 -- 1 pallet!\n\t\t\t\t\t)\n\n*/\n\tend\n\n\n",
            "action_id": 183,
            "action_name": "Directe verlading",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(2000) = N'',@button nvarchar(128)\n--SELECT * INTO #modaltable FROM fn_api_get_curly_params_by_search(@search)\nEXEC sp_api_modal_select_curly @value = @search OUT\nEXEC sp_api_modal_button @name='button',@value=N'Parse',@valueout=@button OUT,@key='Insert'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tDECLARE @sql nvarchar(max) = N'{'+@search+'}'\n\t\tEXEC sp_api_card_curly_replace @card_id = @card_id, @string = @sql OUT\n\t\tEXEC sp_api_modal_text @sql,N'code'\n--\t\tEXEC sp_api_modal_field_insert @card_field_id,@search\n--\t\tEXEC sp_api_modal_clear\n\tEND\n--EXEC sp_api_modal_field_insert @card_field_id,N'Afleveren bij loods 5'\n/*\nreturn\n--DECLARE @rawdata varbinary(max) = (SELECT * FROM OPENROWSET(BULK 'C:\\Beheer\\backup\\tracy_fka_proj.bak', SINGLE_BLOB) as f)\nDECLARE @rawdata varbinary(max) = (SELECT * FROM OPENROWSET(BULK 'C:\\Windows\\explorer.exe', SINGLE_BLOB) as f)\nEXEC sp_api_modal_download @rawdata=@rawdata,@filename=N'abc.zip'\n*/",
            "action_id": 184,
            "action_name": "dl file",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--als er vrije LF is, maak dan een nieuwe docset END stop alle vrije LF er in\r\n--IF exists()\r\nSET @path = @path+'/'+@ID+'/tdocset'--+dbo.nv(@clone_id)\r\nEXEC sp_api_goto @path ",
            "action_id": 185,
            "action_name": "doc",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @filename nvarchar(1024) = concat(dbo.strdate(NULL),'-test.csv')\nSELECT top 10 * INTO #temptable FROM xstock\nEXEC sp_api_modal_csv @tmptable=N'#temptable', @filename=@filename\n\n--select TOP 10000 * into #cities FROM xCity --WHERE country_id = 151\n--exec sp_api_modal_csv @tmptable=N'#cities', @filename=N'yoyo cities.csv'\n--select * into #modaltable13 FROM xCountry\n--exec sp_api_modal_csv @tmptable=N'#modaltable13', @filename=N'yoyo country456.csv'\n",
            "action_id": 186,
            "action_name": "download csv",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT xLotArtModel_ID from @main_db.dbo.xCompanyxLotArtModel WHERE xcompany_ID={[inkoop].Counterparty_ID}) ",
            "action_id": 187,
            "action_name": "Eerder gebruikt",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id IN (select xStock_ID from xCompanyStockID CS where CS.xCompany_ID = @counterparty_ID)",
            "action_id": 188,
            "action_name": "Eerder gebruikt",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(128) ,@button nvarchar(128), @datumtijd nvarchar(50)\nDECLARE @filename nvarchar(1024) \n,@VroegNegatiefdownload nvarchar(128) = dbo.strdate(NULL) +'_'+ 'VroegNegatief.csv'\n,@Negatiefdownload nvarchar(128) = dbo.strdate(NULL) +'_'+ 'Negatief.csv'\n,@Reserveddownload nvarchar(128) = dbo.strdate(NULL) +'_'+ 'Gereserveerd.csv'\n,@Notzerodownload nvarchar(128) = dbo.strdate(NULL) +'_'+ 'Voorraad.csv'\nSET @datumtijd = FORMAT(getdate(),'dd MMM yyyy HH:mm')\n\n--EXEC sp_api_modal_input @name='search',@value = @search OUT,@focus=1 -- zoek veld\nEXEC sp_api_modal_modal @class = 'w100'\nSET @button = 'VroegNegatief'\nEXEC sp_api_modal_button @name='button',@value = 'VroegNegatief',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_button @name='button',@value = 'Negatief',@valueout = @button OUT,@class = 'btn-primary',@key = 'F2'\nEXEC sp_api_modal_button @name='button',@value = 'Gereserveerd',@valueout = @button OUT,@class = 'btn-primary',@key = 'F3'\nEXEC sp_api_modal_button @name='button',@value = 'Alles',@valueout = @button OUT,@class = 'btn-primary',@key = 'F4'\nEXEC sp_api_modal_button @name='button',@value = 'VolledigeLijst',@valueout = @button OUT,@class = 'btn-primary',@key = 'F5'\nEXEC sp_api_modal_button @name='button',@value = 'Partijvoorraad',@valueout = @button OUT,@class = 'btn-primary',@key = 'F6'\nEXEC sp_api_modal_print @keycode='F9'\nEXEC sp_api_modal_text @datumtijd, @printonly=1\n\nIF @button =  'VroegNegatief'\nBEGIN\nSELECT DISTINCT [Description~col-sm-5] = Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Vroeg Negatief' AS [CAP*]\n\t,[verwacht@g] = VoorraadVerwacht@, [Voorraad@g] = Voorraad@\nINTO #VroegNegatief\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ < 0) AND ([EndTime*] = 'Vroeg') AND (CoreType = 'FOOD')\nEXEC sp_api_modal_table @tmptable=N'#VroegNegatief',@orderby=N'ORDER BY [CAP*],1 ASC',@print=1\nEXEC sp_api_modal_button @name='button',@value = 'VroegNegatiefNaarCSV',@valueout = @button OUT,@class = 'btn-success'\nEND \n\nIF @button =  'VroegNegatiefNaarCSV'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Vroeg Negatief' AS [CAP*]\nINTO #VroegNegatiefdownload\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ < 0) AND ([EndTime*] = 'Vroeg') AND (CoreType = 'FOOD')\nEXEC sp_api_modal_csv @tmptable=N'#VroegNegatiefdownload',@orderby=N'ORDER BY [CAP*],Description ASC', @filename= @VroegNegatiefdownload,@ansi=1\nEND \n\n\nIF @button =  'Negatief'\nBEGIN\nSELECT DISTINCT [Description~col-sm-5] = Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Negatief' AS [CAP*]\n\t,[verwacht@g] = VoorraadVerwacht@, [Voorraad@g] = Voorraad@\nINTO #Negatief\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ < 0) AND (CoreType = 'FOOD')\nEXEC sp_api_modal_table @tmptable=N'#Negatief',@orderby=N'ORDER BY [CAP*],1 ASC',@print=1\nEXEC sp_api_modal_button @name='button',@value = 'NegatiefNaarCSV',@valueout = @button OUT,@class = 'btn-success'\nEND \n\nIF @button =  'NegatiefNaarCSV'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Negatief' AS [CAP*]\nINTO #Negatiefdownload\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ < 0) AND (CoreType = 'FOOD')\nEXEC sp_api_modal_csv @tmptable=N'#Negatiefdownload',@orderby=N'ORDER BY [CAP*],Description ASC', @filename= @Negatiefdownload,@ansi=1\nEND \n\nIF @button =  'Gereserveerd'\nBEGIN\nSELECT DISTINCT ReservedIn@, ReservedOut@, [Description~col-sm-5] = Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Gereserveerd' AS [CAP*]\n\t,[verwacht@g] = VoorraadVerwacht@, [Voorraad@g] = Voorraad@\nINTO #Gereserveerd\nFROM          RV_IR_Voorraad\nWHERE        (ReservedIn@ <> 0 OR ReservedOut@ <> 0) AND (CoreType = 'FOOD')\nEXEC sp_api_modal_table @tmptable=N'#Gereserveerd',@orderby=N'ORDER BY [CAP*],3 ASC',@print=1\nEXEC sp_api_modal_button @name='button',@value = 'GereserveerdNaarCSV',@valueout = @button OUT,@class = 'btn-success'\nEND \n\nIF @button =  'GereserveerdNaarCSV'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, ReservedIn@, ReservedOut@, Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Gereserveerd' AS [CAP*]\nINTO #GereserveerdNaarCSV\nFROM          RV_IR_Voorraad\nWHERE        (ReservedIn@ <> 0 OR ReservedOut@ <> 0) AND (CoreType = 'FOOD')\nEXEC sp_api_modal_csv @tmptable=N'#GereserveerdNaarCSV',@orderby=N'ORDER BY [CAP*],Description ASC', @filename= @Reserveddownload,@ansi=1\nEND \n\nIF @button =  'Alles'\nBEGIN\nSELECT DISTINCT [Description~col-sm-5] = Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Alles' AS [CAP*]\n\t,[verwacht@g] = VoorraadVerwacht@, [Voorraad@g] = Voorraad@ --, [Correctie] = '         '\nINTO #Notzero\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ <> 0) AND (CoreType = 'FOOD')\nSET @datumtijd = FORMAT(getdate(),'dd MMM yyyy HH:mm')\nDECLARE @sql nvarchar(max) = N'ALTER TABLE #Notzero ADD ' + QUOTENAME(@datumtijd+'~col-sm-2') +' nvarchar(128)'\nEXEC (@sql)\nEXEC sp_api_modal_table @tmptable=N'#Notzero',@orderby=N'ORDER BY [CAP*],1 ASC',@fontsize='120%',@print=1\nEXEC sp_api_modal_button @name='button',@value = 'AllesNaarCSV',@valueout = @button OUT,@class = 'btn-success'\nEND \n\n--\n\nIF @button =  'Partijvoorraad'\nBEGIN\nSELECT CatSub_0 as [CatSub*], Variety_0 as [Botanic~col-sm-2 wrap],ContentDesc as [inhoud~col-sm-1],Size as [maat~col-sm-1],Detail_0 as [Detail~col-sm-1],Origin_Code as [LVO~col-sm-1-2] ,KGN as [Kgn~col-sm-1],FustCode as [Fustcode~col-sm-1],TransactionHeader_ID as [InkNr:0~col-sm-1] \n,\tleft(counter_code,8) as [Lev~col-sm-1],\tLEFT((select CONVERT(VARCHAR, LFDATE , 13)), 6) as [Datum~col-sm-1]\n,\tVoorraad as [Stock:0~col-sm-1]\n\nINTO #PartijStock\nFROM          @main_db.dbo.StockPerLot_date(dbo.abcdate()) -- alles verkocht t/m vandaag!\nwhere [catsub_0] > N'' -- RH210209 hiermee wordt fust weggelaten\nEXEC sp_api_modal_table @tmptable=N'#PartijStock'\n,@orderby=N'ORDER BY [catsub*],[Botanic~col-sm-2 wrap]  ASC'\n,@fontsize='100%',@print=1\nEND \n\n\nIF @button =  'AllesNaarCSV'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Origin_Code, Size, xBrandName, ContentDesc, FustCode, 'Negatief' AS [CAP*]\nINTO #Notzerodownload\nFROM          RV_IR_Voorraad\nWHERE        (Voorraad@ <> 0) AND (CoreType = 'FOOD')\nEXEC sp_api_modal_csv @tmptable=N'#Notzerodownload',@orderby=N'ORDER BY [CAP*],Description ASC', @filename= @Notzerodownload,@ansi=1\nEND \n\nIF @button =  'VolledigeLijst'\n\tBEGIN\n\t\tDECLARE @datum nvarchar(128),@button2 nvarchar(128)\n\t\tEXEC sp_api_modal_text N'Kies de datum voor de voorraadlijst (dit is een lange lijst!!)'\n\t\tEXEC sp_api_modal_date @name='datum',@value = @datum OUT\n\t\tEXEC sp_api_modal_button @name='button2',@value = 'Laad lijst',@valueout = @button2 OUT,@class = 'btn-success',@key = 'Enter'\n\n\t\tIF @button2 IS NOT NULL\n\t\t\tBEGIN\n\t\t\t\tSELECT *\n\t\t\t\tINTO #VolledigeLijst\n\t\t\t\tFROM @main_db.dbo.stockByDate(@datum)\n\t\t\t\tEXEC sp_api_modal_table @tmptable=N'#VolledigeLijst',@orderby=N'ORDER BY ARTIKEL ASC'\n\t\t\tEND\n\tEND",
            "action_id": 189,
            "action_name": "Voorraad Lijsten",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "Stock > 0",
            "action_id": 190,
            "action_name": "Voorraad Positief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "Stock > 0",
            "action_id": 191,
            "action_name": "Voorraad Positief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select stock_id from @main_db.dbo.CTR2_EARLY())",
            "action_id": 192,
            "action_name": "vroege_verlading",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select stock_id from @main_db.dbo.CTR2_EARLY())",
            "action_id": 193,
            "action_name": "vroege_verlading",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @Naam nvarchar(200)=(select size from xstock where id=@ID)\ndeclare @xbol_ID INT ={[xbol].id}\nif @xBol_ID is not null update xbol set DocNumber=@naam where id=@xBol_ID\n\nexec sp_api_go2",
            "action_id": 194,
            "action_name": "vul BOL",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.Fill_xPerArtSelection",
            "action_id": 195,
            "action_name": "Vul PER bronlijst met historische Artikelen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.[dbo].[Fill_xPerArtSelection]",
            "action_id": 196,
            "action_name": "vul_vanuit_orderhistorie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "----------------------------------------------------------------------------------------\n--\tAuthor:\t\t\tRH\n--\tDate: \t\t\t191120\n--\tAction: \t\tIngeven van een nieuwe wisselkoers\n--\tContext card: \tCurrency\n--\tpre declare:\tnone\n--\tDIT IS MODELCODE VOOR VERGELIJKBARE OMGEVINGEN ALS DIESELTOESLAG EN DOUANE TARIEVEN\n----------------------------------------------------------------------------------------\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200)\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20) --='100'\nDECLARE @xCurrencyID INT={[currency].id}\nDECLARE @ISO nvarchar(10)={[currency].codeISO}\nif @xCurrencyID IS NULL \n\tBEGIN\n\t\tEXEC SP_API_TOAST N'Er is geen Currency kaart geopend.'\n\t\tRETURN;\n\tEND\nif @ISO =N'EUR'\t\n\tbegin\n\t\texec sp_api_modal_alert N'U kunt geen koers van de euro opgeven, die is namelijk altijd 1,00000 '\n\t\treturn;\n\tend\n\n\nDECLARE @FlowModel int\nDECLARE @THDT INT\n\ndeclare @datum nvarchar(512)\nDECLARE @koers nvarchar(20)\nset @mes=N'Invoeren van een nieuwe wisselkoers'\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Datum'\nSET @datum = '2020-10-30'\nEXEC sp_api_modal_date @name='Ingangsdatum:',@value= @datum OUT,@class = 'w-25'\nEXEC sp_api_toast @datum\n\ndeclare @Txt1 nvarchar(200)=concat(N'Wisselkoers: (de waarde van 1 ',@ISO,N') in euro''s opgeven')\nEXEC sp_api_modal_text @txt1\nEXEC sp_api_modal_input @name='koers',@value = @koers OUT\nIF @Koers>N'' SET @Koers=replace(@Koers, ',', '.') -- zorg dat punten en komma's als dec. seperator zijn toegestaan..\n\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\texec @main_db.dbo.SetxValRate_F \t@Code = N'CURRENCY'\t,@ContextID =@xCurrencyID\t,@StartDate =@datum\t,@F =@koers\n\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\tRETURN\n\tEND\n\n\n",
            "action_id": 197,
            "action_name": "Waarde/koers ingeven",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "processEndDT is NULL ",
            "action_id": 198,
            "action_name": "Wachtend",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "TransactionDate = dbo.workdate() --AND Status = 'openPurchase' ",
            "action_id": 199,
            "action_name": "Werkdatum ",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "TransportDate>=dbo.workdate() --and TransportDate < dbo.workdate()+1",
            "action_id": 200,
            "action_name": "Werkdatum(vanaf)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "if ({[inkoop].ivtotal})<>0 \n\tbegin\n\t\texec sp_api_toast N'Er is al verkocht, kan Loslokatie niet wijzigen '\n\t\treturn\n\tend\n\ndeclare @LocID nvarchar(200)\nEXEC sp_api_modal_select @card_name=N'xlocation',@value = @locID OUT,@focus=1,@placeholder=N'Kies de verwachte loslokatie'\n\nIF @locID > 0\n\t\tBEGIN\n\t\t\tUPDATE xtransactionheader SET Destination_ID = @LocID WHERE id = @id\n\t\t\tDECLARE @idval INT\n\t\t\tDECLARE @cursor CURSOR\n\t\t\t\tSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT id from xtransactiondetail where transactionheader_id = @id\n\t\t\t\tOPEN @cursor;\n\t\t\t\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\t\t\t\tWHILE @@FETCH_STATUS = 0\n\t\t\t\t\tBEGIN\n\t\t\t\t\tUPDATE xtransactiondetail SET TocLoc_ID = @LocID WHERE id = @idval\n\t\t\t\t\tFETCH NEXT FROM @cursor INTO @idval\n\t\t\t\t\tEND\n\t\t\t\t\t\n\t\t\t\tCLOSE @cursor;\n\t\t\t\tDEALLOCATE @cursor;\n\t\t\t--EXEC sp_api_modal_clear\n\t\t\t--EXEC sp_api_modal_select_all_clear\n\nEND\n\n\nIF @locID > 0\n\t\tBEGIN\n\t\t\tDECLARE @LFidval INT\n\t\t\tDECLARE @LFcursor CURSOR\n\t\t\t\tSET @LFcursor = CURSOR LOCAL FAST_FORWARD FOR SELECT id from xlandfreight where transactionheader_id = @id AND typeCode = 'PURCHTRANS'\n\t\t\t\tOPEN @LFcursor;\n\t\t\t\t\tFETCH NEXT FROM @LFcursor INTO @LFidval\n\t\t\t\t\tWHILE @@FETCH_STATUS = 0\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\n\t\t\t\t\tUPDATE xlandfreight SET To_Location_ID = @LocID WHERE id = @LFidval\n\t\t\t\t\t--EXEC sp_api_modal_post N'inkomende_landfreight',N'To_Location_ID',@LocID,@LFidval\n\t\t\t\t\t--EXEC sp_api_modal_save N'inkomende_landfreight',@LFidval\n\t\t\t\t\t\n\t\t\t\t\tFETCH NEXT FROM @LFcursor INTO @LFidval\n\t\t\t\t\tEND\n\t\t\t\t\t\n\t\t\t\tCLOSE @LFcursor;\n\t\t\t\tDEALLOCATE @LFcursor;\n\t\t\tEXEC sp_api_modal_clear\n\t\t\tEXEC sp_api_modal_select_all_clear\n\nEND\n\n/*\nif @locID is not NULL\n\tbegin\n\t\tupdate xTransactionHeader set Destination_ID = @LocID\twhere id=@ID\n\t\tupdate xtransactiondetail SET Tocloc_id = @LocID WHERE transactionheader_ID = @id\n\t\tupdate xLandfreight set xlandfreight.To_Location_ID = @LocID where xLandfreight.TransactionHeader_ID =@ID\n\t\texec sp_api_modal_clear;\n\tend\n*/",
            "action_id": 201,
            "action_name": "Wijzig Loslokatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @SID INT,@text nvarchar(255)\r\nselect @SID=supplier_id from p_PriceEntryRow PER where PER.ID=@ID\r\nEXEC sp_api_modal_alert N'Leverancier wordt via Timer ge-wiped'\r\nexec @main_db.dbo.PER_WIPE @SID\r\nSET @text=N'Supplier_id '+ dbo.nv(@SID) + ' wiped!'\r\nEXEC sp_api_toast @text\r\nEXEC sp_api_modal_select_all_clear\r\n--EXEC sp_api_modal_text N'ok'\r\nEXEC sp_api_modal_reload\r\n-- Ctrl+S en F5",
            "action_id": 202,
            "action_name": "Wipe Supplier",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @LOC int, @name nvarchar(200)\nset @loc=(select top 1 id  from @main_db.dbo.PossibleLocationsForXLFCTR(@ID))\nselect @name=concat(locationcode,' -> ',locationname) from xlocation where id=@loc\nexec sp_api_toast @name\nupdate xlfctr set ltrfromloc=@loc where id=@ID\n",
            "action_id": 203,
            "action_name": "WL",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "TransportDate=dbo.workdate()",
            "action_id": 204,
            "action_name": "Workdate",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate}=dbo.workdate()",
            "action_id": 205,
            "action_name": "workdate (vandaag)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "{lfdate}=dbo.workdate()",
            "action_id": 206,
            "action_name": "workdate (vandaag)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @ThisID int=@ID\r\ndeclare @Context int, @Code nvarchar(50)\r\nselect @Context=contextid, @Code=code from xValRate where id=@ThisID\r\nupdate xValRate set enddate =null where id=@ThisID\r\n",
            "action_id": 207,
            "action_name": "zet open",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast @Parent_Card_Name\r\n\r\nIF @Parent_Card_Name=N'inkoop'\r\nbegin\r\n\tIF not exists(SELECT * FROM xLotbase WHERE xCTH=@Parent_ID AND xLAM=@ID)\r\n\t\tinsert into xLotbase(xCTH,xLAM) values (@Parent_ID,@ID)\r\n\tELSE\r\n\t\tdelete FROM xlotbase WHERE xCTH=@Parent_ID AND xLAM=@ID\r\nEND\r\n\r\nIF @Parent_Card_Name=N'lotbase'\r\nbegin\r\n\tIF not exists(SELECT * FROM xLotbase WHERE xCTH=(SELECT xCTH FROM xLotbase WHERE ID=@Parent_ID) AND xLAM=@ID)\r\n\t\tinsert into xLotbase(xCTH,xLAM) values ((SELECT xCTH FROM xLotbase WHERE ID=@Parent_ID),@ID)\r\n\tELSE\r\n\t\t--veiligheid er omheen: Als men vanaf een lotbase_ID het eigen id probeert te verwijderen, dan dat tegenhouden \r\n\t\tIF @ID <> (SELECT xLAM FROM xLotbase WHERE ID=@Parent_ID)\r\n\t\t\tdelete FROM xlotbase WHERE xCTH=(SELECT xCTH FROM xLotbase WHERE ID=@Parent_ID) AND xLAM=@ID\r\n\t\tELSE\r\n\t\t\tEXEC sp_api_toast N'U kunt dit artikel alleen verwijderen vanaf LOTBASE'\r\nEND\r\n\r\n\r\n",
            "action_id": 208,
            "action_name": "(de)Select",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "CTH_Unmapped <>0",
            "action_id": 209,
            "action_name": "(rest)Voorraad partijen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.cthFase @ID, N'closedSaleReadyForInvoice'",
            "action_id": 211,
            "action_name": "_dnu? klaar voor facturatie",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text 'Voeg een bedrijf specifiek toe bij menu item [klanten], [leveranciers], etc.','h3 text-muted'\r\n",
            "action_id": 212,
            "action_name": "+",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text 'Voeg een bedrijf specifiek toe bij menu item [klanten], [leveranciers], etc.','h3 text-muted'\n",
            "action_id": 213,
            "action_name": "+",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @filename nvarchar(1024) = dbo.strdate(NULL)+'-xCompany.csv'\nSELECT * INTO #xCompany FROM xCompany\nEXEC sp_api_modal_csv @tmptable=N'#xCompany',@orderby=N'ORDER BY CompanyName', @filename=@filename\n\n--select TOP 10000 * into #cities FROM xCity --WHERE country_id = 151\n--exec sp_api_modal_csv @tmptable=N'#cities', @filename=N'yoyo cities.csv'\n--select * into #modaltable13 FROM xCountry\n--exec sp_api_modal_csv @tmptable=N'#modaltable13', @filename=N'yoyo country456.csv'\n",
            "action_id": 214,
            "action_name": "2csv",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "ctrstatus <> ' '",
            "action_id": 215,
            "action_name": "Actie vereist",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "status not in('InvoiceGenerated') and isnull(xctrstatus,0)<>0 ",
            "action_id": 216,
            "action_name": "Actie vereist",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(xctrstatus,0)<>0 and status not in('InvoiceGenerated')",
            "action_id": 217,
            "action_name": "Actie vereist",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(xctrstatus,0)<>0 ",
            "action_id": 218,
            "action_name": "Actie verplicht",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "isnull(xctrstatus,0)<>0 ",
            "action_id": 219,
            "action_name": "Actie verplicht",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select p.stock_id from p_PriceEntryRow p where p.activeCount > 0)",
            "action_id": 220,
            "action_name": "Actieve PER",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 221,
            "action_name": "Action Help",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 222,
            "action_name": "Actions",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 223,
            "action_name": "Actions",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "activecount > 0",
            "action_id": 224,
            "action_name": "Active",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (select Stock_id from p_PriceentryRow where @parent_card_name='inkoop' and Supplier_ID =(select counterparty_id from xtransactionheader where id=@parent_id) and activeCount >0)\r\n\t",
            "action_id": 225,
            "action_name": "activePER",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "ValidDate >= (getdate()-1)",
            "action_id": 226,
            "action_name": "Actueel",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "id in (SELECT xStock_ID FROM xCompanyStockID WHERE xCompany_ID = {[inkoop].Counterparty_ID})\nor\nid in (SELECT xStock_ID FROM xCompanyStockID WHERE xCompany_ID = {[xcontainer].Supplier_ID})",
            "action_id": 227,
            "action_name": "eigen artikelen",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.SP_CURS_SetStockPER",
            "action_id": 228,
            "action_name": "Eigen voorraad naar PER",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.SP_End_Sum_CTH @ID",
            "action_id": 229,
            "action_name": "EndSum",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.SP_End_Sum_CTH @ID",
            "action_id": 230,
            "action_name": "EndSum",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.sp_end_sum_cth @ID",
            "action_id": 231,
            "action_name": "EndSumCTH",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.sp_end_sum_ctr @ID\n--exec @main_db.dbo.actielog @Cardname=@Card_name ,@message=N'Actie [EndSumCTR] gestart' --zie card: actielog",
            "action_id": 232,
            "action_name": "EndSumCTR",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.sp_end_sum_ctr @ID",
            "action_id": 233,
            "action_name": "EndSumCTR",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @EndTime nvarchar(max) = {[verkoop2].EndTime}\r\nEXEC sp_api_toast @EndTime",
            "action_id": 234,
            "action_name": "EndTime",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @finance_reference nvarchar(128)\n--BEGIN TRY\n\tEXEC @main_db.dbo.sp_iu_finance_account @id,@finance_reference OUT\n\tEXEC sp_api_toast @finance_reference\n/*END TRY BEGIN CATCH\n\t--SET @finance_reference = ERROR_NUMBER()\n\t--EXEC sp_api_toast @finance_reference\n\tIF ERROR_SEVERITY() = 17 -- redirect = 17!!!\n\t\tBEGIN\n\t\t\tDECLARE @valueout nvarchar(128)\n\t\t\t\t, @json nvarchar(max) = N'{\"type\":\"open_url_in_new_tab\",\"url\":\"'+ERROR_MESSAGE()+'\",\"windowFeatures\":\"width=500,height=500,scrollbars=on\"}'\n\t\t\tEXEC sp_api_modal_dispatch @json\n\t\t\tEXEC sp_api_modal_text N'Login to Exact Online, then try again',N'h4 mb-4'\n\t\t\tEXEC sp_api_modal_button @name='Retry',@value = 'Retry', @valueout = @valueout OUT,@class='btn-primary',@key='Enter'\n\t\tEND\nEND CATCH\n*/",
            "action_id": 235,
            "action_name": "Export naar Exact",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "exec @main_db.dbo.ExtraVracht @ID",
            "action_id": 236,
            "action_name": "Extra Vracht Maken",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_modal @class=N'w100'\n\nDECLARE @value nvarchar(max),@country_id nvarchar(max),@city_id nvarchar(max),@menu_id nvarchar(max),@company_id nvarchar(max),@reducer nvarchar(max)\n/*EXEC sp_api_modal_text N'Menu voorbeeld, ga naar card:',N'h3'\n\nSET @reducer=N'in_main_menu = 1'\n\nEXEC sp_api_modal_select @card_name=N'menu',@value = @menu_id OUT,@focus=1,@reducer=@reducer,@placeholder=N'Zoek een card...'--,@table=N'#country'\n\n--DECLARE @text = (\nIF @menu_id IS NULL RETURN\nSELECT @path = CONCAT('/',name) FROM api_card WHERE id = @menu_id\nEXEC sp_api_goto @path\n\nreturn \n*/\n\nEXEC sp_api_modal_text N'Land, stad, klant reducer voorbeeld:',N'h3'\n\nEXEC sp_api_modal_select @card_name=N'country',@value = @country_id OUT,@focus=1,@placeholder=N'Kies een land'--,@table=N'#country'\n\nSET @reducer=N'country_id = ' + @country_id\nEXEC sp_api_modal_select @card_name=N'city',@value = @city_id OUT,@reducer=@reducer,@focus=1,@placeholder=N'Kies een stad'--,@table=N'#country'\n\nSET @reducer=N'city_id = ' + @city_id\nEXEC sp_api_modal_select @card_name=N'klant',@value = @company_id OUT,@reducer=@reducer,@focus=1,@placeholder=N'Kies een klant'--,@table=N'#country'\n\n\nSET @country_id = CONCAT(N'Het land id is: ' , @country_id)\nSET @city_id = CONCAT(N'Het stad id is: ' , @city_id)\nSET @company_id = CONCAT(N'Het klant id is: ' , @company_id)\nEXEC sp_api_modal_text @country_id\nEXEC sp_api_modal_text @city_id\nEXEC sp_api_modal_text @company_id\n--DECLARE @json nvarchar(max) = (SELECT * FROM #country FOR JSON AUTO,INCLUDE_NULL_VALUES)\n--EXEC sp_api_toast @json\nRETURN\n\n\n\nEXEC sp_api_modal_text N'File upload...'\nEXEC sp_api_modal_file_input @name =N'File'\t,@value =@value OUT\nIF @value IS NOT NULL\n\tEXEC sp_api_modal_text @value\n",
            "action_id": 237,
            "action_name": "File Upload",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @value nvarchar(128)\nEXEC sp_api_modal_text N'File upload...'\nEXEC sp_api_modal_file_input @name =N'File'\t,@value =@value OUT\nIF @value IS NOT NULL\n\tEXEC sp_api_modal_text @value",
            "action_id": 238,
            "action_name": "file_upload_2",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<0",
            "action_id": 239,
            "action_name": "filter_negatief_stock",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXECUTE @main_db.dbo.FlashxStock @ID ",
            "action_id": 240,
            "action_name": "Flash",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "coretype in ('CRATE','PALLET') ",
            "action_id": 241,
            "action_name": "Fustdragers",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @RETURNORDER INT\nEXEC @RETURNORDER=@main_db.dbo.SP_Create_CrateReturnOrder @ID\nIF @RETURNORDER is not null \n\tBEGIN\n\t\t--EXEC sp_api_toast @RETURNORDER\n\t\tDECLARE @R nvarchar(200),@P nvarchar(200)\n\t\tSET @P=concat(N'/klant/',{[klant].id},N'/verkoop?id=',@RETURNORDER)\n\t\tEXEC sp_api_goto @P\tEND\n",
            "action_id": 242,
            "action_name": "Fustretour order (negatief boeken)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_card_import_csv @card_name",
            "action_id": 244,
            "action_name": "Geert Test Import",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.sp_create_invoice_rows @THDT = 1",
            "action_id": 245,
            "action_name": "Generate incoming",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @THDT INT = IIF({[invoice].id} IS NULL,1,2) -- if no invoice.id then incoming_invoice\r\nEXEC @main_db.dbo.sp_create_invoice_rows @THDT",
            "action_id": 247,
            "action_name": "Genereer facturen (verkoop)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @R nvarchar(50),@P nvarchar(50)\r\nSET @P=concat(N'/inkoop/',{[inkoop].id},N'/lotbase')\r\nEXEC sp_api_goto @P\r\n--EXEC sp_api_toast @P",
            "action_id": 248,
            "action_name": "GoToLotbase",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "coptotal > 100",
            "action_id": 249,
            "action_name": "grote orders",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'Hallo'",
            "action_id": 250,
            "action_name": "Hallo",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock > 0",
            "action_id": 251,
            "action_name": "Has-Stock",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @date nvarchar(128),@date2 nvarchar(128),@button nvarchar(128)\r\n\r\nEXEC sp_api_modal_text 'Van:'\r\nEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-24',@focus=1,@select=1  -- zoek veld\r\nEXEC sp_api_modal_text 'Tot en met:'\r\nEXEC sp_api_modal_date @name='Date2',@value = @date2 OUT,@class='w-24' -- zoek veld\r\n--EXEC sp_api_modal_input @name='ProdCode',@value = @ProdCode OUT,@class='w-24' -- zoek veld\r\n\r\nSET @button = 'Opensale'\r\nEXEC sp_api_modal_button @name='button',@value = 'Opensale',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\r\n\r\nIF @button =  'Opensale'\r\nBEGIN\r\nSELECT Status, InsUser, TransactionDate\r\nINTO #Opensale\r\nFROM        xtransactionheader\r\nWHERE\t\t(TDT = 2) AND (TransactionDate BETWEEN @date AND @date2) AND Status = 'Opensale'\r\nEXEC sp_api_modal_table @tmptable=N'#Opensale', @orderby=N'ORDER BY TransactionDate ASC'\r\nEND \r\n",
            "action_id": 253,
            "action_name": "henk_test_instant",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.PER_HI_TO_LO ",
            "action_id": 254,
            "action_name": "High to Low",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "movement=1 and TDT=1 and datum >= dbo.workdate()",
            "action_id": 255,
            "action_name": "Inkomend vandaag ++",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC @main_db.dbo.SP_Create_CrateReturnOrderAsPurchase @ID",
            "action_id": 256,
            "action_name": "Inkoop Fust (Retour)",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @aantal nvarchar(128),@aantalCol nvarchar(128),@new_id INT,@text nvarchar(128), @size nvarchar(128)\r\nDECLARE @button nvarchar(128)\r\n \r\nIF (SELECT size FROM xlotartsize WHERE id=@id) is null OR (SELECT cp120 FROM xlotartsize WHERE id=@id) is null\r\n\tBEGIN\r\n\t\t--EXEC sp_api_toast N'MAAT END C.P.P. IS VERPLICHT BIJ xLOTARTSIZE',N'bg-danger text-white p-4 center'\r\n\t\tEXEC sp_api_modal_alert N'Voordat u Lotpallets kunt ingeven, moeten de velden MAAT en C.P.P. ingevuld zijn bij xLotArtSize'\r\n\t\t--EXEC sp_api_modal_alert N'MAAT END C.P.P. IS VERPLICHT BIJ xLOTARTSIZE2222'\r\n\t\t--EXEC sp_api_modal_alert N'MAAT END C.P.P. IS VERPLICHT BIJ xLOTARTSIZE223333322'\r\n\r\n\t\tDECLARE @search nvarchar(2000) = N'?focus=10240'\r\n\t\tSET @path = @path + '/' + @id\r\n\t\tEXEC sp_api_goto @path,@search\r\n\t\treturn\r\n\tend\r\n\r\nEXEC sp_api_modal_text N'Aantal Pallets'\r\nEXEC sp_api_modal_input @name='adv. pallets',@value = @aantal OUT,@focus=1\r\nSET @Aantal = isnull(@Aantal,0)--201007 zet het pallet-aantal OP 0 als er wel collis zijn\r\n\r\nEXEC sp_api_modal_text N'Aantal Colli'\r\nEXEC sp_api_modal_input @name='adv. Colli',@value = @aantalCol OUT\r\n\r\n\r\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\nIF @button IS NOT NULL AND (TRY_CAST(@aantal as INT) IS NOT NULL OR TRY_CAST(@aantal as INT) IS NOT NULL)\r\nBEGIN\r\n\tDECLARE @LotBase_ID INT = {[lotbase].id}\r\n\tEXEC sp_api_toast @id\r\n\tEXEC sp_api_toast @aantal\r\n\tEXEC sp_api_toast @LotBase_ID\r\n\r\n\tEXEC @main_db.dbo.FillxLotpalletFromLAS @xLotArtSize_ID = @id,@Pallets = @aantal,@Colli = @aantalCol, @LotBase_ID = @LotBase_ID, @new_id = @new_id OUT\r\nEND\r\n\r\nIF @button IS NOT NULL \r\n\tBEGIN\r\n\t\tIF @Aantal >0 --202007 alleen als er pallets zijn ingevuld direct door naar lotpallets, niet bij losse colli..\r\n\t\t\tbegin\r\n\t\t\t\tSET @path = REPLACE(@path,'/lotartsize','/lotpallets')\r\n\t\t\t\tSET @text = N'?ord=&id=' + dbo.nv(@new_id )\r\n\t\t\t\tEXEC sp_api_modal_pathname @pathname = @path,@search = @text\r\n\t\t\t\t--EXEC sp_api_goto @path\r\n\t\t\tEND\r\n\r\n\t\tEXEC sp_api_modal_clear\r\n\tEND\r\n\r\n\r\n\r\n\r\n",
            "action_id": 257,
            "action_name": "Insert Advice",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @company_id nvarchar(32),@new_id nvarchar(32),@goto nvarchar(2000),@search nvarchar(2000), @location_id nvarchar(32), @reducer nvarchar(max), @date nvarchar(128), @opmerking nvarchar(128), @opmerkingrelation nvarchar(128)\n,@transactiondate nvarchar(128)\n,@button nvarchar(128)\n,@button1 nvarchar(128) = N'Nieuwe verkoop'\n,@button2 nvarchar(128) = N'Laatste open verkoop'\n,@button3 nvarchar(128) = N'Gereserveerde verkoop'\n,@button4 nvarchar(128) = N'Naar lokaties'\n,@button5 nvarchar(128) = N'Eigen lokaties'\n,@button6 nvarchar(128) = N'Werk lokaties'\n,@buttonescape nvarchar(128) = N'Ga terug'\n,@buttongoahead nvarchar(128) = N'Ga door'\nset @date = dbo.workDate()\nSET @transactiondate = dbo.abcdate()\n\nIF dbo.workDate() <> dbo.abcdate() AND @button IS NULL\n\tBEGIN\n\tEXEC sp_api_modal_text 'LET OP! DE WERKDATUM STAAT NIET OP VANDAAG.','text-danger font-weight-bold'\n\tEXEC sp_api_modal_button @name='@button',@value=@buttongoahead,@valueout = @button OUT,@key='Pagedown',@class='bg-danger text-light'\n\tEXEC sp_api_modal_button @name='@button',@value=@buttonescape,@valueout = @button OUT,@key='ESCAPE',@class='bg-danger text-light'\n\t\tIF @button = @buttonescape\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_clear\n\t\tEND\n\tEND\n\t\nIF @button = @buttongoahead OR dbo.workdate() = dbo.abcdate()\n\tBEGIN\n\tEXEC sp_api_modal_clear\n\tEXEC sp_api_modal_text 'Kies een klant:','text-primary'\n\t--SET @reducer = CONCAT('company_id = ',@company_id)\n\tSET @reducer = 'isDisabled = 0'\n\tEXEC sp_api_modal_select @card_name = N'klant',@value = @company_id OUT,@reducer = @reducer,@focus = 1\n\tEND\n\t\nIF @company_id > 0 \n\nBEGIN\n\t--DECLARE @only_new_is_possible BIT = 0\n\tDECLARE @reducer_location nvarchar(max) = N'Company_ID = ' + @company_id + ' OR id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID =' + @company_id + ')'\n--\tDECLARE @reducer_location nvarchar(max) = N'id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID =' + @company_id + ')'\n\tIF (SELECT LOCATIONS = count(Location_ID) FROM xCompanyxLocation WHERE Company_ID = @company_id) > 1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_text 'Vertrek Datum:','text-primary'\n\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\tEXEC sp_api_modal_input @name='Logistic',@value = @opmerking OUT,@placeholder = N'Opmerking voor loods'\n\t\t\tEXEC sp_api_modal_input @name='Relation',@value = @opmerkingrelation OUT,@placeholder = N'Referentie voor klant'\n\t\t\tEXEC sp_api_modal_text 'Kies een sublocatie van klant:','text-primary'\n\t\t\tEXEC sp_api_modal_select @card_name = N'xlocation',@value = @location_id OUT,@reducer = @reducer_location\n\t\t\t/*\n\t\t\t\tIF @location_id > 0\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\t\t\tEND\n\t\t\t*/\n\t\tEND\n\tIF (SELECT LOCATIONS = count(Location_ID) FROM xCompanyxLocation WHERE Company_ID = @company_id) = 1 AND (SELECT LOCATIONS = count(id) FROM xLocation WHERE Company_ID = @company_id) = 1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_text 'Vertrek Datum:','text-primary'\n\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\tEXEC sp_api_modal_input @name='Logistic',@value = @opmerking OUT,@placeholder = N'Opmerking voor loods'\n\t\t\tEXEC sp_api_modal_input @name='Relation',@value = @opmerkingrelation OUT,@placeholder = N'Referentie voor klant'\n\t\tEND\n\t/*\n\tSELECT id = xLocation.id, name=LocationCode\n\t\tINTO #locations\n\t\tFROM xLocation WHERE Company_ID = @company_id OR id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID = @company_id)\n\tEXEC sp_api_modal_select_table @tmptable = N'#locations',@value = @location_id OUT,@focus=1,@class='mt-3'\n\t*/\n\n\t--IF @location_id > 0\n\n\tEXEC sp_api_modal_text 'Kies een optie:','text-primary font-weight-bold display-4 text-center'\n\tEXEC sp_api_modal_button @name='button',@value=@button1,@valueout = @button OUT,@key='Enter'\n\t\n\tIF EXISTS (SELECT * FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate <= @date)\n\t\tBEGIN\n\t\tEXEC sp_api_modal_button @name='button',@value=@button2,@valueout = @button OUT,@key='F2'\n\t\tEND\n\t\t\n\tEXEC sp_api_modal_button @name='button',@value=@button4,@valueout = @button OUT,@key='F1'\n\tIF @button = @button4\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_clear\n\t\t\tEXEC sp_api_modal_button @name='button',@value=@button5,@valueout = @button OUT,@key='1'\n\t\t\tEXEC sp_api_modal_button @name='button',@value=@button6,@valueout = @button OUT,@key='2'\n\t\tEND\n\t\t\tIF @button = @button5\n\t\t\t\tBEGIN\n\t\t\t\t\tDECLARE @GotoOwnLocatie nvarchar(2000)\n\t\t\t\t\tSET @GotoOwnLocatie = N'/adres/'+@company_id+'/xlocation'\n\t\t\t\t\tEXEC sp_api_goto @GotoOwnLocatie,@referer_path=N'/verkoop'\n\t\t\t\tEND\n\t\t\tIF @button = @button6\n\t\t\t\tBEGIN\n\t\t\t\t\tDECLARE @GotoWorkLocatie nvarchar(2000)\n\t\t\t\t\tSET @GotoWorkLocatie = N'/adres/'+@company_id+'/company_locations'\n\t\t\t\t\tEXEC sp_api_goto @GotoWorkLocatie,@referer_path=N'/verkoop'\n\t\t\t\tEND\n\t\t\n\t\t/*\n\tIF EXISTS (SELECT * FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date)\n\t\tBEGIN\n\t\tEXEC sp_api_modal_button @name='button',@value=@button3,@valueout = @button OUT,@key='F2'\n\t\t\tSELECT TOP 1\n\t\t\t\ttv_companyname\n\t\t\t\t,transactiondate\n\t\t\t\t,[GERESERVEERD*] = 'GERESERVEERD'\n\t\t\t\t,id\n\t\t\t\tINTO #LASTORDER\n\t\t\tFROM q_xtransactionheader\n\t\t\tWHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date ORDER BY id DESC\n\t\t\tEXEC sp_api_modal_table @tmptable=N'#LASTORDER',@orderby=N'ORDER BY 3 ASC'\n\t\tEND\n\t\t*/\n/*\t\t\nELSE\n\t\tIF (select COUNT(id) from xlocation where company_id = @company_id ) = 1 \n\t\t\tBEGIN\n\t\t\t\tSET @only_new_is_possible = 1\n\t\t\tEND\n*/ \n\tIF @button = @button1 --OR @only_new_is_possible = 1\n\t\tBEGIN\n\t\tDELETE FROM api_storage WHERE card_id = (SELECT id FROM api_card WHERE name = N'verkoop') AND child_id = 0 AND user_id = @user_id\n\t\tEXEC sp_api_modal_clear\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'CounterParty_ID',@company_id,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Destination_ID',@location_id,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'TransactionDate',@transactiondate,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'advTransportDep',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'unloadingdate',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'loadingdate',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Logistic',@opmerking,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Relation',@opmerkingrelation,0\n\t\t\tEXEC @new_id = sp_api_modal_save N'verkoop',0\n\t\t\tIF @new_id > 0\n\t\t\t\tBEGIN\n\t\t\t\t\t/*SET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'*/\n\t\t\t\t\tSET @goto = N'/verkoop/'+@new_id+'/ctr2/0/stockloc_ctr2'\n\t\t\t\t\tEXEC sp_api_toast N'Nieuwe verkoop gestart',N'alert-primary'\n\t\t\t\t\t--SET @search = N'?id='+@new_id\n\t\t\t\t\tSET @search = N'/verkoop/'+@new_id+'/ctr2'\n\t\t\t\t\tDECLARE @update_current_search nvarchar(4000) =CONCAT(N'?id=',@new_id)\n\t\t\t\t\tEXEC sp_api_goto @goto,@referer_path=@search,@referer_search=N'',@update_current_search=@update_current_search\n\t\t\t\tEND\n\t\t\tELSE\n\t\t\t\tEXEC sp_api_toast N'Error nieuwe verkoop',N'alert-danger'\n\t\t\tEXEC sp_api_modal_clear\n\t\tEND\n\tIF @button = @button2\n\t\tBEGIN\n\t\t\tSET @new_id = (SELECT TOP 1 id FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate <= @date ORDER BY id DESC)\n\t\t\t/*SET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'*/\n\t\t\tSET @goto = N'/verkoop/'+@new_id+'/ctr2/0/stockloc_ctr2'\n\t\t\tSET @search = N'/verkoop/'+@new_id+'/ctr2'\n\t\t\tEXEC sp_api_goto @goto,@referer_path=@search,@referer_search=N''\n\t\t\t--SET @search = N'?id='+@new_id\n\t\t\t--EXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\tEND\n\tIF @button = @button3\n\t\tBEGIN\n\t\t\tSET @new_id = (SELECT TOP 1 id FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date ORDER BY id DESC)\n\t\t\t/*SET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'*/\n\t\t\tSET @goto = N'/verkoop/'+@new_id+'/ctr2/0/stockloc_ctr2'\n\t\t\tSET @search = N'/verkoop/'+@new_id+'/ctr2'\n\t\t\tEXEC sp_api_goto @goto,@referer_path=@search,@referer_search=N''\n\t\t\t--SET @search = N'?id='+@new_id\n\t\t\t--EXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\tEND\n\tEXEC sp_api_modal_button @name='button',@value=@buttonescape,@valueout = @button OUT,@key='ESCAPE',@class='bg-danger text-light'\n\tIF @button = @buttonescape\n\tBEGIN\n\tEXEC sp_api_modal_clear\n\tRETURN;\n\tEND\nEND\n",
            "action_id": 258,
            "action_name": "Insert Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @company_id nvarchar(32),@new_id nvarchar(32),@goto nvarchar(2000),@search nvarchar(2000), @location_id nvarchar(32), @reducer nvarchar(max), @date nvarchar(128), @opmerking nvarchar(128), @opmerkingrelation nvarchar(128)\n,@button1 nvarchar(128) = N'Nieuwe verkoop'\n,@button2 nvarchar(128) = N'Laatste open verkoop'\n,@button3 nvarchar(128) = N'Gereserveerde verkoop'\n,@buttonescape nvarchar(128) = N'Ga terug'\n,@buttongoahead nvarchar(128) = N'Ga door'\nset @date = dbo.workDate()\n\nIF dbo.workDate() <> dbo.abcdate() AND @button IS NULL\n\tBEGIN\n\tEXEC sp_api_modal_text 'LET OP! DE WERKDATUM STAAT NIET OP VANDAAG.','text-danger font-weight-bold'\n\tEXEC sp_api_modal_button @name='@button',@value=@buttongoahead,@valueout = @button OUT,@key='+',@class='bg-danger text-light'\n\tEXEC sp_api_modal_button @name='@button',@value=@buttonescape,@valueout = @button OUT,@key='ESCAPE',@class='bg-danger text-light'\n\t\tIF @button = @buttonescape\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_clear\n\t\tEND\n\tEND\n\t\nIF @button = @buttongoahead OR dbo.workdate() = dbo.abcdate()\n\tBEGIN\n\tEXEC sp_api_modal_clear\n\tEXEC sp_api_modal_text 'Kies een klant:','text-primary'\n\tEXEC sp_api_modal_select @card_name = N'klant',@value = @company_id OUT,@focus = 1\n\tSET @reducer = CONCAT('company_id = ',@company_id)\n\tEND\n\t\nIF @company_id > 0 \n\nBEGIN\n\t--DECLARE @only_new_is_possible BIT = 0\n\tDECLARE @reducer_location nvarchar(max) = N'Company_ID = ' + @company_id + ' OR id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID =' + @company_id + ')'\n--\tDECLARE @reducer_location nvarchar(max) = N'id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID =' + @company_id + ')'\n\tIF (SELECT LOCATIONS = count(Location_ID) FROM xCompanyxLocation WHERE Company_ID = @company_id) > 1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\tEXEC sp_api_modal_input @name='Logistic',@value = @opmerking OUT\n\t\t\tEXEC sp_api_modal_input @name='Relation',@value = @opmerkingrelation OUT\n\t\t\tEXEC sp_api_modal_text 'Kies een sublocatie van klant:','text-primary'\n\t\t\tEXEC sp_api_modal_select @card_name = N'xlocation',@value = @location_id OUT,@reducer = @reducer_location\n\t\t\t/*\n\t\t\t\tIF @location_id > 0\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\t\t\tEND\n\t\t\t*/\n\t\tEND\n\tIF (SELECT LOCATIONS = count(Location_ID) FROM xCompanyxLocation WHERE Company_ID = @company_id) = 1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-25 mt-3',@focus=1\n\t\t\tEXEC sp_api_modal_input @name='Logistic',@value = @opmerking OUT\n\t\t\tEXEC sp_api_modal_input @name='Relation',@value = @opmerkingrelation OUT\n\t\tEND\n\t/*\n\tSELECT id = xLocation.id, name=LocationCode\n\t\tINTO #locations\n\t\tFROM xLocation WHERE Company_ID = @company_id OR id IN (SELECT Location_ID FROM xCompanyxLocation WHERE Company_ID = @company_id)\n\tEXEC sp_api_modal_select_table @tmptable = N'#locations',@value = @location_id OUT,@focus=1,@class='mt-3'\n\t*/\n\n\t--IF @location_id > 0\n\n\tEXEC sp_api_modal_text 'Kies een optie:','text-primary font-weight-bold display-4 text-center'\n\tEXEC sp_api_modal_button @name='button',@value=@button1,@valueout = @button OUT,@key='Insert'\n\t\n\tIF EXISTS (SELECT * FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate <= @date)\n\t\tBEGIN\n\t\tEXEC sp_api_modal_button @name='button',@value=@button2,@valueout = @button OUT,@key='F1'\n\t\tEND\n\t\t\n\tIF EXISTS (SELECT * FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date)\n\t\tBEGIN\n\t\tEXEC sp_api_modal_button @name='button',@value=@button3,@valueout = @button OUT,@key='F2'\n\t\t\tSELECT TOP 1\n\t\t\t\ttv_companyname\n\t\t\t\t,transactiondate\n\t\t\t\t,[GERESERVEERD*] = 'GERESERVEERD'\n\t\t\t\t,id\n\t\t\t\tINTO #LASTORDER\n\t\t\tFROM q_xtransactionheader\n\t\t\tWHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date ORDER BY id DESC\n\t\t\tEXEC sp_api_modal_table @tmptable=N'#LASTORDER',@orderby=N'ORDER BY 3 ASC'\n\t\tEND\n/*\t\t\nELSE\n\t\tIF (select COUNT(id) from xlocation where company_id = @company_id ) = 1 \n\t\t\tBEGIN\n\t\t\t\tSET @only_new_is_possible = 1\n\t\t\tEND\n*/ \n\tIF @button = @button1 --OR @only_new_is_possible = 1\n\t\tBEGIN\n\t\tDELETE FROM api_storage WHERE card_id = (SELECT id FROM api_card WHERE name = N'verkoop') AND child_id = 0 AND user_id = @user_id\n\t\tEXEC sp_api_modal_clear\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'CounterParty_ID',@company_id,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Destination_ID',@location_id,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'TransactionDate',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'advTransportDep',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'unloadingdate',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'loadingdate',@date,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Logistic',@opmerking,0\n\t\t\tEXEC sp_api_modal_post N'verkoop',N'Relation',@opmerkingrelation,0\n\t\t\tEXEC @new_id = sp_api_modal_save N'verkoop',0\n\t\t\tIF @new_id > 0\n\t\t\t\tBEGIN\n\t\t\t\t\tSET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'\n\t\t\t\t\tEXEC sp_api_toast N'Nieuwe verkoop gestart',N'alert-primary'\n\t\t\t\t\tSET @search = N'?id='+@new_id\n\t\t\t\t\tEXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\t\t\tEND\n\t\t\tELSE\n\t\t\t\tEXEC sp_api_toast N'Error nieuwe verkoop',N'alert-danger'\n\t\t\tEXEC sp_api_modal_clear\n\t\tEND\n\tIF @button = @button2\n\t\tBEGIN\n\t\t\tSET @new_id = (SELECT TOP 1 id FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate <= @date ORDER BY id DESC)\n\t\t\tSET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'\n\t\t\tSET @search = N'?id='+@new_id\n\t\t\tEXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\tEND\n\tIF @button = @button3\n\t\tBEGIN\n\t\t\tSET @new_id = (SELECT TOP 1 id FROM xTransactionHeader WHERE status=N'openSale' AND CounterParty_ID = @company_id AND Transactiondate > @date ORDER BY id DESC)\n\t\t\tSET @goto = N'/verkoop/'+@new_id+'/stock_ctr2'\n\t\t\tSET @search = N'?id='+@new_id\n\t\t\tEXEC sp_api_goto @goto,@referer_path=N'/verkoop',@referer_search=@search\n\t\tEND\n\tEXEC sp_api_modal_button @name='button',@value=@buttonescape,@valueout = @button OUT,@key='ESCAPE',@class='bg-danger text-light'\n\tIF @button = @buttonescape\n\tBEGIN\n\tEXEC sp_api_modal_clear\n\tRETURN;\n\tEND\nEND\n",
            "action_id": 259,
            "action_name": "Insert Order",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @date nvarchar(128),@date2 nvarchar(128),@button nvarchar(128),@TransComp nvarchar(128)\r\n--set @date = dbo.workDate()\r\nEXEC sp_api_modal_text 'Zoek op transport bedrijf'\r\nEXEC sp_api_modal_input @name='Transporteur',@value = @TransComp OUT,@focus=1,@select=1 -- zoek veld\r\nEXEC sp_api_modal_text 'Van:'\r\nEXEC sp_api_modal_date @name='Date',@value = @date OUT,@class='w-24' -- zoek veld\r\nEXEC sp_api_modal_text 'Tot en met:'\r\nEXEC sp_api_modal_date @name='Date2',@value = @date2 OUT,@class='w-24' -- zoek veld\r\n--SET @date2 = CONCAT(@date2,' 23:59:59.999')\r\nSET @button = 'DepartingPalletsLijst'\r\nEXEC sp_api_modal_button @name='button',@value = 'DepartingPalletsLijst',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\r\nEXEC sp_api_modal_button @name='button',@value = 'ArrivedPalletsLijst',@valueout = @button OUT,@class = 'btn-primary',@key = 'F2'\r\n\r\nIF @button =  'DepartingPalletsLijst'\r\nBEGIN\r\nSELECT *\r\nINTO #DepartingPalletsLijst\r\nFROM          RV_TransportPalletLijst\r\nWHERE\t\t(TransportStatus = 'Departing') AND (TransportDate BETWEEN @date AND @date2) AND (@TransComp is NULL OR [TransComp*] LIKE @TransComp+'%')\r\nEXEC sp_api_modal_table @tmptable=N'#DepartingPalletsLijst',@orderby=N'ORDER BY [TransComp*] ASC'\r\nEND \r\n\r\nIF @button =  'ArrivedPalletsLijst'\r\nBEGIN\r\nSELECT *\r\nINTO #ArrivedPalletsLijst\r\nFROM          RV_TransportPalletLijst\r\nWHERE\t\t(TransportStatus = 'Arrived') AND (TransportDate BETWEEN @date AND @date2) AND (@TransComp is NULL OR [TransComp*] LIKE @TransComp+'%')\r\nEXEC sp_api_modal_table @tmptable=N'#ArrivedPalletsLijst',@orderby=N'ORDER BY [TransComp*] ASC'\r\nEND \r\n",
            "action_id": 260,
            "action_name": "Pallet Lijst",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "--EXEC sp_api_toast @parent_parent_id\n--exec sp_api_toast @User\n\t\nDECLARE @CTHID INT = {[verkoop].id} --200818 curly\nIF @CTHID IS NULL begin\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\n\t\tRETURN;\n\t\tend\n--ELSE EXEC sp_api_toast @CTHID\n\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200), @StockID int, @Lotnumber nvarchar(200), @UnMapped nvarchar(20)\n--stock_id er bij, want nu wordt vanuit partij-ctr verkocht...\nSELECT @xDesc=p.[Detail]\n\t\t,@mes= concat('Verkoop uit Partij ',p.Lotnumber,':  ' , p.[Detail]) \n\t\t,@Coretype= p.coretype\n\t\t,@FustID=p.Fust_ID\n\t\t,@StockID=p.Stock_ID\n\t\t,@Lotnumber=p.Lotnumber \n\t\t,@UnMapped=p.UnMapped\n\tfrom Q_xTransactiondetail p where p.id=@ID --@main_db.dbo.\n--EXEC sp_api_modal_text @mes,'h2 text-primary'\n\nIF {[verkoop].status} not in ('openSale') AND @Coretype='FOOD' BEGIN --200924 fust mag wel worden bij of afgeboekt\n\tEXEC sp_api_modal_alert 'U kunt alleen (retour-)FUST toevoegen, want de order is definitief.'\n\tEXEC sp_api_modal_clear\t\t\n\tRETURN;\t\n\tend\n\n-- 200629 Uitbreiding inkoop vanuit diverse contexten: Zoek CTH ; bijv als we afkomstig zijn van een regel, dan is CTH te vinden in de regel\n--if @parent_card_name ='verkoop'\tset @CTHID=@parent_id\n--if @parent_card_name = 'ctr2' set @CTHID=(select TransactionHeader_ID from xtransactiondetail where xtransactiondetail.id=@parent_id)\n\n\n------\nIF @coretype in('CRATE','PALLET')\n\tBEGIN\n\t\tSELECT @Fustsaldo=Fustsaldo from @main_db.dbo.FustSaldo_FC(@FustID,{[verkoop].Counterparty_ID})\n\t\tEXEC sp_api_toast @Fustsaldo\n\t\t-- breid DECLARE message uit met het fust-saldo\n\t\tIF @FustSaldo is not NULL\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') actueel saldo bij deze klant: ',@fustsaldo)\n\t\tELSE\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') => let op: deze klant heeft dit fust nooit eerder gehad!')\n\tEND\n\n\n\n\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20),@opmerking nvarchar(50) --='100'\nDECLARE @CounterpartyID int\nDECLARE @FlowModel int\nDECLARE @THDT INT\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=FlowModel_ID,@THDT=TDT From xTransactionHeader CTH where CTH.ID=@CTHID\n--200630 was@parent_id\n\n--200708 => ??? WAAROM GAAT DIT NIET ??? select @Prijs= @main_db.dbo.StockPrice(@ID,@CTHID,NULL,NULL,NULL,NULL,NULL,NULL,NULL)\n\nif isnull(@Prijs,0)=0\n\tbegin\n\t\tSELECT top 1 @prijs = ctr.ctrPRICE FROM xctrtotals ctr WHERE ctr.ctrprice > 0 AND\n\t\tctr.Counterparty_ID=@CounterpartyID AND ctr.ctrStock_ID =@ID ORDER BY ctr.id DESC -- laatste prijs!\n\tend\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\nIF @coretype in('FOOD')\n\tBEGIN\n\t\tEXEC sp_api_modal_text 'Prijs'\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT\n\tEND\n\t\tEXEC sp_api_modal_text 'Opm. loods'\n\t\tEXEC sp_api_modal_input @name='opmerking',@value = @opmerking OUT\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\n\nIF (SELECT PATINDEX('%[^0-9.,-]%', @prijs)) > 0 OR (SELECT PATINDEX('%[^0-9-]%', @aantal)) > 0\n\tBEGIN\n\tEXEC sp_api_modal_clear\t\n\t\t/*\n\t\tIF @id = ANY (select stock_id from xtransactiondetail where TransactionHeader_ID = @CTHID AND stock_id = @id) \n\t\tBEGIN\n\t\t\tSELECT @QTYCTR = sum(Amount) from xTransactiondetail where @id = stock_id AND TransactionHeader_ID = @CTHID\n\t\t\tEXEC sp_api_modal_text 'Let op! Dit artikel bestaat al in de bestelling!','text-danger font-weight-bold h2 text-center'\n\t\t\tEXEC sp_api_modal_text 'Momenteel in bestelling:','text-danger font-weight-bold h2 text-center'\n\t\t\tEXEC sp_api_modal_text @QTYCTR,@class = 'text-danger font-weight-bold display-4 text-center'\n\t\tEND\n\t\t*/\n\t\tEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\n\t\t\n\t\tIF (SELECT PATINDEX('%[^0-9-]%', @aantal)) > 0\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text 'Aantal niet goed ingevuld','text-danger'\n\t\t\t\tEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@class = 'is-invalid',@focus=1\n\t\t\tEND\n\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text 'Aantal'\n\t\t\t\tEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT\n\t\t\tEND\n\t\tIF (SELECT PATINDEX('%[^0-9.,-]%', @prijs)) > 0\n\t\t\tBEGIN\n\t\t\tIF @coretype in('FOOD','SERVICE')\n\t\t\t\tBEGIN\n\t\t\t\t\tEXEC sp_api_modal_text 'Prijs niet goed ingevuld','text-danger'\n\t\t\t\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT,@class = 'is-invalid',@focus=1\n\t\t\t\tEND\n\t\t\tEND\n\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text 'Prijs'\n\t\t\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT\n\t\t\tEND\n\t\tEXEC sp_api_modal_text 'Opm. loods'\n\t\tEXEC sp_api_modal_input @name='opmerking',@value = @opmerking OUT\n\t\tEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\n\t\n\t\tIF (select count(id) from view_coco_prijshistory where {[Stock_ctr2].ID} = Stock_ID AND xCompanyID = {[verkoop].counterparty_id} AND TDT = 2) > 0\n\t\tBEGIN\n\t\tselect\n\t\t\tAmount\n\t\t\t,Price\n\t\t\t,insUser\n\t\t\t,[order_NR] = id\n\t\t\t,TransactionDate\n\t\t\tINTO #prijshistory2\n\t\t\tFROM view_coco_prijshistory\n\t\twhere {[Stock_ctr2].ID} = Stock_ID AND xCompanyID = {[verkoop].counterparty_id} AND TDT = 2\n\t\tEXEC sp_api_modal_table @tmptable=N'#prijshistory2',@orderby=N'ORDER BY TransactionDate DESC OFFSET 0 ROWS FETCH NEXT 8 ROWS ONLY'\n\t\tEND\n\t\tRETURN\n\tEND\n\nDECLARE @FromLoc nvarchar(200) = {[stockloc_ctr2].xLocation_ID} \n\nIF @button IS NOT NULL\n\tBEGIN\n\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- 200924 zorg dat je ook komma mag gebruiken als decimaal scheidingsteken\n\t\tIF \t\t--TRY_CAST(@prijs as decimal) > 0 AND \n\t\t\t\tTRY_CAST(@aantal as int) > 0 AND TRY_CAST(@aantal as int) <= TRY_CAST(@UnMapped as int) -- 210506 CG Mag geen groter aantal dan beschikbaar toewijzen vanaf een partij \n\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\n\t\t\tBEGIN\n\t\t\t\tDECLARE @mapfustpartijregel int, @newVerkoopCTR_ID int\n\t/* NORMAAL */\n\t\t\t\tIF @coretype in('FOOD') --agf handel geselecteerd\n\t\t\t\t\tBEGIN \n\t\t\t\t\t\texec @newVerkoopCTR_ID=@main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@StockID,@Amount=@Aantal,@Price=@Prijs, @User=@User,@Logistic=@Opmerking,@source_ID=@FromLoc\n\t\t\t\t\t\t--map gelijk tegen deze partijregel\n\t\t\t\t\t\tIF @newVerkoopCTR_ID is not null\tEXECUTE @main_db.dbo.map @newVerkoopCTR_ID,@ID -- = IVmap\n\t\t\t\t\t\t--\tEN anders zo:\n\t\t\t\t\t\t--\tinsert into xivlink(linkAantal,itd,vtd) values (@Aantal,@newVerkoopCTR_ID,@ID)\n\t\t\t\t\t\tselect @mes = concat('PARTIJVERKOOP: ',@Aantal, ' colli ',@xDesc,' toegevoegd aan de order')\n\t\t\t\t\t\texec sp_api_toast @mes\n\t\t\t\t\tEND\n\t/* FUST!! */\n\t\t\t\tIF @coretype in('CRATE','PALLET') --leeg fust geselecteerd\n\t\t\t\t\tBEGIN \n\t\t\t\t\t\tSET @mapfustpartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\n\t\t\t\t\t\tIF @mapfustpartijregel is not null \n\t\t\t\t\t\t\tbegin\n\t\t\t\t\t\t\t\texec @newVerkoopCTR_ID=@main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@StockID,@Amount=@Aantal,@Price=@Prijs, @User=@User,@Logistic=@Opmerking,@source_ID=@FromLoc\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t--MAP retour fust aan FUSTPARTIJ\n\t\t\t\t\t\t\t\tinsert into xivlink(linkAantal,itd,vtd) values (@Aantal,@newVerkoopCTR_ID,@mapfustpartijregel)\n\n\t\t\t\t\t\t\t\tselect @mes = concat('Er zijn ',@Aantal, ' colli FUST toegevoegd aan de order')\n\t\t\t\t\t\t\t\texec sp_api_toast @mes\n\t\t\t\t\t\t\tend\n\n\t\t\t\t\tEND\n\n\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\n\t\t\tEND\n\t\tELSE\n\n\t\t\tIF TRY_CAST(@aantal as int) > TRY_CAST(@UnMapped as int)\n\t\t\t\tBEGIN\n\t\t\t\t\tEXEC sp_api_modal_text 'Ingevulde aantal is groter dan aantal beschikbaar!','text-danger'\n\t\t\t\tEND\n\t\t\tELSE\n\t\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\n\t\t\t\tEND\n\tEND \n",
            "action_id": 261,
            "action_name": "Partij verkoop",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "declare @LastStart datetime\r\nselect @laststart=startdate from xvalrate where endDate is null and code={[xvalrate].code} and contextID={[xvalrate].contextID}\r\nif @laststart is not NULL update xvalrate set enddate=@laststart -1 where ID=@ID",
            "action_id": 262,
            "action_name": "Pas einddatum aan",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/per_bronlijst'\r\n",
            "action_id": 263,
            "action_name": "PER Bronlijst",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": null,
            "action_id": 264,
            "action_name": "PER_clone_mag_niet",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "PriceHi > 0",
            "action_id": 265,
            "action_name": "phi0",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "Declare @sys_Report_Key nvarchar(200)='picklist' \ndeclare @test bit = 0 -- 0:LIVE; 1=TEST\nDECLARE @FixedPrinter_ID INT = 3\n\nIF (select count(id) from q_xtransactionheader where id in (select transactionheader_id from Q_xTransactionDetail where delayed = 1) AND id IN ({@ids})) > 0\nBEGIN\n\tEXEC sp_api_modal_text N'Een order is gereserveerd, Orders moeten eerst worden vrijgegeven!', N'h5'\nRETURN;\nEND\n\nEXEC sp_api_toast @sys_Report_Key\n\n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\n\n--ALS ER 1 geselecteerd is, kijk dan of er multi-bestemming gedefinieerd is..\n\nIF @IDS=@ID \n\tBEGIN \n\t\t--exec SP_API_Toast N'single id, dus evt keuze optie'\n\t\t\n\t\tDECLARE\t@ReportName nvarchar(200), @ReportSQL nvarchar(max) ,@RepDef_ID INT\n\n\t\t--210103 print naar van geest! (TO)\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@ID)\n\n\t\tset @Repdef_ID = (SELECT TOP 1 id FROM xRepDef WHERE sys_report_key = @sys_Report_Key)\n\t\tif @RepDef_ID is null \n\t\t\tBEGIN\n\t\t\t\tdeclare @Yell nvarchar(100)\n\t\t\t\tset @Yell = Concat(N'Er is geen report definitie voor ',@sys_Report_Key)\n\t\t\t\texec sp_api_toast @Yell\n\t\t\t\treturn;\n\t\t\tEND\n\tEND\n\n--MULTI\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_toast @cid\n\t\t--dit is nu alleen voor tellers en checks:\n\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@cid)\n\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = @Sys_Report_Key--'picklist' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@test = @test --hiermee schakel je tussen productie en test-modus\n\t\t\t,@FixedPrinter_ID = @FixedPrinter_ID\n\t\t--even registreren dat er wordt afgedrukt\n\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'CTH'\t,@Context_Key_ID=@cid,@Report_CODE=N'PICK'\n\n\t\t--210104 end sum voor alles bijwerken\n\t\texecute @main_db.dbo.CTH_Endsum @cid\n\n\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n",
            "action_id": 266,
            "action_name": "pickbon",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "Declare @sys_Report_Key nvarchar(200)='picklist' \ndeclare @test bit =0 -- 0:LIVE; 1=TEST\ndeclare @ForcedAction_ID INT =31 -- (een ID of NULL) => GAAT NU FIXED NAAR xRepAction 31 print op loods\nDECLARE @FixedPrinter_ID INT = 4\nIF (select count(id) from q_xtransactionheader where id in (select transactionheader_id from Q_xTransactionDetail where delayed = 1) AND id IN ({@ids})) > 0\nBEGIN\n\tEXEC sp_api_modal_text N'Een order is gereserveerd, Orders moeten eerst worden vrijgegeven!', N'h5'\nRETURN\nEND\n\t\nEXEC sp_api_toast @sys_Report_Key\n\n\nDECLARE @cursor_ids CURSOR,@cid INT\nDECLARE @toCompany_ID INT \nDECLARE @fromCompany_ID INT = (select top 1 id from xTenantKey)\ndeclare @FixedRepAction_ID int \t\n\n--ALS ER 1 geselecteerd is, kijk dan of er multi-bestemming gedefinieerd is..\n\nif @IDS=@ID \n\tbegin \n\t\t--exec SP_API_Toast N'single id, dus evt keuze optie'\n\t\t\n\t\tDECLARE\t@ReportName nvarchar(200), @ReportSQL nvarchar(max) ,@RepDef_ID INT\n\n\t\t--210103 print naar van geest! (TO)\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@ID)\n\n\t\tset @Repdef_ID = (SELECT TOP 1 id FROM xRepDef WHERE sys_report_key = @sys_Report_Key)\n\t\tif @RepDef_ID is null \n\t\t\tbegin\n\t\t\t\tdeclare @Yell nvarchar(100)\n\t\t\t\tset @Yell = Concat(N'Er is geen report definitie voor ',@sys_Report_Key)\n\t\t\t\texec sp_api_toast @Yell\n\t\t\t\treturn;\n\t\t\tend\n\t\t\n\t\t-- als er meer dan 1 RepAction is, dan vragen welke...\n\t\t--if (select count(id) FROM xRepAction WHERE ReportName_ID = @RepDef_ID AND ToCompany_ID = @ToCompany_ID AND fromCompany_ID = @fromCompany_ID\tand isAlternative=1) >= 1 \n\n--210104 ALS FORCED IS OPGEGEVEN, GA DAN ALTIJD DAAR HEEN!\nIF @ForcedAction_ID IS NOT NULL SET @FixedRepAction_ID=@ForcedAction_ID\n\nIF @ForcedAction_ID IS NULL\n\t\t\tbegin --meerdere opties!! dus kiezen\n\t\t\t\tEXEC sp_api_modal_text N'Standaard bestemming(en):', N'h5'\n\t\t\t\tDECLARE @FixedRepAction_ID_choosen int, @sbutton nvarchar(128)\n\t\t\t\t\t,@reducer nvarchar(max) = CONCAT('ISNULL(isAlternative,0) = 0 AND ReportName_ID = ',@RepDef_ID,' AND ToCompany_ID = '\n\t\t\t\t\t\t\t\t,@ToCompany_ID,' AND fromCompany_ID = ',@fromCompany_ID)\n\n\t\t\t\tEXEC sp_api_modal_table @card_name = 'repaction', @reducer = @reducer\n\t\t\t\tEXEC sp_api_modal_button @name='Kies',@value = 'Kies standaard', @valueout = @sbutton OUT,@class='btn-primary',@key='F1'\n\t\t\t\tSET @reducer = CONCAT('ReportName_ID = ',@RepDef_ID,' AND ToCompany_ID = ',@ToCompany_ID,' AND fromCompany_ID = ',@fromCompany_ID)\n\t\t\t\tEXEC sp_api_modal_select @card_name = 'repaction',@value = @FixedRepAction_ID_choosen OUT,@focus = 1,@reducer = @reducer\n\t\t\t\t--EXEC sp_api_modal_text @FixedRepAction_ID\n\t\t\t\tIF @FixedRepAction_ID_choosen IS NOT NULL\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_button @name='Kies',@value = 'Kies alternatief', @valueout = @sbutton OUT,@class='btn-primary',@key='F2'\n\t\t\t\t\t\tIF @sbutton = 'Kies alternatief' SET @FixedRepAction_ID = @FixedRepAction_ID_choosen\n\t\t\t\t\tEND\n\t\t\t\tIF @sbutton IS NULL RETURN\n\t\t\tend\n\tend\n\n--MULTI\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_toast @cid\n\t\t--dit is nu alleen voor tellers en checks:\n\n\t\t--dit is de feitelijke \"run\"\n\t\tSET @toCompany_ID = (select Counterparty_id from xtransactionheader where id=@cid)\n\n\t\tEXEC sp_api_report_generate @id = @cid\n\t\t\t,@sys_report_key = @Sys_Report_Key--'picklist' --zie xrepdef\n\t\t\t,@toCompany_ID = @toCompany_ID\n\t\t\t,@fromCompany_ID = @fromCompany_ID\n\t\t\t,@FixedRepAction_ID=@FixedRepAction_ID --210102 Je kan nu hard een id mee geven \n\t\t\t,@test = @test --hiermee schakel je tussen productie en test-modus\n\t\t\t,@FixedPrinter_ID = @FixedPrinter_ID\n\t\t--even registreren dat er wordt afgedrukt\n\t\tEXEC @main_db.dbo.RunReport\t@TABLECONTEXT = N'CTH'\t,@Context_Key_ID=@cid,@Report_CODE=N'PICK'\n\n\t\t--210104 end sum voor alles bijwerken\n\t\texecute @main_db.dbo.CTH_Endsum @cid\n\n\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n",
            "action_id": 267,
            "action_name": "pickbon",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock>0 ",
            "action_id": 268,
            "action_name": "Positief",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "stock<>0 ",
            "action_id": 269,
            "action_name": "PosNeg",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @PriceLo FLOAT,@PriceHi FLOAT, @save nvarchar(10),@text nvarchar(max)\r\nSELECT * INTO #ids FROM string_split(@ids,',')\r\nSELECT @PriceLo = AVG(PriceLo),@PriceHi = AVG(PriceHi) FROM p_PriceEntryRow WHERE id IN(SELECT * FROM #ids)\r\nSET @text = N'Prijs '+CAST((SELECT count(*) FROM #ids) as nvarchar)+' producten'\r\nEXEC sp_api_modal_text @text ,'h4'\r\nEXEC sp_api_modal_text 'Laag'\r\nEXEC sp_api_modal_input @name='PriceLo', @value= @PriceLo OUT,@focus=1 \r\nEXEC sp_api_modal_text 'Hoog'\r\nEXEC sp_api_modal_input @name='PriceHi', @value= @PriceHi OUT\r\nEXEC sp_api_modal_button @name='Save',@value = 'Opslaan', @valueout = @save OUT,@class='btn-danger',@key='Enter'\r\nIF @save is not null\r\n\tBEGIN\r\n\t\tUPDATE p_PriceEntryRow SET PriceLo = @PriceLo, PriceHi =@PriceHi WHERE id IN (SELECT * FROM #ids)\r\n\t\tEXEC sp_api_modal_clear\r\n\tEND\r\n",
            "action_id": 270,
            "action_name": "prijs",
            "source_table": "api_card_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(128) ,@button nvarchar(128)\nEXEC sp_api_modal_input @name='search',@value = @search OUT,@focus=1\n\nSET @button = 'Landen'\nEXEC sp_api_modal_button @name='button',@value = 'Landen',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_button @name='button',@value = 'Steden',@valueout = @button OUT,@class = 'btn-primary',@key = 'F2'\nEXEC sp_api_modal_button @name='button',@value = 'Landen3',@valueout = @button OUT,@class = 'btn-primary',@key = 'F3'\nEXEC sp_api_modal_button @name='button',@value = 'Vroeg',@valueout = @button OUT,@class = 'btn-primary',@key = 'F4'\n\n\nIF @button = 'Landen'\n\tBEGIN\n\t\tSELECT TOP 50 Countryid, name_0 INTO #landen FROM xCountry WHERE name_0 LIKE @search+'%'\n\t\tEXEC sp_api_modal_table @tmptable=N'#landen'\n\tEND\n/*\n-- er kan maar 1 tijdelijke tabel zijn met de naam #landen; wil je meer, dan moet je een andere naam kiezen (#landen2)\nIF @button = 'Landen2'\n\tBEGIN\n\t\tSELECT TOP 50 * INTO #landen2 FROM xCountry WHERE name_0 LIKE @search+'%'\n\t\tEXEC sp_api_modal_table @tmptable=N'#landen2'\n\tEND\n*/\n\n--Je kan OOK de layout gebruiken van een bestaande kaart: ( hierbij wel oppassen voor SQL-injection !!)\n\tIF @button = 'Landen3'\n\t\tBEGIN\n\t\t\t--via layout normale kaart xCountry = 394 (zie apicard)\n\t\t\tDECLARE @reducer nvarchar(max) = N'Name_0 like '+dbo.escape_string(@search+'%')\n\t\t\tEXEC sp_api_modal_table @card_id=394,@reducer = @reducer\n\t\tEND\n\t\n\nIF @button = 'Steden'\n\tBEGIN\n\t\t--SET @Description = CONCAT(N'Historie', ' - ' + {[stock_ctr2].Description})\n--\t\tEXEC sp_api_modal_text @text = @Description,@class = 'h3 text-muted'\n\t\tSELECT TOP 50 id,name,[Land*]=(SELECT Name_0 FROM xCountry WHERE CountryID = Country_ID) INTO #steden FROM xCity WHERE name LIKE @search+'%' ORDER BY [Land*]\n\t\tEXEC sp_api_modal_table @tmptable=N'#steden'\n\tEND\n\nIF @button =  'Vroeg'\nBEGIN\nSELECT DISTINCT dbo.xStock.Stock AS Voorraad@, dbo.xStock.Stock + dbo.xStock.delayedIn + dbo.xStock.delayedOut AS VoorraadVerwacht@, \ndbo.xStock.Description, dbo.xStock.Size, dbo.xStock.Origin_Code, [EndTime*]=dbo.xTransactionHeader.EndTime\nINTO #Vroeg\nFROM            dbo.xTransactionHeader RIGHT OUTER JOIN\n                         dbo.xTransactionDetail ON dbo.xTransactionHeader.id = dbo.xTransactionDetail.TransactionHeader_ID RIGHT OUTER JOIN\n                         dbo.xStock ON dbo.xTransactionDetail.Stock_ID = dbo.xStock.id\nWHERE        (dbo.xStock.Stock < 0) and EndTime = 'Vroeg'\nEXEC sp_api_modal_table @tmptable=N'#Vroeg'\nEND\n",
            "action_id": 1,
            "action_name": "_sample_instant_report",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xrole'",
            "action_id": 2,
            "action_name": "a_Role",
            "source_table": "api_actions"
        },
        {
            "sql_source": "\nDECLARE @hclass nvarchar(255) = N'h4 pt-4'\n\t,@subclass nvarchar(255) = N'text-muted blockquote mt-4'\n\t,@codeclass nvarchar(255) = N'code pre mb-2'\n\t,@valueout nvarchar(255)\n\nEXEC sp_api_modal_text 'Action Help','h3 text-muted'\n\nEXEC sp_api_modal_text 'Performance tips',@hclass\nEXEC sp_api_modal_text 'To disable triggers on temp inserts/updates:',@subclass\nEXEC sp_api_modal_text 'IF TRY_CAST(SESSION_CONTEXT(N''api_save_confirmed'') as INT) = 0 RETURN',@codeclass\n\nEXEC sp_api_modal_text 'Choose option',@hclass\n\n\n\n\nEXEC sp_api_modal_text 'Choose option',@hclass\n\n\tEXEC sp_api_modal_text N'EXEC sp_api_modal_choose @list = N''Predefined,Custom,Later, Maybe'',@value = @button_choose OUT,@startkey=NULL',@codeclass\n\n\n\tEXEC sp_api_modal_text @text = N'Kies een optie met F-toetsen (@startkey=3)',@class = N'm-4 text-muted'\n\tDECLARE @button_choose nvarchar(128)\n\tEXEC sp_api_modal_choose @list = N'Predefined,Custom,wert,wertr,wywer,tqyer,twertq,ewrt',@value = @button_choose OUT,@startkey=3\n\tEXEC sp_api_modal_text @button_choose\n\n\tEXEC sp_api_modal_text @text = N'Kies een optie met beginletter-toetsen (spatie = geen, @startkey=NULL)',@class = N'm-4 text-muted'\n\tDECLARE @button_choose2 nvarchar(128)\n\tEXEC sp_api_modal_choose @list = N'Predefined,Custom, wert,wertr, wywer,tqyer, twertq,ewrt2',@value = @button_choose2 OUT,@startkey=NULL\n\tEXEC sp_api_modal_text @button_choose2\n\n\nEXEC sp_api_modal_text 'pathname',@hclass\n\nEXEC sp_api_modal_text 'go to url:',@subclass\nEXEC sp_api_modal_text '{\"pathname\":\"/verkoop\"}',@codeclass\n\nEXEC sp_api_modal_text 'add to current url with optional {selectedId}:',@subclass\nEXEC sp_api_modal_text '{\"addto\":\"{selectedId}/CTR\"}',@codeclass\n\nEXEC sp_api_modal_text 'stored_procedure',@hclass\n\nEXEC sp_api_modal_text 'modal text:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_text @text = N''This is a success!''\n\t,@class = N''alert alert-primary'', @translate = 1',@codeclass\nEXEC sp_api_modal_text @text = N'This is a success!',@class = N'alert alert-primary', @translate = 1\n\nEXEC sp_api_modal_text 'modal input:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_input @name=''Naam'',@max=5, @value= @valueout OUT,@focus=1',@codeclass\nEXEC sp_api_modal_input @name='Naam',@max=5, @value= @valueout OUT,@focus=0\n\nEXEC sp_api_modal_text 'modal input decimal:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_input_decimal @name=''Percentage'',@value= @Percentage OUT,@focus=1 [,@precision=18,@scale=2]',@codeclass\nDECLARE @Percentage decimal(18,2)\nEXEC sp_api_modal_input_decimal @name='Percentage', @value= @Percentage OUT\n\n\n\nEXEC sp_api_modal_text 'modal date:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_date @name=''Datum''@value= @valueout OUT,@focus=1',@codeclass\nEXEC sp_api_modal_date @name='Datum', @value= @valueout OUT,@focus=0,@class='w-24'\n\n\nEXEC sp_api_modal_text 'modal button:',@subclass\nEXEC sp_api_modal_text N'DECLARE @button1 nvarchar(128),@button_text1 nvarchar(128) = ''Opslaan''\nEXEC sp_api_modal_button @name=''button1'',@value = @button_text1, @valueout = @button1 OUT ,@class=''btn-danger'',@key=''Enter''',@codeclass\nDECLARE @button1 nvarchar(128),@button_text1 nvarchar(128) = 'Opslaan'\nEXEC sp_api_modal_button @name='button1',@value = 'Opslaan', @valueout = @valueout OUT,@class='btn-danger',@key='Enter'\nIF @valueout = 'Opslaan'\n\tBEGIN\n\t\tEXEC sp_api_modal_clear\n\t\tEXEC sp_api_statusbar N'HELP F1 - JA gedrukt!' ,'bg-danger col-sm-2 text-truncate',1 --> 1 is rechts\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_text 'modal route:',@subclass\nEXEC sp_api_modal_text N'EXEC  sp_api_modal_route @name = N''Verkoop Anaco'',@pathname=N''/verkoop''\n\t,@search =N''?id=2784'' ,@class = N''btn-success'' ,@key = N''F2''',@codeclass\nEXEC  sp_api_modal_route @name = N'Verkoop Anaco',@pathname=N'/verkoop',@search =N'?id=2784' ,@class = N'btn-success' ,@key = N'F2'\n\nEXEC sp_api_modal_text 'modal clear all previous components:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_clear',@codeclass\n\nEXEC sp_api_modal_text 'Alert box:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_alert N''Give me an alert''',@codeclass\n\nEXEC sp_api_modal_text 'modal get user setting:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_get N''my_fake_name'',@naam OUT',@codeclass\n\nEXEC sp_api_modal_text 'modal set user setting:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_set N''my_fake_name'',N''Jack van Vliet''',@codeclass\n\nEXEC sp_api_modal_text 'modal set modal value:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_value @name,NULL',@codeclass\n\n\nEXEC sp_api_modal_text 'modal set delete user setting:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_set N''my_fake_name'',NULL',@codeclass\n\nEXEC sp_api_modal_text 'modal set delete user setting:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_set N''my_fake_name'',NULL',@codeclass\n\nEXEC sp_api_modal_text 'Toast message:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_toast @text = N''Toast message Toast message !!! ???''\n,@class=N''bg-danger text-white'',@translate=1,@seconds=2',@codeclass\nEXEC sp_api_toast @text = N'Toast message Toast message !!! ???',@class=N'bg-danger text-white',@translate=1,@seconds=2\n\nEXEC sp_api_modal_text 'Send dispatch to modal, to dispatch something on the client:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_modal_dispatch N''{\"type\":\"stored_procedure\",\"name\":\"Choose columns\"}''',@codeclass\n\nEXEC sp_api_modal_text 'modal post and save to card example:',@subclass\nEXEC sp_api_modal_text N'IF TRY_CAST(@prijs as decimal) > 0 AND TRY_CAST(@aantal as int) > 0\n\tBEGIN\n\t\tEXEC sp_api_modal_post @card=''verkocht'',@column=''aantal'',@value=@aantal\n\t\tEXEC sp_api_modal_post @card=''verkocht'',@column=''prijs'',@value=@prijs\n\t\tEXEC sp_api_modal_post @card=''verkocht'',@column=''prosoort_id'',@value=@id\n\t\tEXEC sp_api_modal_save @card=''verkocht''\n\t\tEXEC sp_api_modal_clear\n\tEND',@codeclass\n\nEXEC sp_api_modal_text 'Push to statusbar:',@subclass\nEXEC sp_api_modal_text N'EXEC sp_api_statusbar N''HELP F1'' ,''bg-danger col-sm-1 text-truncate'',1 --> 1 is rechts',@codeclass\n\nEXEC sp_api_statusbar N'HELP F1' ,'bg-danger col-sm-1 text-truncate',0 --> 1 is rechts\n\nEXEC sp_api_modal_text 'Cursor for @ids:',@subclass\nEXEC sp_api_modal_text N'DECLARE @cursor CURSOR,@idval INT\nSET @cursor = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,'','')\nOPEN @cursor;\nFETCH NEXT FROM @cursor INTO @idval\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tEXEC sp_api_modal_text @idval\n\t\tFETCH NEXT FROM @cursor INTO @idval\n\tEND\nCLOSE @cursor;\nDEALLOCATE @cursor;\n',N'code'\n",
            "action_id": 3,
            "action_name": "sys_action_help",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 4,
            "action_name": "Actions",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 5,
            "action_name": "alle bedrijven",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xbol'",
            "action_id": 6,
            "action_name": "B/L",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 7,
            "action_name": "Back",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 8,
            "action_name": "Cardmenu",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 9,
            "action_name": "Children",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_choose_columns @card_id,@is_form",
            "action_id": 10,
            "action_name": "Choose columns",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @set nvarchar(max) -- CUSTOMIZE THIS!!! = N'name=name+''_clone'''\n\nEXEC sp_api_modal_alert N'Clone',N'Create a clone of this record?'\nDECLARE @clone_id nvarchar(32)\nEXEC @clone_id = sp_clone_record @basetable,@ids,@set=@set\nEXEC sp_api_modal_clear\nSET @path = @path+'/'+@clone_id\nEXEC sp_api_modal_text N'Record cloned',N'h4 text-muted'\nEXEC sp_api_modal_route @name = N'Go to clone',@pathname=@path,@key='Enter'\n",
            "action_id": 11,
            "action_name": "sys_clone",
            "source_table": "api_actions"
        },
        {
            "sql_source": "id in (SELECT company_id FROM xlocation WHERE xlocation.usecalculator=1)",
            "action_id": 12,
            "action_name": "CompaniesWithCalculator",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 13,
            "action_name": "Contactlijst",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 14,
            "action_name": "create idx geen idee",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_modal @class=N'w75'\n--EXEC sp_api_toast @parent_parent_id\n--exec sp_api_toast @User\nDECLARE /*@search nvarchar(128) = {[verkoop].CounterParty_ID.Code} ,@button nvarchar(128),*/@Description nvarchar(max)\nDECLARE @Counterparty_ID INT ={[verkoop].Counterparty_ID}\nDECLARE @PriceType nvarchar(10) =N'FIXED' -- 201215 wordt overschreven naar ZERO bij fust!\nif @Counterparty_ID IS NULL\n\tbegin\n\t\tset @Counterparty_ID={[klant].id} -- context is dan kennelijk \"verkoop direct vanaf de klant\"\n\tend\n\n\t\nDECLARE @CTHID INT = {[verkoop].id} --200818 curly\n--ALS CTHID NULL -> AANMAKEN\nif @CTHID IS NULL AND @Counterparty_ID IS NOT NULL --maak een nieuwe verkooporder aan\n\tbegin\n\t\tset @Counterparty_ID={[klant].id}\n\t\texec @CTHID = @main_db.dbo.CreateSelectCTH2 @Counterparty_ID\n\tend\n--ALS CTHID NOG STEEDS NULL -> Afbreken!\nIF @CTHID IS NULL begin\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\n\t\tRETURN;\n\t\tend\n\nDECLARE @Status nvarchar(50)\nDECLARE @FlowModel int\nDECLARE @THDT INT\nDECLARE @FRAFOT Nvarchar(3) -- 'FRA' OF 'FOT'\nDECLARE @SrcID int -- let op: slechts 'advies'\nDECLARE @DstID INT\n\nSELECT @Status=CTH.Status,@FlowModel=cth.FlowModel_ID,@THDT=cth.TDT,@FRAFOT=cth.FRAFOT, @srcID=cth.source_ID,@DstID=cth.Destination_ID From q_xTransactionHeader CTH where CTH.ID=@CTHID\nDECLARE @ctr_id int\nDECLARE @StockID int ={[stock_ctr2].id} -- 201030 beter dan '@ID'\nIF @StockID IS NULL SET @ctr_id = {[ctr2].id} --Alleen ctr_id halen indien NIET in stock_ctr2\nDECLARE @ctr_amount int = {[ctr2].Amount}\nDECLARE @ctr_price float = {[ctr2].Price}\nIF @StockID is NULL SET @StockID = {[ctr2].Stock_ID}\n\nIF @StockID is NULL \n\tbegin\n\t\tSET @StockID=@ID -- fall back gevaarlijk!!\n\t\texec sp_api_toast N'Pas op: het voorraad ID afkomstig uit PARENT'\n\tend\n\n\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200),@CPP120 nvarchar(10)\n\n--201030 IF er bij\nSELECT @xDesc=x.[Description],@mes= concat(IIF(@ctr_id IS NULL,'Selling ','Changing ') , x.[Description],N' (cpp ',x.cp120,N')') ,@Coretype= x.coretype,@FustID=x.Fust_ID, @CPP120=x.cp120 from xstock x where x.id=@StockID  --@main_db.dbo.\n--EXEC sp_api_modal_text @mes,'h2 text-primary'\n\nIF @Status not in ('openSale') AND @Coretype='FOOD' BEGIN --200924 fust mag wel worden bij of afgeboekt\n\tEXEC sp_api_modal_alert 'U kunt alleen leeg FUST toevoegen/terugnemen, want de order is definitief.'\n\tEXEC sp_api_modal_clear\t\t\n\tRETURN;\t\n\tend\n\n-- 200629 Uitbreiding inkoop vanuit diverse contexten: Zoek CTH ; bijv als we afkomstig zijn van een regel, dan is CTH te vinden in de regel\n--if @parent_card_name ='verkoop'\tset @CTHID=@parent_id\n--if @parent_card_name = 'ctr2' set @CTHID=(select TransactionHeader_ID from xtransactiondetail where xtransactiondetail.id=@parent_id)\n\n\n------\nIF @coretype in('CRATE','PALLET')\n\tBEGIN\n\t\tSELECT @Fustsaldo=Fustsaldo from @main_db.dbo.FustSaldo_FC(@FustID,@Counterparty_ID)--{[verkoop].Counterparty_ID})\n\t\tEXEC sp_api_toast @Fustsaldo\n\t\t-- breid DECLARE message uit met het fust-saldo\n\t\tIF @FustSaldo is not NULL\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') actueel saldo bij deze klant: ',@fustsaldo)\n\t\tELSE\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') => let op: deze klant heeft dit fust nooit eerder gehad!')\n\t\tset @PriceType=N'ZERO'\n\tEND\n\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20) --='100'\n--DECLARE @CounterpartyID int\n\n--201022\ndeclare @dayprice bit\nset @dayprice=isnull((select L from @main_db.dbo.[GetCompanySettings]('useDayprice')),0)\n--exec sp_api_toast @dayprice\n\n--exec sp_api_toast @dstID\n--200630 was@parent_id\n\n--if isnull(@Prijs,0)=0\n--\tbegin\n\t\t--SELECT top 1 @prijs = ctr.ctrPRICE FROM xctrtotals ctr WHERE ctr.ctrprice > 0 AND ctr.Counterparty_ID=@Counterparty_ID AND ctr.ctrStock_ID =@ID ORDER BY ctr.id DESC -- laatste prijs!\n\n\n\n--\tend\nDECLARE @button nvarchar(128), @buttonvalue nvarchar(128) = 'Toevoegen'\nIF @ctr_id IS NOT NULL\n\tBEGIN\n\t\tSET @buttonvalue = 'Bijwerken'\n\t\tSET @aantal = @ctr_amount\n\t\tSET @prijs = @ctr_price\n\tEND\nELSE\n\tBEGIN\n\t\tset @prijs=(select @main_db.dbo.stockprice(\t@StockID--201030 @ID --48482 --stock_ID\n\t\t\t\t\t\t\t,@CTHID --3761\t--CTHID\n\t\t\t\t\t\t\t,@Counterparty_ID --161418\t--Counterparty_ID\n\t\t\t\t\t\t\t,@FlowModel --null\t--Flowmodel_ID\n\t\t\t\t\t\t\t,@THDT --2\t\t--DaTDT\n\t\t\t\t\t\t\t,@SrcID --NULL --SupplierLocation_ID\n\t\t\t\t\t\t\t,@DstID --NULL -- 7945\t--Receiverlocation_ID\n\t\t\t\t\t\t\t,IIF(@FRAFOT='FOT',1,0)\t\t--isFOT\n\t\t\t\t\t\t\t,@dayprice --0-- use dayprice\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\tEND\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nSET @text = N'Aantal'+IIF( @coretype in('FOOD'),' x Prijs','')\nEXEC sp_api_modal_text @text\nDECLARE @focus BIT = IIF(@ctr_id IS NULL,1,0)\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=@focus,@inline = 1\nIF @coretype in('FOOD')\n\tBEGIN\n\t\t--EXEC sp_api_modal_text 'Prijs'\n\t\tDECLARE @selected BIT = IIF(@ctr_id IS NULL,0,1)\n\t\tSET @focus = IIF(@ctr_id IS NULL,0,1)\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT,@focus=@focus,@inline = 1,@select=@selected\n\tEND\nEXEC sp_api_modal_button @name='button',@value = @buttonvalue,@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\t--SET @Prijs = dbo.str2dec(@Prijs)\n\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- 200924 zorg dat je ook komma mag gebruiken als decimaal scheidingsteken\n\t\t/* 201107 ook prijscontrole weer invoeren! bijvoorbeeld op 2 punten/kommas */\n\t\tIF \t((ISNULL(@Prijs,N'')=N'' OR\ttry_cast(@prijs as decimal(10,2)) > 0) AND (TRY_CAST(@aantal as int) >\t 0 OR @aantal = 'x') ) \n\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\n\t\t\tBEGIN\n\t\t\t\tIF @aantal = 'x' SET @aantal = 0\n\t\t\t\tIF @ctr_id IS NOT NULL\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tUPDATE xTransactionDetail SET amount = @aantal, price = @Prijs WHERE id = @ctr_id\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' bijgewerkt' from xstock x where x.id=@StockID\n\t\t\t\t\t\texec sp_api_toast @mes\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\t\t\tRETURN\n\t\t\t\t\tEND\n\t\t\t\tELSE\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tDECLARE @mapfustpartijregel int\n\t\t\t\t\t\tSET @mapfustpartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@StockID,@Amount=@Aantal,@Price=@Prijs,@priceType=@PriceType, @User=@User,@mapctr_id=@mapfustpartijregel\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@StockID\n\t\t\t\t\t\texec sp_api_toast @mes\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\t\t\tRETURN\n\t\t\t\t\tEND\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\n\tEND\n\n\n\n\nDECLARE @RecLocID INT = {[verkoop].Destination_ID} --=> 201201 zie SET @MainLocID een paar regels lager !!!\n\t,@MainLocID int\n\t,@MainLoc nvarchar(200)\n\t--,@StockID INT = @id\n\t,@TestPrijs float\n\t,@TestPallets int\n\n--201201 NEEM DE HOOFDLOKATIE!\nset @MainLocID=(select defaultLocation_ID from xcompany where xcompany.id=@Counterparty_ID)\nset @MainLoc=(select LocationCode from xlocation where xlocation.id=@MainLocID)\nSET @Description = CONCAT(N'Calculator met berekeningen vanaf hoofdlokatie', ' - ' ,@MainLoc)\nEXEC sp_api_modal_text @text = @Description,@class = 'h5 text-muted mt-2'\n\n\n\nEXEC sp_api_modal_input @name='testprice',@value = @TestPrijs OUT,@focus=0,@select=0,@inline=1\nEXEC sp_api_modal_button @name='buttontestprice',@value = 'Calculate',@valueout = @button OUT,@class = 'btn-primary'\n\nSET @TestPrijs = ISNULL(@TestPrijs,0)\nSET @TestPallets = ISNULL(@TestPallets,0)\nselect\n\t [Ignore] = case when ignore=1 then 'xxxxxx' else '   ' end\n,[Supplier~col-sm-2] = SupplierLoc\n, FP as [Full*] \n,inPrice as [inPrice:2]\n, Trans_SC as [Oprij:2]\n--, Fusthuur as [Fusthuur:2]\n, fot_price as [FOT_Price:2]\n--, fot_marge as [FOT_Marge:2]\n, fra_price as [FRA_Price:2]\n, fra_marge as [FRA_Marge:2]\n, min_fra as [Min_FRA:2]\n, min_fot as [Min_FOT:2]\n--, TR_Oprijden as [TR_Oprijden:2]\n,  TR_Klantvracht as [TR_Klantvracht:2]\n--,fustTranspFactor\n--, Trans_SR as [Transport direct:2]\n--, RfinPerc\n, [WF~col-sm-1-2] = WF\n,[Valid date~col-sm-2] = validDate\nINTO #t_price_tmp\n from @main_db.dbo.tP_Flex(@MainLocID,@StockID,@TestPrijs,@TestPallets  ) --201201 @MainLocID ipv RecLocID\n\torder by FP, Validdate desc, SupplierLoc\nDELETE FROM #t_price_tmp WHERE [Valid date~col-sm-2] < CAST(GETDATE() as DATE) --THIS IS STUPID!!! Anders tP_Flex aanpassen???\n\nEXEC sp_api_modal_table @tmptable=N'#t_price_tmp'\n\n--201201\n\nSET @Description = N'Momentprijs informatie'\nEXEC sp_api_modal_text @text = @Description,@class = 'h5 text-muted mt-2'\n\nSELECT [FP],\t[wFOT_Price],\t[wFRA_Price],\t[Moment]  INTO #Momentinfo FROM @main_db.dbo.xPriceMoment where  art_ID=@StockID  AND  Receiver_ID=@Counterparty_ID\nEXEC sp_api_modal_table @tmptable=N'#Momentinfo'\n\n\n-- einde 201201\nSET @Description = CONCAT(N'Andere verkopen', ' - ' + {[stock_ctr2].Description})\nEXEC sp_api_modal_text @text = @Description,@class = 'h5 text-muted mt-2'\n\nSELECT TOP 4 * INTO #salesByDateStock FROM @main_db.dbo.salesByDateStock(GETDATE(),@id,NULL) ORDER BY transactiondate DESC\nEXEC sp_api_modal_table @tmptable=N'#salesByDateStock'\n\nSET @Description = CONCAT(N'Eerdere verkopen aan ', {[verkoop].CounterParty_ID.CompanyName})\nEXEC sp_api_modal_text @text = @Description,@class = 'h5 text-muted mt-2'\n\nSELECT TOP 4 * INTO #salesByDateStockCounterParty FROM @main_db.dbo.salesByDateStock(NULL,@id,{[verkoop].CounterParty_ID}) ORDER BY transactiondate DESC\nEXEC sp_api_modal_table @tmptable=N'#salesByDateStockCounterParty'\n\n\n/*\nEXEC sp_api_modal_text 'Filter prijzen',N'mt-4 h5'\nDECLARE @search nvarchar(128) = isnull(\n\t\t\t\t\t\t\t\t\t\t{[verkoop].CounterParty_ID.Code} \n\t\t\t\t\t\t\t\t\t\t,{[klant].Code}\n\t\t\t\t\t\t\t\t\t\t)\nEXEC sp_api_modal_input @name='search',@value = @search OUT\nSELECT\n\t[Supplier*] = (SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Supplier_ID)\n\t,Receiver = (SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Receiver_ID)\n\t,[inPrice] = inPrice\n\t,Pallet = IIF(FullPalletPrice=1,'Full Pallet','')\n\t\tINTO #modaltable FROM t_Price this WHERE Art_ID = @StockID AND (\n\t\t\t(SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Supplier_ID) LIKE '%'+@search+'%'\n\t\t\t\tOR\n\t\t\t(SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Receiver_ID) LIKE '%'+@search+'%'\n\t)\nEXEC sp_api_modal_table\n*/\n\n\n",
            "action_id": 15,
            "action_name": "CTH2_GlobalSelectAmount",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--EXEC sp_api_toast @parent_parent_id\n--exec sp_api_toast @User\n\t\nDECLARE @CTHID INT = {[verkoop].id} --200818 curly\nDECLARE @StockID INT ={[stock_ctr2].id} -- 201030 beter dan '@ID'\nIF @StockID is NULL SET @StockID=@ID -- fall back\n\nIF @CTHID IS NULL begin\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\n\t\tRETURN;\n\t\tend\n--ELSE EXEC sp_api_toast @CTHID\n\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200)\n\n--201030 IF er bij\nSELECT @xDesc=x.[Description],@mes= concat('Selling ' , x.[Description]) ,@Coretype= x.coretype,@FustID=x.Fust_ID from xstock x where x.id=@StockID  --@main_db.dbo.\n--EXEC sp_api_modal_text @mes,'h2 text-primary'\n\nIF {[verkoop].status} not in ('openSale') AND @Coretype='FOOD' BEGIN --200924 fust mag wel worden bij of afgeboekt\n\tEXEC sp_api_modal_alert 'U kunt alleen leeg FUST toevoegen/terugnemen, want de order is definitief.'\n\tEXEC sp_api_modal_clear\t\t\n\tRETURN;\t\n\tend\n\n-- 200629 Uitbreiding inkoop vanuit diverse contexten: Zoek CTH ; bijv als we afkomstig zijn van een regel, dan is CTH te vinden in de regel\n--if @parent_card_name ='verkoop'\tset @CTHID=@parent_id\n--if @parent_card_name = 'ctr2' set @CTHID=(select TransactionHeader_ID from xtransactiondetail where xtransactiondetail.id=@parent_id)\n\n\n------\nIF @coretype in('CRATE','PALLET')\n\tBEGIN\n\t\tSELECT @Fustsaldo=Fustsaldo from @main_db.dbo.FustSaldo_FC(@FustID,{[verkoop].Counterparty_ID})\n\t\tEXEC sp_api_toast @Fustsaldo\n\t\t-- breid DECLARE message uit met het fust-saldo\n\t\tIF @FustSaldo is not NULL\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') actueel saldo bij deze klant: ',@fustsaldo)\n\t\tELSE\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') => let op: deze klant heeft dit fust nooit eerder gehad!')\n\tEND\n\n\n\n\n\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20) --='100'\nDECLARE @CounterpartyID int\nDECLARE @FlowModel int\nDECLARE @THDT INT\nDECLARE @FRAFOT Nvarchar(3) -- 'FRA' OF 'FOT'\nDECLARE @SrcID int -- let op: slechts 'advies'\nDECLARE @DstID INT\n\n\n--201022\ndeclare @dayprice bit\nset @dayprice=isnull((select L from @main_db.dbo.[GetCompanySettings]('useDayprice')),0)\nexec sp_api_toast @dayprice\n\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=cth.FlowModel_ID,@THDT=cth.TDT,@FRAFOT=cth.FRAFOT, @srcID=cth.source_ID,@DstID=cth.Destination_ID From q_xTransactionHeader CTH where CTH.ID=@CTHID\nexec sp_api_toast @dstID\n--200630 was@parent_id\n\nif isnull(@Prijs,0)=0\n\tbegin\n\t\t--SELECT top 1 @prijs = ctr.ctrPRICE FROM xctrtotals ctr WHERE ctr.ctrprice > 0 AND ctr.Counterparty_ID=@CounterpartyID AND ctr.ctrStock_ID =@ID ORDER BY ctr.id DESC -- laatste prijs!\n\n\t\tset @prijs=(select @main_db.dbo.stockprice(\t@StockID--201030 @ID --48482 --stock_ID\n\t\t\t\t\t\t\t,@CTHID --3761\t--CTH_ID\n\t\t\t\t\t\t\t,@CounterpartyID --161418\t--Counterparty_ID\n\t\t\t\t\t\t\t,@FlowModel --null\t--Flowmodel_ID\n\t\t\t\t\t\t\t,@THDT --2\t\t--DaTDT\n\t\t\t\t\t\t\t,@SrcID --NULL --SupplierLocation_ID\n\t\t\t\t\t\t\t,@DstID --NULL -- 7945\t--Receiverlocation_ID\n\t\t\t\t\t\t\t,IIF(@FRAFOT='FOT',1,0)\t\t--isFOT\n\t\t\t\t\t\t\t,@dayprice --0-- use dayprice\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\n\tend\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\nEXEC sp_api_modal_text 'Aantal'\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1\nIF @coretype in('FOOD')\n\tBEGIN\n\t\tEXEC sp_api_modal_text 'Prijs'\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT\n\tEND\nDECLARE @button nvarchar(128)\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- 200924 zorg dat je ook komma mag gebruiken als decimaal scheidingsteken\n\t\t/* 201107 ook prijscontrole weer invoeren! bijvoorbeeld op 2 punten/kommas */\n\t\tIF \t((@Prijs=N'' OR\ttry_cast(@prijs as decimal(10,2)) > 0) AND \tTRY_CAST(@aantal as int) >\t 0 ) \n\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\n\t\t\tBEGIN\n\t\t\t\tDECLARE @mapfustpartijregel int\n\t\t\t\tSET @mapfustpartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\n\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@StockID,@Amount=@Aantal,@Price=@Prijs,@priceType=N'FIXED', @User=@User,@mapctr_id=@mapfustpartijregel\n\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@StockID\n\t\t\t\texec sp_api_toast @mes\n\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\n\tEND\n\nEXEC sp_api_modal_text 'Filter prijzen',N'mt-4 h5'\nDECLARE @search nvarchar(128) = {[verkoop].CounterParty_ID.Code} \nEXEC sp_api_modal_input @name='search',@value = @search OUT\nSELECT\n\t[Supplier*] = (SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Supplier_ID)\n\t,Receiver = (SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Receiver_ID)\n\t,[inPrice] = inPrice\n\t,Pallet = IIF(FullPalletPrice=1,'Full Pallet','')\n\t\tINTO #modaltable FROM t_Price this WHERE Art_ID = @StockID AND (\n\t\t\t(SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Supplier_ID) LIKE '%'+@search+'%'\n\t\t\t\tOR\n\t\t\t(SELECT CONCAT(Code,' - ',CompanyName) FROM xCompany WHERE id = Receiver_ID) LIKE '%'+@search+'%'\n\t)\nEXEC sp_api_modal_table\n",
            "action_id": 16,
            "action_name": "CTH2_SelectAmount_",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='xcustomsoffice'",
            "action_id": 17,
            "action_name": "CustomsOffice",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 18,
            "action_name": "Del Comp",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 19,
            "action_name": "Deurbel",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'Ding dong'",
            "action_id": 20,
            "action_name": "Deurbel Ding Dong",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'Tring tring'",
            "action_id": 21,
            "action_name": "Deurbel Tring Tring",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 22,
            "action_name": "Excel CSV",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/fieldname'",
            "action_id": 23,
            "action_name": "Fieldname",
            "source_table": "api_actions"
        },
        {
            "sql_source": "stock<0",
            "action_id": 24,
            "action_name": "filter_negatief_stock",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_find_fields @card_id,@path,@id",
            "action_id": 25,
            "action_name": "Find Fields",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xlocation'\n",
            "action_id": 26,
            "action_name": "goederenlokaties",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(128) ,@button nvarchar(128)\nEXEC sp_api_modal_input @name='search',@value = @search OUT,@focus=1\n\nSET @button = 'Landen'\nEXEC sp_api_modal_button @name='button',@value = 'Landen',@valueout = @button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_button @name='button',@value = 'Steden',@valueout = @button OUT,@class = 'btn-primary',@key = 'F2'\nEXEC sp_api_modal_button @name='button',@value = 'Landen3',@valueout = @button OUT,@class = 'btn-primary',@key = 'F3'\nEXEC sp_api_modal_button @name='button',@value = 'VroegNegatief',@valueout = @button OUT,@class = 'btn-primary',@key = 'F4'\nEXEC sp_api_modal_button @name='button',@value = 'NegatiefNietVroeg',@valueout = @button OUT,@class = 'btn-primary',@key = 'F5'\nEXEC sp_api_modal_button @name='button',@value = 'Negatief',@valueout = @button OUT,@class = 'btn-primary',@key = 'F6'\n\n\n\nIF @button = 'Landen'\n\tBEGIN\n\t\tSELECT TOP 50 Countryid, name_0 INTO #landen FROM xCountry WHERE name_0 LIKE @search+'%'\n\t\tEXEC sp_api_modal_table @tmptable=N'#landen'\n\tEND\n/*\n-- er kan maar 1 tijdelijke tabel zijn met de naam #landen; wil je meer, dan moet je een andere naam kiezen (#landen2)\nIF @button = 'Landen2'\n\tBEGIN\n\t\tSELECT TOP 50 * INTO #landen2 FROM xCountry WHERE name_0 LIKE @search+'%'\n\t\tEXEC sp_api_modal_table @tmptable=N'#landen2'\n\tEND\n*/\n\n--Je kan OOK de layout gebruiken van een bestaande kaart: ( hierbij wel oppassen voor SQL-injection !!)\n\tIF @button = 'Landen3'\n\t\tBEGIN\n\t\t\t--via layout normale kaart xCountry = 394 (zie apicard)\n\t\t\tDECLARE @reducer nvarchar(max) = N'Name_0 like '+dbo.escape_string(@search+'%')\n\t\t\tEXEC sp_api_modal_table @card_id=394,@reducer = @reducer\n\t\tEND\n\t\n\nIF @button = 'Steden'\n\tBEGIN\n\t\t--SET @Description = CONCAT(N'Historie', ' - ' + {[stock_ctr2].Description})\n--\t\tEXEC sp_api_modal_text @text = @Description,@class = 'h3 text-muted'\n\t\tSELECT TOP 50 id,name,[Land*]=(SELECT Name_0 FROM xCountry WHERE CountryID = Country_ID) INTO #steden FROM xCity WHERE name LIKE @search+'%' ORDER BY [Land*]\n\t\tEXEC sp_api_modal_table @tmptable=N'#steden'\n\tEND\n\nIF @button =  'VroegNegatief'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Size, Origin_Code, 'Vroeg Negatief' AS [CAP*]\nINTO #VroegNegatief\nFROM          RV_IR_VoorraadNeg\nWHERE        (Voorraad@ < 0) AND ([EndTime*] = 'Vroeg')\nEXEC sp_api_modal_table @tmptable=N'#VroegNegatief',@orderby=N'ORDER BY [CAP*],Description ASC'\nEND \n\nIF @button =  'NegatiefNietVroeg'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Size, Origin_Code, 'Negatief niet vroeg' AS [CAP*]\nINTO #NegatiefNietVroeg\nFROM          RV_IR_VoorraadNeg\nWHERE        (Voorraad@ < 0) AND ([EndTime*] != 'Vroeg')\nEXEC sp_api_modal_table @tmptable=N'#NegatiefNietVroeg',@orderby=N'ORDER BY [CAP*],Description ASC'\nEND \n\nIF @button =  'Negatief'\nBEGIN\nSELECT DISTINCT Voorraad@, VoorraadVerwacht@, Description, Size, Origin_Code, 'Negatief' AS [CAP*]\nINTO #Negatief\nFROM          RV_IR_VoorraadNeg\nWHERE        (Voorraad@ < 0)\nEXEC sp_api_modal_table @tmptable=N'#Negatief',@orderby=N'ORDER BY [CAP*],Description ASC'\nEND ",
            "action_id": 27,
            "action_name": "instant_report_example",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 28,
            "action_name": "klanten",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 29,
            "action_name": "landen",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 30,
            "action_name": "leveranciers",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 31,
            "action_name": "main_action",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @text nvarchar(max)\n,@hclass nvarchar(128) = 'h5 text-muted mt-3'\n,@bclass nvarchar(128) = 'btn-primary'\n\nEXEC sp_api_modal_modal @class = 'pt-5'\nIF dbo.hasRole('admin') > 0 BEGIN\n\tSET @text = N'You''re at ' + @hostname + ' [@main_db]'\n\tEXEC sp_api_toast @text=@text,@seconds=3\nEND\n\nDECLARE @colorblind BIT = 0\nIF dbo.hasClaims('sub=email@anacogreeve.nl') > 0\nBEGIN\nSET @colorblind = 1\nEND\n\nDECLARE @extendedMenu BIT = 0\nIF dbo.hasClaims('sub=email@anacogreeve.nl') > 0\nBEGIN\nSET @extendedMenu = 1\nEND\n\nDECLARE @loods BIT = 0\nIF dbo.hasRole('loodsbaas,loodsmedewerker,ompakker,keurmeester') > 0\nBEGIN\nSET @loods = 1\nEND\n\n--ALS EERSTE!\n--EXEC sp_api_modal_action N'Scanner Test',@class='btn-danger'\nEXEC sp_api_modal_action N'Scanner',@class='btn-danger'\nEXEC sp_api_modal_action N'Mobilephone',@class='btn-danger'\nEXEC sp_api_modal_action N'detepo',@class='btn-danger'\nEXEC sp_api_modal_action N'micro_check_scan',@class='btn-danger' --rh 230825\nEXEC sp_api_modal_action N'test_rick_2',@class='btn-danger' --rh 230825\nEXEC sp_api_modal_action N'NEOVO_PALLET_SCAN',@class='btn-danger'\nEXEC sp_api_modal_action N'Barcode Scanner',@class='btn-tracy'\nEXEC sp_api_modal_action N'check_serial_number' --rh231218\nEXEC sp_api_modal_action N'check_pallets' --241129\nEXEC sp_api_modal_action N'check_pallets_in_stock' --241129\nEXEC sp_api_modal_action N'check_data' --rh240719\nEXEC sp_api_modal_action @name='RWS-podcast'\nEXEC sp_api_modal_action @name='rick_delete'\n\n\n--START\n\nIF @button = 'Quick menu'\n\tBEGIN\n\t\tEXEC #sys_quick_menu @path\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_text 'Hoofdmenu','h1'\n\nif  dbo.hasClaims(N'tenant=AGNEOVO') >0 or dbo.hasRole('admin,directie') > 0\n\tbegin \n\t\t--EXEC sp_api_modal_action @name='pallet_status_agneovo',@class = 'btn-white border-dark text-dark' --test 230808\n\t\tEXEC sp_api_modal_route @cardname='pallet_status_agneovo'\t\n\tend\n\nEXEC sp_api_modal_route @cardname='wms_micro_outbound'\n\nIF dbo.hasClaims('sub=mterlouw@rwsbv.com') > 0 or dbo.hasClaims('sub=kterlouw@rwsbv.com') > 0 --250415\n\tor dbo.hasClaims('sub=rick@tracy.nu') > 0 OR dbo.hasRole('admin,directie,barsan,barsan_bo') > 0\nBEGIN\n\tEXEC sp_api_modal_route @cardname='douanevoorraadmutatie'\nEND\t\n\nIF dbo.hasRole('admin,directie,loodsmedewerker') > 0\nBEGIN\n\tEXEC sp_api_modal_route @cardname='vehicle_export_staging',@search= '?red=open'\nEND\t\n\n BEGIN\n\t-----------------\n\t-- ADMIN QUICK LIJST\n\t-----------------\n\n\t\tIF dbo.hasRole('admin') > 0\n\t\tBEGIN\n--\t\tEXEC sp_api_modal_text 'Admin Knopjes',@hclass\n--\t\tSET @bclass = 'btn btn-linkt border-danger text-dark'\n\t\t/*\n\t\tEXEC sp_api_modal_route @name='Product (Hoofdgroup)',@pathname='/xproduct',@search= '?red=',@class=@bclass,@key='P',@group = 'Voorraadbeheer'\n\t\tEXEC sp_api_modal_route @name='Intrastat Fout of Geen',@pathname='/xproduct',@search= '?red=Intrastat_ID+Empty+OR+Wrong',@class=@bclass,@key='I',@group = 'Voorraadbeheer'\n\t\tEXEC sp_api_modal_route @name='Geen Customs Group',@pathname='/xproduct',@search= '?red=Geen+Douane+Groep',@class=@bclass,@key='D',@group = 'Voorraadbeheer'\n\t\tEXEC sp_api_modal_route @name='Onvolledig Customs Art',@pathname='/xproduct',@search= '?red=Niet+(Volledig)+in+Customs+Art',@class=@bclass,@key='L',@group = 'Voorraadbeheer'\n\t\t*/\n\t\t\n\t\tEXEC sp_api_modal_route @name='To Do',@pathname='/api_todo',@search= '?red=Niet+klaar',@class='btn btn-linkt border-danger text-dark',@key='T'\n\t\tEXEC sp_api_modal_route @name='API DATASET',@pathname='/api_data_set'\n\t\tEND\n\t\n\t--------------\n\t-- Warehouse\n\t--------------\n--\tEXEC sp_api_modal_text 'Warehouse',@hclass\n\n\tIF @colorblind = 1\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-primary'\n\t\tEND\n\tELSE\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-secondary'\n\t\tEND\nIF dbo.hasRole('user,admin,directie') > 0\n\tbegin\n\n\t\n\t\tEXEC sp_api_modal_route @name='Vessel',@pathname='/w_vessel',@class=@bclass,@key='V'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n\t\tEXEC sp_api_modal_route @name='Bill of Lading',@pathname='/w_bl',@class=@bclass,@key='Alt+B'--, @Search='?red=recent'--,@group = 'main'\n\t\tEXEC sp_api_modal_route @name='Forecast',@pathname='/forecast',@class=@bclass,@key='F'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n\t\t\n\n\t--\tEXEC sp_api_modal_route @name='Inbound',@pathname='/inbound',@class=@bclass,@key='I'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n\t--\tEXEC sp_api_modal_route @name='Outbound Transport',@pathname='/wms_out_transport',@class=@bclass,@key='O'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n--\t\tEXEC sp_api_modal_action @name='report_menu',@class = 'btn-white border-dark text-dark'\n\t\t\n\n\t\t\n\tend\n--@name='Inbound Transport.',\n--\t\tEXEC sp_api_modal_route @name='Inbound Transport',@pathname='/wms_in_transport',@class=@bclass,@key='T'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n\t\tEXEC sp_api_modal_route @name='Inbound Transport',@cardname='wms_in_transport',@class=@bclass,@key='T'--, @Search='?red=Open+en+Nieuw',@group = 'main'\n\n--IF dbo.hasRole('viewer') > 0\n\t--begin\n\n  \n\n\t--220319 NIEUW: DE CARD BEPAALT ZELF AAN DE HAND VAN DE ROLLEN OF HIJ GERENDERD WORDT..\nIF dbo.hasRole('loodsmedewerker') = 0 --specifiek ** UITSLUITEN ** bij menu voor loodsmedewerker\n\tbegin\n\t\tEXEC sp_api_modal_route @name='Inbound',@cardname='inbound',@class=@bclass,@key='I'\n\t\tEXEC sp_api_modal_route @name='Outbound Transport',@cardname='wms_out_transport',@class=@bclass,@key='O',@group = 'outbound'\n\t\tEXEC sp_api_modal_route @name='Micro outbound form',@cardname='wms_micro_outbound',@class=@bclass,@key='O'\t,@group=N'micro_outbound'\t\n\t\t\n\tend\n--230306 specifiek uitsluiten voor ensign\nif  dbo.hasClaims(N'tenant=VIAROT') =0 \t--iedereen behalve viaensign\t\n\tEXEC sp_api_modal_route @name='Outbound orders',@cardname='outbound_form',@class=@bclass,@key='O',@group = 'outbound'\n\n\t\tIF dbo.hasRole('admin,directie') > 0 -- micro werk!\n\t\t\tbegin\n\t\t\t\tEXEC sp_api_modal_route @name='Micro outbound form',@cardname='wms_micro_outbound',@class=@bclass,@key='O'\t,@group=N'micro_outbound'\t\n\t\t\t\tEXEC sp_api_modal_route @name='Replenishment',@cardname='w_pallet_replenishment',@class=@bclass,@key='R'\t,@group=N'micro_outbound'\t\t\n--\t\t\t\tEXEC sp_api_modal_route @name='Micro item stock info',@cardname='wms_micro_item_stock_info',@class=@bclass,@key='R'\t,@group=N'micro_outbound',@search= '?red=selecteerbare_pallets'\n\t\t\t\tEXEC sp_api_modal_route @name='micro_totals',@cardname='micro_totals',@class=@bclass,@key='T'\t,@group=N'micro_outbound'\n\n\t\t\t\t--231024\n\t\t\t\tEXEC sp_api_modal_route @cardname='micro_items_stock_per_position_agneovo'\n\t\t\tend\t\n\t\tEXEC sp_api_modal_route @name='Stock by Client',@cardname='wms_rv_pal_stock',@class=@bclass,@key='C'\n\n--230306 specifiek uitsluiten voor ensign\nif  dbo.hasClaims(N'tenant=VIAROT') =0 \n\t--alleen viarot uitsluiten, dus als je de claim niet hebt mag je dit item zien\n\tEXEC sp_api_modal_route @name='Stock by BL',@cardname='wms_rv_pal_stock_bl',@class=@bclass,@key='B'\n\n\t\tEXEC sp_api_modal_route @name='Stock by Container',@cardname='wms_rv_pal_stock_cnt',@class=@bclass,@key='N'\n\t\t--micro stock info\n--\t\tEXEC sp_api_modal_route @name='Stock per micro item',@cardname='micro_totals',@class=@bclass,@key='T'\t\n--per lotnumber\nIF dbo.hasRole('loodsmedewerker') = 0\n\tbegin --specifiek uitsluiten bij menu voor loodsmedewerker\n\t\tEXEC sp_api_modal_route @name='Stock per micro item',@cardname='micro_totals_lotnr_w_lot',@class=@bclass,@key='T'\t\n\tend\t\n\n\t\t--230114\n\t\tEXEC sp_api_modal_route @cardname='wms_io'\t\n\t\t--230710 uitgezet, driver-screen wordt via link direct gestart EXEC sp_api_modal_route @cardname='driver_screen'\t\n\t\tEXEC sp_api_modal_route @cardname='inbound_form_barsan'\t\n\t\t\n--\tend\n\t\t\n\t--------------\n\t-- Rapportage\n\t--------------\n\tEXEC sp_api_modal_action @name='report_menu',@class = 'btn-success'--'btn-white border-dark text-dark'\n\n\tIF dbo.hasRole('user,admin,directie') > 0\n\t\tBEGIN\n\t\t\t--EXEC sp_api_modal_text 'Rapportage (Maand Afsluiten)',@hclass\n\t\t\t--EXEC sp_api_modal_route @name='Aangifte',@pathname='/aangifte',@search= '',@class = 'btn-white border-dark text-dark',@key='A'\n\t\t\tEXEC sp_api_modal_route @name='Crossdock',@pathname='/w_crossdock',@class=@bclass,@key='C'\n\t\t\t\n\t\tEND\n\n\n/*\n\t-----------------\n\t-- VOORRAAD LIJST\n\t-----------------\n--\tEXEC sp_api_modal_text 'Artikelbestand (Voorraad)',@hclass\n--\tSET @bclass = 'btn-secondary'\n\t--EXEC sp_api_modal_route @name='xstock',@pathname='/xstock',@search= '',@class=@bclass,@key='X'\n\n\tIF @colorblind = 1\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_route @name='Totaal Voorraad per lokatie',@pathname='/stocklocation',@search= '',@class='btn-primary',@key='T',@group = 'Voorraad'\n\t\t\tEXEC sp_api_modal_route @name='Voorraad per lokatie',@pathname='/voorraadlokatie',@search= '',@class='btn-primary',@key='X',@group = 'Voorraad'\n\t\t\tEXEC sp_api_modal_route @name='Voorraad [Artikelen]',@pathname='/xstock',@search= '?red=',@class='btn-primary',@key='S',@group = 'Voorraad'\n\t\t\t\n\t\tEND\n\tELSE\n\t\tBEGIN\n\t\tEXEC sp_api_modal_route @name='Totaal Voorraad per lokatie',@pathname='/stocklocation',@search= '',@class=@bclass,@key='T',@group = 'Voorraad'\n\t\t\tEXEC sp_api_modal_route @name='Voorraad per lokatie',@pathname='/voorraadlokatie',@search= '',@class=@bclass,@key='X',@group = 'Voorraad'\n\t\t\tEXEC sp_api_modal_route @name='Voorraad [Artikelen]',@pathname='/xstock',@search= '?red=',@class=@bclass,@key='S',@group = 'Voorraad'\n\t\t\t\n\t\tEND\n*/\n\n\t------------\n\t-- Transactions\n\t------------\n--\tEXEC sp_api_modal_text 'Transacties',@hclass\n/*\n\tBEGIN\n\n\tEXEC sp_api_modal_route @name='Verkoop [Pakbon Niet Geprint]',@pathname='/verkoop',@search= '?red=Pickbon+NOG+NIET+GEPRINT' ,@class='btn-primary',@key='V',@group = 'verkoop'\n\n\tEXEC sp_api_modal_route @name='Filter [Pickbon Geprint]',@pathname='/verkoop',@search= '?red=Pickbon+Geprint' ,@class='btn-primary',@key='P',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Verkoop [Alles]',@pathname='/verkoop',@search= '?red=' ,@class='btn-primary',@key='A',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Filter [Commission]',@pathname='/verkoop',@search= '?red=Commission+%5BopenPrice%5D' ,@class='btn-primary',@key='C',@group = 'verkoop'\n\n\t--EXEC sp_api_modal_route @name='Verkoop [Vandaag]',@pathname='/verkoop',@search= '?red=Werkdatum+openSale' ,@class='btn-primary',@key='Ctrl+V',@group = 'verkoop'\n\n\tEXEC sp_api_modal_route @name='Filter [Pickbon Veranderd]',@pathname='/verkoop',@search= '?red=Pickbon+VERANDERD' ,@class='btn-primary',@key='W',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Filter [Klaar voor Factuur]',@pathname='/verkoop',@search= '?red=Fase+Klaar+voor+Factuur' ,@class='btn-primary',@key='K',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Filter [Gefactureerd]',@pathname='/verkoop',@search= '?red=Orders%3A+gefactureerd' ,@class='btn-primary',@key='F',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Filter [Nog Toewijzen]',@pathname='/verkoop',@search= '?red=Toewijzen' ,@class='btn-primary',@key='T',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='Inkoop',@pathname='/inkoop',@search= '?red=',@class='btn-warning',@key='I',@group = 'inkoop'\n\tEXEC sp_api_modal_route @name='Open inkopen',@pathname='/inkoop',@search= '?red=Open+inkopen',@class='btn-primary',@key='O',@group = 'inkoop'\n\tEXEC sp_api_modal_route @name='Gesloten inkopen',@pathname='/inkoop',@search= '?red=Gesloten+inkopen',@class='btn-primary',@key='G',@group = 'inkoop'\n\tEXEC sp_api_modal_route @name='Inkoop [Vandaag]',@pathname='/inkoop',@search= '?red=Werkdatum',@class='btn-warning',@key='Ctrl+I',@group = 'inkoop'\n\tEXEC sp_api_modal_route @name='Douane Actie Nodig',@pathname='/inkoop',@search= '?red=Actie+nodig+(douane+tafel)',@class='btn-warning',@key='D',@group = 'inkoop'\n\tEXEC sp_api_modal_route @name='Verkoop Claims [New]',@pathname='/xclaim',@search= '?red=Status+%3D+New',@class='btn-danger',@key='Alt+C',@group = 'verkoop'\n\tEXEC sp_api_modal_route @name='AccountSale [Open]',@pathname='/xcth_accountsale',@search= '?red=Open',@class='btn-warning',@key='A',@group = 'accountsale'\n\tEXEC sp_api_modal_route @name='AccountSale [Invoiced]',@pathname='/xcth_accountsale',@search= '?red=Factuur+gemaakt',@class='btn-warning',@key='F',@group = 'accountsale'\n\t--EXEC sp_api_modal_route @name='Fust Inname',@pathname='/xfustreturned',@search= '?red=',@class='btn-white border-dark text-dark',@key='F'\n\t\tIF @extendedMenu = 1\n\t\tBEGIN\n\t\tEXEC sp_api_modal_route @name='Verkoop [Gereserveerd]',@pathname='/verkoop',@search= '?red=Orders+Reserved' ,@class='btn-primary',@key='Ctrl+V',@group = 'verkoop'\n\t\tEXEC sp_api_modal_route @name='Inkoop [Gereserveerd]',@pathname='/inkoop',@search= '?red=Orders+Reserved',@class='btn-warning',@key='Ctrl+I',@group = 'inkoop'\n\t\tEND\n\t\t\n\tEND\n*/\t\n\t\n/*\t\n\tEXEC sp_api_modal_text '',@class='row'\n\tEXEC sp_api_modal_action @name='Nieuwe Verkoop',@class='btn-primary',@keycode='ArrowUp'\n\tEXEC sp_api_modal_action @name='Nieuwe Inkoop',@class='btn-warning',@keycode='ArrowDown'\n*/\n\n/*\n\tIF dbo.hasRole('douane,admin') > 0\n\t\tBEGIN\n\t\t\n\t\t--------------\n\t\t-- Douane\n\t\t--------------\n\t\tEXEC sp_api_modal_text 'Douane',@hclass\n\t\t\n\t\tSET @bclass = 'btn-dark'\n\t\t\n\t\t\tIF EXISTS (SELECT * FROM check_lfctr_at_entrepot)\n\t\t\t\tBEGIN\n\t\t\t\t\tEXEC sp_api_modal_route @name='Verkoop Correctie',@pathname='/check_lfctr_at_entrepot',@search= '',@class='btn-danger',@key='E'\n\t\t\t\tEND\n\t\t\n\t\t\tEXEC sp_api_modal_route @name='Douane Saldo',@pathname='/douanesaldo',@search= '',@class=@bclass,@key='S',@group = 'Douaneoverzicht'--,@group = 'Container'\n\t\t\tEXEC sp_api_modal_route @name='Contingent',@pathname='/sf_femimp',@search= '',@class=@bclass,@key='C',@group = 'Douaneoverzicht'\n\t\t\t\n\t\t\tEXEC sp_api_modal_route @name='Import',@pathname='/xvessel',@search= '?red=Nog+Niet+Uitgelost&ord=22636,26417,22107',@class=@bclass,@key='B',@group = 'Container'\n\t\t\tEXEC sp_api_modal_route @name='Inslag document',@pathname='/xbol',@class=@bclass,@key='D',@group = 'Container'\n\t\t\tEXEC sp_api_modal_route @name='Containers',@pathname='/xcontainer',@class=@bclass,@key='C',@group = 'Container'\n\t\t\tEXEC sp_api_modal_route @name='Partij Douane Artikelen',@pathname='/xcthcustomsrows',@class=@bclass,@key='P',@group = 'Container'\n\t\t\t\n\t\t\t\n\t\t\tEXEC sp_api_modal_route @name='Douane Artikelen',@pathname='/xproductcustomsgroup',@search= '',@class=@bclass,@key='D',@group = 'DouaneArtikelGroup'\n\t\t\tEXEC sp_api_modal_route @name='Douane Artikelen Per Land',@pathname='/xcthcustomsart',@search= '',@class=@bclass,@key='A',@group = 'DouaneArtikelGroup'\n\t\t\tEXEC sp_api_modal_route @name='E-cert Groep',@pathname='/xclientbotanic',@search= '',@class=@bclass,@key='G',@group = 'DouaneArtikelGroup'\n\t\t\tEXEC sp_api_modal_route @name='E-cert Vari\u00ebteit',@pathname='/xclientexport',@search= '',@class=@bclass,@key='V',@group = 'DouaneArtikelGroup'\n\t\t\tEXEC sp_api_modal_route @name='Product (Hoofdgroup)',@pathname='/xproduct',@search= '?red=',@class=@bclass,@key='P',@group = 'DouaneArtikelGroup'\n\t\t\t\n\t\t\t--EXEC sp_api_modal_route @name='Binnenkomend (LF)',@pathname='/lf_aanvoer_inkomend',@search= '',@class=@bclass,@key='I',@group = 'Container'\n\t\t\t--EXEC sp_api_modal_route @name='Uitgaand (LF)',@pathname='/lf_aanvoer_uitgaand',@search= '',@class=@bclass,@key='U',@group = 'Container'\n\t\t\t\n\t\t\t\n\t\tEND\n*/\n\n\t--------------\n\t-- Facturatie\n\t--------------\n--\tEXEC sp_api_modal_text 'Facturatie',@hclass\n\n\tIF @colorblind = 1\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-primary'\n\t\tEND\n\tELSE\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-secondary'\n\t\tEND\nIF dbo.hasRole('user,admin,directie') > 0\n\tbegin\n\t--\tEXEC sp_api_modal_route @name='Uitgaande facturen',@pathname='/invoice',@class=@bclass,@key='Alt+U', @Search='?red=Open+en+Nieuw',@group = 'Factuuruit'\n\t\tEXEC sp_api_modal_route @name='Uitgaande facturen',@pathname='/invoice_wms',@class=@bclass,@key='Alt+U', @Search='?red=Open+en+Nieuw',@group = 'Factuuruit'\n\t\tEXEC sp_api_modal_route @name='Filter [Klaar voor Export]',@pathname='/invoice_wms',@class=@bclass,@key='', @Search='?red=Klaar+voor+Export',@group = 'Factuuruit'\n\t\tEXEC sp_api_modal_route @name='Voorbereiding weekfacturen',@pathname='/wms_week_data_for_invoice',@class=@bclass,@key='' ,@group = 'Factuuruit'--, @Search='?red=Klaar+voor+Export'\n\t\tEXEC sp_api_modal_route @name='Inslagen',@pathname='/w_applied_actions',@class=@bclass,@key='' ,@group = 'Factuuruit'--, @Search='?red=Klaar+voor+Export'\t\t\n\t\t\n\t\tEXEC sp_api_modal_route @name='Inkoopfacturen',@pathname='/incoming_invoice',@class=@bclass,@key='Alt+I',@group = 'Factuurin'\n\t\tEXEC sp_api_modal_route @name='Status Exact',@pathname='/incoming_invoice',@class=@bclass,@key='Alt+I',@Search='?red=Status+Exact',@group = 'Factuurin'\n\t\tEXEC sp_api_modal_route @name='Status Draft / Empty',@pathname='/incoming_invoice',@class=@bclass,@key='Alt+I',@Search='?red=Draft+%2F+Empty',@group = 'Factuurin'\n\tend\n\t------------\n\t-- ADRESSEN\n\t------------\n--\tEXEC sp_api_modal_text 'Adressen',@hclass\n\n\tIF @colorblind = 1\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-primary'\n\t\tEND\n\tELSE\n\t\tBEGIN\n\t\t\tSET @bclass = 'btn-success'\n\t\tEND\n\n\nIF dbo.hasRole('user,admin,directie') > 0\n\tbegin\n\t\t\t\n\t\tEXEC sp_api_modal_route @name='Alle bedrijven',@pathname='/adres',@search= '',@class=@bclass,@key='F1',@group = 'stamgegevens'\n\t\tEXEC sp_api_modal_route @name='Leveranciers',@pathname='/leverancier',@search= '',@class=@bclass,@key='F2',@group = 'stamgegevens'\n\t\tEXEC sp_api_modal_route @name='Klanten',@pathname='/klant',@search= '?ord=23124,27062',@class=@bclass,@key='F3',@group = 'stamgegevens'\n\t\tEXEC sp_api_modal_route @name='Transporteurs',@pathname='/transporteur',@search= '',@class=@bclass,@key='F4',@group = 'stamgegevens'\n\t\t\n\t\tEXEC sp_api_modal_route @name='Lokaties',@pathname='/xlocation',@search= '',@class=@bclass,@key='L',@group = 'Locaties'\n\t\tEXEC sp_api_modal_route @name='Pickup lokaties',@pathname='/wms_pickup_location',@search= '',@class=@bclass,@key='P',@group = 'Locaties'\n\n\tend\t\n\nIF dbo.hasRole('barsan_bo') > 0\n\tbegin\n\t\t--BARSAN_BO OOK DEZE LOKATIE OPTIE\n\t\tEXEC sp_api_modal_route @name='Lokaties',@pathname='/xlocation',@search= '',@class=@bclass,@key='L'\t\n\t\t\n\tend\t\n\nIF dbo.hasRole('barsan,barsan_bo,loodsmedewerker,directie') > 0 OR @user='alex_dong_nl@ensignfreight.com' --231110 alex specifiek OOK\n\tbegin\n\t\tEXEC sp_api_modal_route @cardname='barsan_micro_out'\n\tend\t\n\nIF dbo.hasRole('admin,directie') > 0\n\tbegin\n\t\t\t\n\t\tEXEC sp_api_modal_route @name='wms_artikelen',@pathname='/wms_item',@search= '',@class=@bclass,@key='Alt+A',@group = 'base'\n\t\tEXEC sp_api_modal_route @name='wms_groepen',@pathname='/xproduct',@search= '',@class=@bclass,@key='ALT+G',@group = 'base'\n\t\tEXEC sp_api_modal_route @name='wms_loodshuur_artikel',@pathname='/wms_price_per_week',@search= '',@class=@bclass,@key='ALT+W',@group = 'base'\t\n\t\tEXEC sp_api_modal_route @name='wms_tarief_inslag',@pathname='/w_action_tariff',@search= '',@class=@bclass,@key='ALT+i',@group = 'base'\t\n\t\tEXEC sp_api_modal_route @name='wms_notification_settings',@pathname='/wms_notification_settings',@search= '',@class=@bclass,@key='ALT+N',@group = 'base'\t\n\t\tEXEC sp_api_modal_route @name='wms_invoice_method',@pathname='/wms_invoice_method',@search= '',@class=@bclass,@key='ALT+M',@group = 'base'\t\n\t\tEXEC sp_api_modal_route @name='wms_verpakking_micro_items',@pathname='/fust',@search= '',@class=@bclass,@key='ALT+V',@group = 'base'\t\n\t\tEXEC sp_api_modal_route @name='pallets toevoegen',@pathname='/wms_purchase',@search= '',@class=@bclass,@key='ALT+P',@group = 'base'\t\n\t\t--https://rws.tsql.app/wms_notification_settings\t\n\tend\t\n\n\nEND\n------------\n-- GEBRUIKER\n------------\n--EXEC sp_api_modal_menu_user\t@user_id,@path\nDECLARE @key nvarchar(128) = IIF(@path='/','Escape','Home')\nSET @bclass = 'btn-tracy'\n\nEXEC sp_api_modal_route @name='Home',@pathname='/',@search= '',@class=@bclass,@key=@key\n\nEXEC sp_api_modal_button @name='logout',@value='Log Out',@valueout = @b_logout OUT,@class=@bclass,@key='End'\n\tIF @b_logout = 'Log Out'\n\t\tBEGIN\n\t\t\tEXEC sp_api_modal_dispatch N'{\"type\":\"logOut\"}'\n\t\t\tRETURN\n\t\tEND\n\n\n\n\n-----------\n-- ADMIN --\n-----------\n--if @user_name<>'rick@tracy.nu' \nEXEC sp_sys_admin_main_menu @hclass\n--https://rws.tsql.app/api_actions/32\n\ndeclare @T nvarchar(512)=N'&nbsp;'\nexec sp_api_modal_html @T\nexec sp_api_modal_html @T\nexec sp_api_modal_html @T\nset @T =concat(N'<a href=\"https://tracy.nu\" target=_blank>Solution &copy;',year(getdate()),' TDS B.V.</a><br/><a href=\"https://www.ux1.nl\" target=_blank>Technology &copy;',year(getdate()),' UX1 B.V.</a>'   \t)\nexec sp_api_modal_html @T, @class='m-1 w-24 btn btn-link2 btn-sm float-right' ",
            "action_id": 32,
            "action_name": "main_menu",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 33,
            "action_name": "Maten",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 34,
            "action_name": "modify",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 35,
            "action_name": "No Insert Allowed",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 36,
            "action_name": "parent_id_in_toast",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast @previous_path ",
            "action_id": 37,
            "action_name": "path_info",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 38,
            "action_name": "PER Bronlijst",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_pick_from_list @id, @ids ,@picklist_type, @parent_card_name, @picklist_fieldname, @previous_path, @card_id, @parent_id, @parent_card_id, @user_id",
            "action_id": 39,
            "action_name": "Pick from list",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @toCompany nvarchar(200),@fromCompany nvarchar(200)\nIF @toCompany IS NULL SET @toCompany = {[verkoop].counterparty_id.seek_column}\nIF @fromCompany IS NULL SET @fromCompany = {[inkoop].counterparty_id.seek_column}\nDECLARE @search nvarchar(2000)\nIF @toCompany IS NOT NULL SET @search = N'?filter=tocompany_id.swhas('+@toCompany+')'\nIF @fromCompany IS NOT NULL SET @search = N'?filter=fromcompany_id.swhas('+@fromCompany+')'\n\nEXEC sp_api_goto @path='/repaction',@search = @search",
            "action_id": 40,
            "action_name": "repaction",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/repdef'\n",
            "action_id": 41,
            "action_name": "repdef",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/repprinters'\n",
            "action_id": 42,
            "action_name": "repprinters",
            "source_table": "api_actions"
        },
        {
            "sql_source": "declare @T nvarchar(200)\nset @T=(select L from @main_db.dbo.[GetCompanySettings]('useDayprice'))\nexec sp_api_toast @T",
            "action_id": 43,
            "action_name": "sample_GetCompanySettings",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(128),@button nvarchar(200)\nEXEC sp_api_modal_input @name='Search', @value= @search OUT,@focus=1\nEXEC sp_api_modal_button @name='Go',@value = 'Zoek', @valueout = @button OUT ,@class='btn-primary',@key='Enter'\nIF @button is not null\n\tBEGIN\n\t\tDECLARE @cursor CURSOR,@sql nvarchar(max),@title nvarchar(max)\n\t\tSET @cursor = CURSOR FOR\n\t\t\tSELECT sql,title=isnull((SELECT name FROM api_card WHERE id = (SELECT card_id FROM api_card_fields WHERE id = field_id)),'NULL')\n\t\t\t\t\t\t+'.'+isnull((SELECT name FROM api_card_fields WHERE id = field_id),'NULL')\n\t\t\t\t\t\t+'.'+(SELECT name FROM api_attributes WHERE id = attr_id)\n\t\t\t\t\tFROM api_card_field_attributes\n\t\t\t\t\tWHERE sql <> '' AND attr_id IN (SELECT id FROM api_attributes WHERE name LIKE '%'+@search+'%')\n\t\t\t\tUNION\n\t\t\tSELECT list_class,title=(SELECT name FROM api_card WHERE id = card_id)+'.'+name+'.list_class' FROM api_card_fields\n\t\t\t\t\tWHERE list_class <> '' AND list_class LIKE '%'+@search+'%'\n\t\t\t\tUNION\n\t\t\tSELECT picklist_sql,title=(SELECT name FROM api_card WHERE id = card_id)+'.'+name+'.picklist_sql' FROM api_card_fields\n\t\t\t\t\tWHERE picklist_sql <> '' AND picklist_sql LIKE '%'+@search+'%'\n\t\t\t\tUNION\n\t\t\tSELECT sql,title=(SELECT name FROM api_card WHERE id = card_id)+'.'+name+'.sql' FROM api_card_fields\n\t\t\t\t\tWHERE sql <> '' AND sql LIKE '%'+@search+'%'\n\t\t\t\tUNION\n\t\t\tSELECT on_update_sql,title=(SELECT name FROM api_card WHERE id = card_id)+'.'+name+'.on_update_sql' FROM api_card_fields WHERE on_update_sql <> '' AND on_update_sql LIKE '%'+@search+'%'\n\n\n\t\tOPEN @cursor;\n\t\tFETCH NEXT FROM @cursor INTO @sql ,@title\n\t\tWHILE @@FETCH_STATUS = 0\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text @title,'small opacity-50'\n\t\t\t\tEXEC sp_api_modal_text @sql,'big code mb-1'\n\t\t\t\tFETCH NEXT FROM @cursor INTO @sql ,@title\n\t\t\tEND\n\t\tCLOSE @cursor;\n\t\tDEALLOCATE @cursor;\n\tEND",
            "action_id": 44,
            "action_name": "Search Edit history",
            "source_table": "api_actions"
        },
        {
            "sql_source": "IF @id = @ids\n\tEXEC sp_api_modal_select_all\nELSE\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'There is already a selection present.','py-1'\n\t\tDECLARE @valueout nvarchar(255)\n\t\tEXEC sp_api_modal_button @name='Option',@value = 'Add', @valueout = @valueout OUT,@class='btn-danger',@key='A'\n\t\tEXEC sp_api_modal_button @name='Option',@value = 'New', @valueout = @valueout OUT,@class='btn-danger',@key='N'\n\t\tEXEC sp_api_modal_button @name='Option',@value = 'Clear', @valueout = @valueout OUT,@class='btn-danger',@key='C'\n\t\tIF @valueout IS NOT NULL\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_clear\n\t\t\t\tIF @valueout = 'Clear' EXEC sp_api_modal_select_all_clear\n\t\t\t\tIF @valueout = 'Add' EXEC sp_api_modal_select_all\n\t\t\t\tIF @valueout = 'New'\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tEXEC sp_api_modal_select_all_clear\n\t\t\t\t\t\tEXEC sp_api_modal_select_all\n\t\t\t\t\tEND\n\t\t\tEND\n\tEND",
            "action_id": 45,
            "action_name": "Select All",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @Status nvarchar(100)\n--basis = via p_api_modal_get:\n--EXEC sp_api_modal_get N'workdate',@status OUT \n\n--alternatief = via helper function dbo.Workdate(@user_id):\nSELECT @Status=dbo.Workdate()\n\n-- in direct SQL: SET @Status=(SELECT top 1 TV_CompanyName FROM q_xtransactionheader WHERE transactiondate=dbo.Workdate(@User_ID))\n\nSET @Status =CONCAT(N'Werkdatum is: ',@STATUS)\nEXEC sp_api_modal_text @status",
            "action_id": 46,
            "action_name": "ShowWorkdate",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 47,
            "action_name": "States",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_card_help @card_id,@card_name,@card_field_id",
            "action_id": 48,
            "action_name": "sys_card_help",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 49,
            "action_name": "sys_clear_filters",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 50,
            "action_name": "sys_clear_filters_all",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @json nvarchar(max),@sql nvarchar(max),@columnname nvarchar(128)\n\t,@button nvarchar(128)\n\t,@object_id nvarchar(128)\n\t,@code_table nvarchar(128)\n\t,@code_column nvarchar(128)\n\t,@caption_column nvarchar(128)\n\t,@option nvarchar(max)\n\nSELECT @sql = sql,@columnname=name FROM api_card_fields WHERE id = @card_field_id AND (sql is null OR sql = '')\nIF @columnname is null\n\tBEGIN\n\t\tEXEC sp_api_toast N'Field does not exist or already has sql output (clear first!)'\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_text N'Choose a code TABLE'\nSELECT * INTO #sys_tables FROM (SELECT id=name, name FROM sys_tables UNION SELECT id=name, name FROM @main_db.sys.views) tbl\n\nEXEC sp_api_modal_select_table @tmptable=N'#sys_tables',@value = @code_table OUT\nSELECT @object_id = object_id FROM sys_tables WHERE name = @code_table\nIF @object_id IS NULL SELECT @object_id = object_id FROM @main_db.sys.views WHERE name = @code_table\nIF @object_id Is NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'Choose a CODE column'\n\t\tSELECT id=name, name INTO #sys_columns_code FROM sys_columns WHERE object_id = @object_id\n\t\tEXEC sp_api_modal_select_table @tmptable=N'#sys_columns_code',@value = @code_column OUT\n\t\tIF EXISTS (SELECT * FROM sys_columns WHERE object_id = @object_id AND name = @code_column)\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text N'Choose a CAPTION column'\n\t\t\t\tSELECT id=name, name INTO #sys_columns_caption FROM sys_columns WHERE object_id = @object_id\n\t\t\t\tEXEC sp_api_modal_select_table @tmptable=N'#sys_columns_caption',@value = @caption_column OUT\n\t\t\t\tIF EXISTS (SELECT * FROM sys_columns WHERE object_id = @object_id AND name = @caption_column)\n\t\t\t\t\tBEGIN\n--\t\t\t\t\t\tEXEC sp_api_modal_text @sql\n\t\t\t\t\t\tEXEC sp_api_modal_button @name='Sure',@value = 'Create a select', @valueout = @button OUT\t,@class='btn-primary',@key='Enter'\n\t\t\t\t\t\tIF @button IS NOT NULL\n\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\tEXEC sp_api_populate_card_views @tablename = @code_table\n\t\t\t\t\t\t\t\tSET @sql = N'SELECT '+QUOTENAME(@code_column)+','+QUOTENAME(@caption_column)\n\t\t\t\t\t\t\t\t\t+' FROM '+QUOTENAME(@code_table)+' ORDER BY 2 FOR JSON PATH, INCLUDE_NULL_VALUES'\n\t\t\t\t\t\t\t\tDECLARE @attr_id_extra INT = (SELECT id FROM api_attributes WHERE name = 'extra')\n\t\t\t\t\t\t\t\tDECLARE @attr_id_element INT = (SELECT id FROM api_attributes WHERE name = 'element')\n\t\t\t\t\t\t\t\tDELETE FROM api_card_field_attributes WHERE field_id = @card_field_id AND attr_id IN (@attr_id_extra,@attr_id_element)\n\t\t\t\t\t\t\t\tINSERT INTO api_card_field_attributes (attr_id,sql,field_id) VALUES\n\t\t\t\t\t\t\t\t\t(@attr_id_element,'''Select''',@card_field_id),(@attr_id_extra,@sql,@card_field_id)\n\t\t\t\t\t\t\t\tEXEC sp_api_modal_clear\n\t\t\t\t\t\t\tEND\n\t\t\t\t\tEND\n\t\t\tEND\n\tEND\n\n/*\nRETURN\n\n\nSELECT @sql = sql,@columnname=name FROM api_card_fields WHERE id = @card_field_id AND (sql is null OR sql = '')\nIF @columnname is null\n\tBEGIN\n\t\tEXEC sp_api_toast N'Field does not exist or has sql output'\n\t\tRETURN\n\tEND\nEXEC sp_api_modal_input @name='Add option',@max=5, @value= @option OUT,@focus=1\n\nSET @sql = N'SET @json = (SELECT id = ' + QUOTENAME(@columnname) + ',name = ' + QUOTENAME(@columnname) + ' FROM\n\t\t(SELECT DISTINCT ' + QUOTENAME(@columnname) + ' FROM '+ QUOTENAME(@tablename) + ' UNION SELECT ' + QUOTENAME(@columnname) + ' = @option) tbl WHERE ' + QUOTENAME(@columnname) + ' IS NOT NULL AND ' + QUOTENAME(@columnname) + ' <> '''' GROUP BY ' + QUOTENAME(@columnname) + ' ORDER BY 1 FOR JSON AUTO)'\nEXEC sp_executesql @sql, N'@json  nvarchar(max) OUT,@option nvarchar(max)', @json = @json OUT,@option = @option\nEXEC sp_api_modal_text @json,N'code'\nEXEC sp_api_modal_button @name='Sure',@value = 'Create a select', @valueout = @valueout OUT\t,@class='btn-primary',@key='Enter'\nIF @valueout IS NOT NULL\n\tBEGIN\n\t\tDECLARE @attr_id_extra INT = (SELECT id FROM api_attributes WHERE name = 'extra')\n\t\tDECLARE @attr_id_element INT = (SELECT id FROM api_attributes WHERE name = 'element')\n\t\tDELETE FROM api_card_field_attributes WHERE field_id = @card_field_id AND attr_id IN (@attr_id_extra,@attr_id_element)\n\t\tINSERT INTO api_card_field_attributes (attr_id,sql,field_id) VALUES\n\t\t\t(@attr_id_element,'''Select''',@card_field_id),(@attr_id_extra,dbo.escape_string(@json),@card_field_id)\n\t\tEXEC sp_api_modal_clear\n\tEND\n*/\n\n\n",
            "action_id": 51,
            "action_name": "sys_convert_field_to_code_table",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_convert_field_to_select @card_field_id,@tablename",
            "action_id": 52,
            "action_name": "sys_convert_field_to_select",
            "source_table": "api_actions"
        },
        {
            "sql_source": "/*EXEC sp_api_modal_select @card_name=N'apicard',@name=N'@selected_card_id',@value=@selected_card_id OUT--,@focus=1\nIF @selected_card_id IS NULL RETURN\nEXEC sp_api_modal_clear\nDECLARE @selected_card_name nvarchar(128),@selected_table_name nvarchar(128)\nSELECT @selected_card_name = '['+name+'].',@selected_table_name = ISNULL(basetable,tablename)  FROM api_card WHERE id = @selected_card_id\n*/\nDECLARE @search nvarchar(2000),@button nvarchar(128)\nEXEC sp_api_modal_select_curly @value = @search OUT,@focus=1\n\n/*RETURN\nDECLARE @parsed nvarchar(max) = '{'+REPLACE(@search,@selected_card_name,'')+'}'\nEXEC sp_api_card_curly_replace @card_id = @selected_card_id,@string = @parsed OUT\nSET @parsed = REPLACE(@parsed,'this.',QUOTENAME(@selected_table_name)+'.')\nEXEC sp_api_modal_text @parsed,N'my-3 code'\nRETURN\nSELECT word = CAST('{'+name+'}' as nvarchar(max)) INTO #curly FROM (\n\tselect name FROM api_card_fields WHERE card_id = @selected_card_id\n\tUNION\n\tselect '['+lower(name)+']' FROM api_card WHERE name is not null AND tablename NOT LIKE 'api_%'\n\tUNION\n\tselect '['+lower(ac.name)+'].'+acf1.name FROM api_card ac JOIN api_card_fields acf1 ON ac.id = acf1.card_id WHERE @sql LIKE '%{[[]' + ac.name+']%'\n\tUNION\n\tselect acf1.name+'.'+acf2.name FROM api_card_fields acf1 JOIN api_card_fields acf2 ON acf1.card_id = @card_id AND acf2.card_id = acf1.picklist_card_id\n\t\tWHERE @sql LIKE '%{' + acf1.name+'%'\n\tUNION\n\tselect acf1.name+'.'+acf2.name+'.'+acf3.name FROM api_card_fields acf1 JOIN api_card_fields acf2 ON acf1.card_id = @card_id AND acf2.card_id = acf1.picklist_card_id\n\t\t\tJOIN api_card_fields acf3 ON acf2.card_id = acf1.picklist_card_id AND acf3.card_id = acf2.picklist_card_id\n\t\t\t\tWHERE @sql LIKE '%{' + acf1.name+'.'+acf2.name+'%'\n\t) tbl\n\nEXEC sp_api_modal_table @tmptable=N'#curly'\n*/",
            "action_id": 53,
            "action_name": "sys_curly_brackets",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(2000) = N'',@button nvarchar(128)\nEXEC sp_api_modal_select_curly @value = @search OUT\nEXEC sp_api_modal_text N'',@class=N'm-3'\nEXEC sp_api_modal_button @name='button',@value=N'Insert',@valueout=@button OUT,@key='Insert'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_clear\n\t\tSET @search=N'{'+@search+'}'\n\t\tEXEC sp_api_modal_field_insert @card_field_id,@search\n\tEND",
            "action_id": 54,
            "action_name": "sys_curly_search_and_insert",
            "source_table": "api_actions"
        },
        {
            "sql_source": "/*\nIndien je anders wilt deleten (EXEC DeleteCTR bijvoorbeeld) dan moet je VLAK ERVOOR(!) per id dit aanroepen:\n\n\tEXEC sp_api_history_delete @id,@tablename,@basetable,@identity_column\n\nDan wordt het verwijderde record in api_history opgeslagen!\n\n*/\nEXEC sp_sys_delete @ids,@id,@tablename,@basetable,@identity_column",
            "action_id": 55,
            "action_name": "sys_delete",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast N'Deprecated'\nRETURN\nDELETE FROM api_card_cache\nEXEC sp_api_toast N'Card Cache Deleted'\nUPDATE api_card SET select_cache = NULL",
            "action_id": 56,
            "action_name": "sys_drop_all_cache",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_edit_fields @id,@is_form,@path,@card_field_id,@card_id",
            "action_id": 57,
            "action_name": "sys_edit",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @subject nvarchar(255) = N'Tracy '+@card_name + ' mail'\nDECLARE @body nvarchar(max),@html nvarchar(max),@list_select nvarchar(max),@list_select_cache nvarchar(max)\nSELECT @list_select_cache = list_select_cache FROM api_card WHERE id = @card_id\nSET @list_select=N'\n\tSELECT * INTO #tmptable FROM ('+@list_select_cache+') tbl\n\tEXEC sp_api_html_table N''#tmptable'',N''ORDER BY 2'',@html OUT'\nEXEC sp_executesql @list_select,N'@html nvarchar(max) OUT',@html OUT\n/*\nEXEC sp_api_toast @html\n\nRETURN\nEXEC sp_api_html_table N'api_card',N'ORDER BY name',@html OUT\n*/\n--EXEC sp_api_email @user,@subject,N'<h3>See attached</h3>',@query = @list_select_cache\n\nSET @body = N'<h3>Export</h3>'+@html\nEXEC sp_api_email @user,@subject,@body\nEXEC sp_api_toast N'Sent mail to:'\nEXEC sp_api_toast @user",
            "action_id": 58,
            "action_name": "sys_email_to_me",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_escape @is_form,@path,@previous_path,@parent_id,@card_id,@card_name,@id,@user_id\r\n\t,@ids,@picklist_type,@parent_card_name,@picklist_fieldname,@parent_card_id",
            "action_id": 59,
            "action_name": "sys_escape",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 60,
            "action_name": "sys_goto_card_field_settings",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 61,
            "action_name": "sys_goto_card_settings",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 62,
            "action_name": "sys_hide_all_sk_id",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_alert N'Velden verbergen?',N'Alleen velden van lijstweergave tonen'\nEXEC sp_api_modal_alert N'Zeker weten?',N'De hele bestaande volgorde wordt zoals de lijstweergave!'\nEXEC sp_api_modal_alert N'Laatste waarschuwing!',N'Dit kan niet ongedaan worden!'\nUPDATE acf SET detail_order = list_order FROM api_card_fields acf WHERE card_id = @card_id\n--DELETE FROM api_card_cache WHERE cid = @card_id\nEXEC sp_api_populate_card @card_id\n--EXEC sp_api_card_re_order @card_id\nEXEC sp_api_modal_clear\n",
            "action_id": 63,
            "action_name": "sys_hide_fields_not_in_list",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @rowcount_api_storage INT = 0\nSELECT @rowcount_api_storage = COUNT(child_id) FROM api_storage (NOLOCK) WHERE card_id = @card_id AND child_id = 0 AND user_id = @user_id\nIF @rowcount_api_storage > 0\n\tBEGIN\n\t\tDECLARE @valueout nvarchar(100)\n\t\tEXEC sp_api_modal_text N'Continue with unfinished insert values?',N'h4',1\n\t\tEXEC sp_api_modal_button @name='save',@value = 'Continue', @valueout = @valueout OUT ,@class='btn-success',@key='Enter'\n\t\tEXEC sp_api_modal_button @name='save',@value = 'Reset', @valueout = @valueout OUT ,@class='btn-danger',@key='Delete'\n\t\tIF @valueout IS NULL RETURN\n\t\tEXEC sp_api_modal_clear\n\t\tIF @valueout = 'Reset'\n\t\t\tBEGIN\n\t\t\t\tDELETE FROM api_storage WHERE card_id = @card_id AND child_id = 0 AND user_id = @user_id\n\t\t\t\tEXEC sp_api_toast N'Previous values removed'\n\t\t\tEND\n\tEND\nSET @path+='/0'\nEXEC sp_api_goto @path\n",
            "action_id": 64,
            "action_name": "sys_insert",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @time time = CAST(SYSDATETIME() as time)\n\n\nDECLARE @cursor_ids CURSOR,@fid INT,@fname nvarchar(128),@class nvarchar(128)\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT id,name FROM api_card_fields WHERE card_id = @card_id ORDER BY detail_order\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @fid,@fname\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\n\t\tDECLARE @is_field_updateable BIT\n\t\tEXEC @is_field_updateable = sp_api_card_field_is_updateable @fid,@id\n\t\tIF @is_field_updateable = 1\n\t\t\tSET @class= 'text-success'\n\t\tELSE\n\t\t\tSET @class= 'text-danger'\n\t\tEXEC sp_api_modal_text @fname,@class\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @fid,@fname\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\nDECLARE @ms INT = DATEDIFF(millisecond,@time,CAST(SYSDATETIME() as time))\nEXEC sp_api_toast @ms\n",
            "action_id": 65,
            "action_name": "sys_is_field_updateable",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @sql nvarchar(max)\n\t,@parent_ref nvarchar(128)\n\t,@parent_ref_id nvarchar(max)\n\t,@child_card_id INT\n\t,@child_basetable nvarchar(128)\n\t,@child_tablename nvarchar(128)\n\t,@field_name nvarchar(128)\n\t,@identity_column_child nvarchar(128) = 'id'\n\t,@valueout nvarchar(128)\n\nSELECT @field_name = name,@child_card_id = picklist_card_id,@identity_column_child = picklist_type,@sql=picklist_sql FROM api_card_fields WHERE id = @card_field_id AND picklist_type = 3 --=> 3 is multi pick\n--EXEC sp_api_toast @field_name\nSELECT @child_basetable = basetable,@child_tablename=tablename FROM api_card WHERE id = @child_card_id\nIF @child_tablename IS NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'\"Multi Select Unique\" can only work with fields using picklist type \"Listview picklist multi\"'\n\t\tRETURN\n\tEND\n\n--EXEC sp_api_toast @field_name\n--EXEC sp_api_toast @tablename\nSET @parent_ref_id = N'(SELECT id FROM #parents WHERE card_name = ' + ISNULL(dbo.escape_string(@parent_card_name),'NULL')+')'\n--EXEC sp_api_toast @parent_ref_id\n\nSELECT @identity_column_child = name FROM sys_columns WHERE object_id = (SELECT object_id FROM sys_objects WHERE name = ISNULL(@child_basetable,@child_tablename)) AND is_identity = 1\n--EXEC sp_api_toast @identity_column_child\n\nSELECT @parent_ref = ref FROM api_card_children WHERE child = @card_id AND parent = @parent_card_id\nIF @parent_ref IS NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_alert N'\"Multi Select Unique\" requires a parent reference'\n\t\tRETURN\n\tEND\n--EXEC sp_api_toast @parent_ref\nDECLARE @newsql nvarchar(max) = N''+@identity_column_child+' NOT IN (SELECT '+QUOTENAME(@field_name)+' FROM '+QUOTENAME(@tablename)+' WHERE '+QUOTENAME(@parent_ref)+' = '+@parent_ref_id+') OR '+@identity_column_child+' = @' +dbo.QUOTE_DECLARE(@field_name)\n\nIF LEN(@sql) > 0\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'Overwrite Picklist reducer?',N'h4'\n\t\tEXEC sp_api_modal_text @sql,N'code my-3'\n\t\tEXEC sp_api_modal_text N'With:',N'h4'\n\t\tEXEC sp_api_modal_text @newsql,N'code my-3'\n\t\tEXEC sp_api_modal_button @name='Sure',@value = 'Ok', @valueout = @valueout OUT ,@class='btn-danger',@key='Enter'\n\t\tIF @valueout IS NULL RETURN\n\t\tEXEC sp_api_modal_clear\n\tEND\n\n--SET @json = (SELECT * FROM api_card_children WHERE child = @card_id AND parent = @parent_card_id FOR JSON AUTO, INCLUDE_NULL_VALUES)\nUPDATE api_card_fields SET picklist_sql = @newsql ,unparsed_picklist_reducer=@newsql WHERE id = @card_field_id\nEXEC sp_api_toast N'Done!'\n\n\n",
            "action_id": 66,
            "action_name": "sys_make_multi_select_unique",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_model_diff @card_id,@id",
            "action_id": 67,
            "action_name": "sys_model_diff",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @populate_card_id INT = @card_id\nIF @card_name = 'apicard' SET @populate_card_id = @id\nIF @card_name = 'card_fields' SET @populate_card_id = @parent_id\n\nEXEC sp_api_populate_card @populate_card_id\n--RETURN\nDECLARE @pop_id int,@table nvarchar\n\tDECLARE @cursor_api_card CURSOR\n\tSET @cursor_api_card = CURSOR LOCAL FAST_FORWARD FOR SELECT id FROM api_card\n\t\tWHERE id <> @populate_card_id AND (tablename = (SELECT ISNULL(tablename,'qwerq4232we2342rwe') FROM api_card WHERE id = @populate_card_id)\n\t\t\tOR basetable = (SELECT ISNULL(basetable,'qwerqw2346e23rwe') FROM api_card WHERE id = @populate_card_id))\n\tOPEN @cursor_api_card;\n\tFETCH NEXT FROM @cursor_api_card INTO @pop_id\n\tWHILE @@FETCH_STATUS = 0\n\t\tBEGIN\n\t\t\tDECLARE @sql nvarchar(max) = CONCAT(N'EXEC sp_api_populate_card ',@pop_id)\n\t\t\tEXEC sp_api_add_sql_task @sql\n\t\t\t--EXEC sp_api_populate_card @pop_id\n\t\t\tFETCH NEXT FROM @cursor_api_card INTO @pop_id\n\t\tEND\n\tCLOSE @cursor_api_card;\n\tDEALLOCATE @cursor_api_card;\n",
            "action_id": 68,
            "action_name": "sys_populate_card",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_menu_quick @path",
            "action_id": 69,
            "action_name": "sys_quick_menu",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_refresh_all_views\r\n",
            "action_id": 70,
            "action_name": "sys_refresh_all_views",
            "source_table": "api_actions"
        },
        {
            "sql_source": "/*\nGebruik elders dit:\n\tEXEC sp_api_modal_set N'statusbar_1',N'Gooi dit in de statusbar!'\n\tof\n\tEXEC sp_api_modal_set N'statusbar_all_green',N'Dit overschrijft alles in de statusbar!'\n*/\n--EXEC sp_api_modal_set N'last_access_date',N'2020-01-01'\n\n\nDECLARE @status nvarchar(256)\nEXEC sp_api_modal_get N'last_access_date',@status OUT \nIF @status IS NULL OR @status <> dbo.strdate(NULL)\n\tBEGIN\n\t\tEXEC sp_api_toast N'Welkom deze nieuwe dag!!!'\n\t\tEXEC sp_api_modal_set N'workdate',NULL\n\t\tSET @status = dbo.strdate(NULL)\n\t\tEXEC sp_api_modal_set N'last_access_date',@status\n\t\tEXEC sp_api_modal_set N'statusbar_all_green',NULL -- wissen!\n\t\t--SP_DAILY HIER\n\t\tEXEC sp_api_health_status\n\tEND\nEXEC sp_api_health_status\n\nEXEC sp_api_modal_get N'workdate',@status OUT \nIF @status IS NULL\n\tBEGIN\n\t\tSET @status = dbo.abcdate()\n\t\tEXEC sp_api_modal_set N'workdate',@status \n\tEND\n\n\n/* --=> statusbar_all overschrijft alle status */\nEXEC sp_api_modal_get N'statusbar_all_red',@status OUT \nIF @status IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_statusbar @status ,'bg-danger col-sm-3 text-truncate',0 --> 0 is links\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_get N'statusbar_all_blue',@status OUT \nIF @status IS NOT NULL --OR  1=1\n\tBEGIN\n\t\tEXEC sp_api_statusbar @status ,'bg-primary col-sm text-truncate',1 --> 0 is links\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_get N'statusbar_all_green',@status OUT \nIF @status IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_statusbar @status ,'bg-success col-sm-3 text-truncate',1 --> 0 is links\n\t\tRETURN\n\tEND\n\nEXEC sp_api_modal_get N'statusbar_all_yellow',@status OUT \nIF @status IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_statusbar @status ,'bg-warning col-sm-3 text-truncate',1 --> 0 is links\n\t\tRETURN\n\tEND\n\n\n\n\n\nEXEC sp_api_modal_get N'workdate',@status OUT\nDECLARE @class nvarchar(255) = N'bg-danger col-sm-1 text-truncate' -- zet kleur danger...\nIF dbo.abcdate() = @status SET @class = N'col-sm-1 text-truncate' -- als workdate gelijk is aan echte datum, dan geen kleur\n\nSET @status = dbo.strdate(@status)\nIF @status IS NOT NULL EXEC sp_api_statusbar @status ,@class,0 --> 0 is links\n-----------------------------------\n/* hier verder als statusbar_all NULL is */\nIF OBJECT_ID('xtenant') IS NOT NULL\n\tBEGIN\n\t\tif (select isnull(xtenant.forceToTestmodus,0) from xtenant where id=7)=1\n\t\t\tbegin\n\t\t\t\tEXEC sp_api_statusbar N'*TESTMODUS*' ,'bg-warning col-sm-1 text-truncate',0 --> 0 is links --'bg-danger col-sm-1 text-truncate'\n\t\t\tend\n\t\telse\n\t\t\tbegin\t\n\n\t\t\t\tEXEC sp_api_modal_get N'statusbar_1',@status OUT\n\t\t\t\tIF @status IS NOT NULL EXEC sp_api_statusbar @status ,'col-sm-1 text-truncate',0 --> 0 is links --'bg-danger col-sm-1 text-truncate'\n\t\t\tend\n\tEND\nDECLARE @is_admin bit = dbo.hasRole('admin')\nIF object_id('@main_db.dbo.debug_trigger_xCompany') IS NOT NULL AND @is_admin = 1\n\tbegin\n\t\tEXEC sp_api_statusbar N'DEBUG ON' ,'bg-primary col-sm-1 text-truncate',0 --> 0 is links --'bg-danger col-sm-1 text-truncate'\n\tend\n\nDECLARE @forcedRole nvarchar(4000)\nEXEC sp_api_modal_get N'forcedRole',@forcedRole OUT \nIF @forcedRole IS NOT NULL EXEC sp_api_statusbar @forcedRole ,'bg-primary col-sm-1 text-truncate',0 --> 0 is links\n/*\n\t\tEXEC sp_api_modal_get N'statusbar_1',@status OUT\n\t\tIF @status IS NOT NULL EXEC sp_api_statusbar @status ,'col-sm-1 text-truncate',0 --> 0 is links --'bg-danger col-sm-1 text-truncate'\n*/\t\t\n----------------------------------------------\n \n\nEXEC sp_api_modal_get N'statusbar_2',@status OUT\nIF @status IS NOT NULL EXEC sp_api_statusbar @status ,'col-sm-1-2 text-truncate',1 --> 1 is rechts -- 'bg-warning col-sm-1-2 text-truncate'\nEXEC sp_api_modal_get N'statusbar_4',@status OUT\nEXEC sp_api_statusbar @status ,'col-sm-1-3 text-truncate',1 --> 1 is rechts -- vijv success kleur: 'bg-success col-sm-1-3 text-truncate'\n\nEXEC sp_api_statusbar @user_name,'col-sm-1 text-truncate',0 --> 0 is links -- bijv rood: 'bg-warning col-sm-1 text-truncate'\n\n\nEXEC sp_api_statusbar @card_name,'col-sm-1 text-truncate text-right',1 --> 1 is rechts\n\n/*\nDECLARE @filter_reducer_name nvarchar(128) = TRY_CAST(SESSION_CONTEXT(N'query_red') as nvarchar(128))\nIF @filter_reducer_name > ''\n\tBEGIN\n\t\tSET @filter_reducer_name = N'Filter: '+(SELECT * FROM get_lang(@filter_reducer_name,'menu'))\n\t\tEXEC sp_api_statusbar @filter_reducer_name,'col-sm-2 text-truncate bg-primary',1 --> 1 is rechts\n\tEND\n\nEXEC sp_api_statusbar '','col-sm-1-2 text-center' -- 'bg-danger col-sm-1-2 text-center'\nEXEC sp_api_statusbar '','col-sm-1-2 text-center',1 --> 1 is rechts -- 'bg-primary col-sm-1-2 text-center'\nEXEC sp_api_statusbar '','col-sm-1-2 text-center',1 --> 1 is rechts --'bg-danger col-sm-1-2 text-center'\n*/\n/* the end */",
            "action_id": 71,
            "action_name": "sys_run_always",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @json nvarchar(max),@sql nvarchar(max),@columnname nvarchar(128),@columnsql nvarchar(max),@valueout nvarchar(128),@option nvarchar(max),@outval nvarchar(max), @attr_id_fill_with INT,@daSQL nvarchar(max)\n\nSELECT @sql = sql,@columnname=name,@columnsql=IIF(sql is null OR sql = '',QUOTENAME(name),'('+sql+CHAR(13)+')') FROM api_card_fields WHERE id = @card_field_id --AND (sql is null OR sql = '')\nIF @columnname is null\n\tBEGIN\n\t\tEXEC sp_api_toast N'Field does not exist or has sql output'\n\t\tRETURN\n\tEND\nDECLARE @tmpsql nvarchar(max) = N'SELECT @outval = ' + @columnsql +' FROM '+QUOTENAME(@basetable)+' this WHERE ' + QUOTENAME(@identity_column) + ' = ' + @id\nEXEC sp_executesql @tmpsql,N'@outval nvarchar(max) OUT', @outval OUT\n\t\tEXEC sp_api_toast @outval\n\n\nIF @parent_card_name is null\n\tBEGIN\n\t\t--EXEC sp_api_modal_alert 'No parent card, no defaults!'\n\t\t--EXEC sp_api_modal_clear\n\t\t--RETURN;\n\t\tEXEC sp_api_toast N'Setting op basiskaart'\n\tEND\n\n--\tIF EXISTS (SELECT * FROM xDefaults WHERE ContextCardName = isnull(@parent_card_name,N'') AND Cardname = @card_name AND FieldName = @columnname)\n--\t\tUPDATE xDefaults \n--\t\t\tSET BaseTableName = @basetable \n--\t\t\t\t,DefaultValue = @outval\n--\t\t\t\tWHERE ContextCardName = isnull(@parent_card_name,N'') AND Cardname = @card_name AND FieldName = @columnname\n--\tELSE\n--\t\tINSERT xDefaults (BaseTableName,ContextCardName,Cardname,FieldName,DefaultValue) VALUES (@basetable,isnull(@parent_card_name,N''),@card_name,@columnname,@outval)\n--\n--\tEND\n\tEXECUTE @main_db.dbo.IINE_xDefaults @basetable,@parent_card_name,@card_name,@columnname,@outval --Wat als @parent_card_name IS NULL ?no problem, mag gewoon, dan zit je OPEN een hoofdk-levoe, l ok maar het werkte niet alles werkte gwoon goed.. (dacht ik)\n\n\n--user change value:\n--SET @option='wawa'--@card_field_value\n--EXEC sp_api_modal_input @name='SET default Value',@max=5, @value= @option OUT,@focus=1\n\n--show result info\nEXEC sp_api_modal_text @outval,N'code'\n\nEXEC sp_api_modal_button @name='Sure',@value = 'This value as Default', @valueout = @valueout OUT\t,@class='btn-primary',@key='Enter'\nIF @valueout IS NOT NULL\n\tBEGIN\n\tSET @attr_id_fill_with = (SELECT id FROM api_attributes WHERE name = 'fill_with')\n\tSELECT @daSQL=N'(select top 1 DefaultValue from xdefaults where Cardname = @card_name and contextCardName= @parent_card_name and fieldname=@card_field_name)'\n\tEXEC sp_api_toast @daSQL\n\n\t--write to card field settings\n\tDELETE FROM api_card_field_attributes WHERE field_id = @card_field_id AND attr_id =@attr_id_fill_with\n\t--INSERT INTO api_card_field_attributes (attr_id,sql,field_id) VALUES (@attr_id_fill_with,dbo.escape_string(@daSQL),@card_field_id)\n\tINSERT INTO api_card_field_attributes (attr_id,sql,field_id) VALUES (@attr_id_fill_with,@daSQL,@card_field_id)\n\n\t\tEXEC sp_api_modal_clear\n\tEND\n",
            "action_id": 72,
            "action_name": "sys_set_default_for_field",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @workdate nvarchar(128),@button nvarchar(128)\n--EXEC sp_api_modal_get N'workdate',@workdate OUT --GB210106\nEXEC sp_api_modal_date @name=N'Workdate',@value=@workdate OUT,@focus=1,@select=1\nEXEC sp_api_modal_button @name=N'button',@value=N'Set workdate',@valueout= @button OUT,@key='Enter'\nEXEC sp_api_modal_button @name=N'button',@value=N'Morgen',@valueout= @button OUT,@key='M'\nEXEC sp_api_modal_button @name=N'button',@value=N'Gisteren',@valueout= @button OUT,@key='G'\nIF @button IS NOT NULL\n\tBEGIN\n\t\tIF @button = 'Morgen' SET @workdate = dbo.strdate(DATEADD(DAY,1,GETDATE()))\n\t\tIF @button = 'Gisteren' SET @workdate = dbo.strdate(DATEADD(DAY,-1,GETDATE()))\n\t\tEXEC sp_api_modal_set N'workdate',@workdate\n\t\tEXEC sp_api_modal_clear\n\tEND\n\n",
            "action_id": 73,
            "action_name": "sys_set_workdate",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @search nvarchar(2000) = N'?filter=card_id.swhas('+@card_name+')'\nEXEC sp_api_goto N'/api_storage',@search",
            "action_id": 74,
            "action_name": "sys_storage",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_table_size @basetable",
            "action_id": 75,
            "action_name": "sys_table_size",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_translate @id,@card_field_id",
            "action_id": 76,
            "action_name": "sys_translate",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_workflow @card_name,@ids,@tablename,@basetable,@identity_column",
            "action_id": 77,
            "action_name": "sys_workflow",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 78,
            "action_name": "TenantSettings",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 79,
            "action_name": "test",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--EXEC sp_api_modal_set N'statusbar_all_green',NULL\nDECLARE @S1 nvarchar(50)\nEXEC sp_api_modal_get N'statusbar_all_green', @S1 OUT\nIF @S1 is null EXEC sp_api_modal_set N'statusbar_all_green',N'klik ''test statusbar'' nog een keer!'\nELSE EXEC sp_api_modal_set N'statusbar_all_green',NULL\n\n--EXEC sp_api_modal_set N'statusbar_all_red',NULL\n--EXEC sp_api_modal_set N'statusbar_all_red',N'Dit overschrijft alles in de statusbar!'",
            "action_id": 80,
            "action_name": "Test de statusbar",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @text2 nvarchar(max) = {[inkoop].Counterparty_ID.CompanyName} \nEXEC sp_api_toast @text2 \n\nDECLARE @text nvarchar(255) = N'@card_id INT = '+@card_id+'\n\t\t\t\t,@id INT = '+@id +'\n\t\t\t\t,@ids nvarchar(max) = '+@ids +'\n\t\t\t\t,@tablename NVARCHAR(128) = '+dbo.nv(@tablename) +'\n\t\t\t\t,@identity_column NVARCHAR(1024) = '+dbo.nv(@identity_column )+'\n\t\t\t\t,@parent_id INT = '+@parent_id +'\n\t\t\t\t,@path nvarchar(4000) = '+dbo.nv(@path )+'\n\t\t\t\t,@is_new INT = '+dbo.nv(@is_new )+'\n\t\t\t\t'\nEXEC sp_api_modal_text @text\nEXEC sp_api_modal_text @text=N'Gewoon een test modal',@class=N'h3'\nEXEC sp_api_modal_text 'Gewoon een sub-test modal','h4'\nEXEC sp_api_modal_text 'Weet jij van tralala?','p-4'\nDECLARE @value nvarchar(10) = 'rick'\nEXEC sp_api_modal_input @name='Titel van het rapport',@max=10, @value = @value OUT\nIF @value is NULL RETURN\nEXEC sp_api_modal_text @value\nEXEC sp_api_modal_text 'Even overleggen!!!','h1'\n",
            "action_id": 81,
            "action_name": "test_met_modal",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @ST nvarchar(100)\nEXEC sp_api_modal_get N'statusbar_all_red',@st OUT \nIF @st IS NOT NULL EXEC sp_api_modal_set N'statusbar_all_red', NULL\nELSE EXEC sp_api_modal_set N'statusbar_all_red', N'Klik weer op test RED'",
            "action_id": 82,
            "action_name": "testred",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @ST nvarchar(100)\nEXEC sp_api_modal_get N'statusbar_all_yellow',@st OUT \nIF @st IS NOT NULL EXEC sp_api_modal_set N'statusbar_all_yellow', NULL\nELSE EXEC sp_api_modal_set N'statusbar_all_yellow', N'Press ''TEST YELLOW'' again'",
            "action_id": 83,
            "action_name": "testyellow",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 84,
            "action_name": "toastje",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 85,
            "action_name": "transporteurs",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/vatperc'\n",
            "action_id": 86,
            "action_name": "vatPercentage",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 87,
            "action_name": "Verkoop",
            "source_table": "api_actions"
        },
        {
            "sql_source": null,
            "action_id": 88,
            "action_name": "verkoop_uit_voorraad",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/xvessel'",
            "action_id": 89,
            "action_name": "Vessel",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @value bit\nexec sp_api_modal_sure @alert_text =N'alle data wissen?', @value = @value OUT\n\nif @value=1\n\tbegin\n\t\tif (select count(*) from xinvoice) <20\n\t\t\tbegin\n\t\t\t\tupdate xinvoice set status='Draft'\n\t\t\t\texec sp_wis_alles 2023\n\t\t\t\texec sp_api_modal_clear\n\t\t\t\treturn;\n\t\t\tend\t\n\tend\t\n\nif @value=0\n\tbegin\n\t\texec sp_api_modal_clear\n\t\treturn;\n\tend\t\n\t\nexec sp_api_modal_restart\t\n\t",
            "action_id": 90,
            "action_name": "wis_alles",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @cursor_ids CURSOR,@cid INT, @tekst NVARCHAR(100), @sqlTask nvarchar(1024)\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tSET @TEKST=CONCAT(N'Toewijzen order ',@cid)\n\t\tEXEC sp_api_toast @TEKST\n/*\n\t\t------------------single action---------------------------------------------------\n\t\texec @main_db.dbo.SP_CURSED_MAPPER_CTH @CTH_ID =@cid ,@MAPINKOOP =1,@MAPVERKOOP =1\n\t\t--zet tevens landfreight op checked\n\t\texec @main_db.dbo.SP_CURS_SetChecked_CTH @cid\n\t\t----------------------------------------------------------------------------------\n*/\n\t\tSET @sqltask = CONCAT(N'\n\t\texec @main_db.dbo.SP_CURSED_MAPPER_CTH @CTH_ID =',@cid,' ,@MAPINKOOP =1,@MAPVERKOOP =1\n\t\texec @main_db.dbo.SP_CURS_SetChecked_CTH ',@cid)\n\t\tEXEC sp_api_add_sql_task @sql=@sqltask,@description=@TEKST --N'Verstuur facturen'\n\t\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n--wis als laatste alle markeringen\nEXEC sp_api_modal_select_all_clear \n\n\n\n\n",
            "action_id": 91,
            "action_name": "CTH_Toewijzen",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_search_all @card_id_reduced,@reducer,@focus,@highlight",
            "action_id": 92,
            "action_name": "sys_search_all",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_alert N'Populate all cards?',N'Action will be scheduled.'\nEXEC sp_api_modal_clear\nEXEC sp_api_populate_cards\nEXEC sp_api_push_bullet @channel_tag = 'tracy',@title=@User_name, @body='Populate ALL', @type='link', @url=N'https://agfx.nl'\nEXEC sp_api_modal_route @name = N'Go to tasks',@pathname=N'/api_sql_tasks'\t,@search =N'?ord=16594d' ,@class = N'btn-success' ,@key = N'Enter'\n",
            "action_id": 93,
            "action_name": "sys_populate_all",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @field_name nvarchar(128),@text nvarchar(max)\nSELECT @field_name = name FROM api_card_fields WHERE card_id = @card_id AND id = @card_field_id\nSET @text = N'This will delete field ['+@field_name+'] and its attributes. Re-populate, so it may come back'\nEXEC sp_api_modal_alert N'Warning!',@text\nDELETE FROM api_card_fields WHERE card_id = @card_id AND id = @card_field_id\nEXEC sp_api_populate_card @card_id\nEXEC sp_api_modal_clear",
            "action_id": 94,
            "action_name": "sys_gui_delete",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_gui_insert @card_id,@card_field_id",
            "action_id": 95,
            "action_name": "sys_gui_insert_text",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_list_editable @card_id,@id",
            "action_id": 99,
            "action_name": "sys_list_editable",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_route @name='verkoop definitief',@pathname='/verkoop',@search= '?red=closed+sales' --&ord=8629d' ",
            "action_id": 103,
            "action_name": "men_sales_closed",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--EXEC sp_api_toast @parent_parent_id\r\n--exec sp_api_toast @User\r\n\t\r\nDECLARE @CTHID INT = {[verkoop].id} --200818 curly\r\nIF @CTHID IS NULL begin\r\n\t\tEXEC sp_api_toast 'Kan geen [verkoop] vinden'\r\n\t\tRETURN;\r\n\t\tend\r\n--ELSE EXEC sp_api_toast @CTHID\r\n\r\n--DECLARE @CTRID INT \r\n--SELECT @CTRID=id from xtransactiondetail where TransactionHeader_ID = @CTHID\r\n\r\nDECLARE @GIP nvarchar(10)\r\nselect @GIP= av from @main_db.dbo.gip(@ID)\r\n\r\nDECLARE @mes nvarchar(200), @FustSaldo int, @CoreType nvarchar(10),@FustID int, @xDesc nvarchar(200)\r\nSELECT @xDesc=x.[Description],@mes= concat('Selling ' , x.[Description],' (GIP:',TRY_CAST(@GIP as decimal(8,2)),')'),@Coretype= x.coretype,@FustID=x.Fust_ID from xstock x where x.id=@ID --@main_db.dbo.\r\n--EXEC sp_api_modal_text @mes,'h2 text-primary'\r\n\r\nIF {[verkoop].status} not in ('openSale') AND @Coretype='FOOD' BEGIN --200924 fust mag wel worden bij of afgeboekt\r\n\tEXEC sp_api_modal_alert 'U kunt alleen leeg FUST toevoegen/terugnemen, want de order is definitief.'\r\n\tEXEC sp_api_modal_clear\t\t\r\n\tRETURN;\t\r\n\tend\r\n\r\n-- 200629 Uitbreiding inkoop vanuit diverse contexten: Zoek CTH ; bijv als we afkomstig zijn van een regel, dan is CTH te vinden in de regel\r\n--if @parent_card_name ='verkoop'\tset @CTHID=@parent_id\r\n--if @parent_card_name = 'ctr2' set @CTHID=(select TransactionHeader_ID from xtransactiondetail where xtransactiondetail.id=@parent_id)\r\nIF @coretype in('CRATE','PALLET')\r\n\tBEGIN\r\n\t\tSELECT @Fustsaldo=Fustsaldo from @main_db.dbo.FustSaldo_FC(@FustID,{[verkoop2].Counterparty_ID})\r\n\t\t-- EXEC sp_api_toast @Fustsaldo\r\n\t\t-- breid DECLARE message uit met het fust-saldo\r\n\t\tIF @FustSaldo is not NULL\r\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') actueel saldo bij deze klant: ',@fustsaldo)\r\n\t\tELSE\r\n\t\t\tSET @mes=concat('Fust bij- of afboeken (', @xDesc,') => let op: deze klant heeft dit fust nooit eerder gehad!')\r\n\tEND\r\n\t\r\nDECLARE @text nvarchar(max),@prodcode_id INT,@artcode_id INT\r\nDECLARE @prijs nvarchar(20),@aantal nvarchar(20),@opmerking nvarchar(10), @Pricetype nvarchar(10) --='100'\r\nDECLARE @CounterpartyID int\r\nDECLARE @FlowModel int\r\nDECLARE @THDT INT\r\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=FlowModel_ID,@THDT=TDT From xTransactionHeader CTH where CTH.ID=@CTHID\r\n--200630 was@parent_id\r\n\r\n--200708 => ??? WAAROM GAAT DIT NIET ??? select @Prijs= @main_db.dbo.StockPrice(@ID,@CTHID,NULL,NULL,NULL,NULL,NULL,NULL,NULL)\r\nDECLARE @FRAFOT Nvarchar(3) -- 'FRA' OF 'FOT'\r\nDECLARE @SrcID int -- let op: slechts 'advies'\r\nDECLARE @DstID INT\r\n\r\n\r\n--201022\r\ndeclare @dayprice bit\r\nset @dayprice=isnull((select L from @main_db.dbo.[GetCompanySettings]('useDayprice')),0)\r\n-- exec sp_api_toast @dayprice\r\n\r\nif @dayprice = 1 \r\n\tBEGIN\r\n\t\tselect top 1 @Prijs=per.pricehi from p_PriceEntryRow per where per.Stock_ID=@ID and per.Supplier_ID=@CounterpartyID and per.activeCount>0\r\n\tEND\r\n\r\nSELECT @CounterpartyID = CTH.counterparty_ID,@FlowModel=cth.FlowModel_ID,@THDT=cth.TDT,@FRAFOT=cth.FRAFOT, @srcID=cth.source_ID,@DstID=cth.Destination_ID From q_xTransactionHeader CTH where CTH.ID=@CTHID\r\n-- exec sp_api_toast @dstID\r\n--200630 was@parent_id\r\n\r\nif isnull(@Prijs,0)=0\r\n\tbegin\r\n\t\t--SELECT top 1 @prijs = ctr.ctrPRICE FROM xctrtotals ctr WHERE ctr.ctrprice > 0 AND ctr.Counterparty_ID=@CounterpartyID AND ctr.ctrStock_ID =@ID ORDER BY ctr.id DESC -- laatste prijs!\r\n\r\n\t\tset @prijs=(select @main_db.dbo.stockprice(\t@ID --48482 --stock_ID\r\n\t\t\t\t\t\t\t,@CTHID --3761\t--CTH_ID\r\n\t\t\t\t\t\t\t,@CounterpartyID --161418\t--Counterparty_ID\r\n\t\t\t\t\t\t\t,@FlowModel --null\t--Flowmodel_ID\r\n\t\t\t\t\t\t\t,@THDT --2\t\t--DaTDT\r\n\t\t\t\t\t\t\t,@SrcID --NULL --SupplierLocation_ID\r\n\t\t\t\t\t\t\t,@DstID --NULL -- 7945\t--Receiverlocation_ID\r\n\t\t\t\t\t\t\t,IIF(@FRAFOT='FOT',1,0)\t\t--isFOT\r\n\t\t\t\t\t\t\t,@dayprice --0-- use dayprice\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\r\n\tend\r\n\r\nIF @id = ANY (select stock_id from xtransactiondetail where TransactionHeader_ID = @CTHID AND stock_id = @id) BEGIN\r\n\tDECLARE @QTYCTR nvarchar(20)\r\n\tSELECT @QTYCTR = sum(Amount) from xTransactiondetail where @id = stock_id AND TransactionHeader_ID = @CTHID\r\n\tEXEC sp_api_modal_text 'Let op! Dit artikel bestaat al in de bestelling!','text-danger font-weight-bold h2 text-center'\r\n\tEXEC sp_api_modal_text 'Momenteel in bestelling:','text-danger font-weight-bold h2 text-center'\r\n\tEXEC sp_api_modal_text @QTYCTR,@class = 'text-danger font-weight-bold display-4 text-center'\r\nEND\r\nEXEC sp_api_modal_text @text = @mes,@class = 'h3 text-muted'\r\nEXEC sp_api_modal_text 'Aantal'\r\nEXEC sp_api_modal_input @name='aantal',@value = @aantal OUT,@focus=1,@select=1\r\nIF @coretype in('FOOD')\r\n\tBEGIN\r\n\t\tEXEC sp_api_modal_text 'Prijs'\r\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT\r\n\tEND\r\nEXEC sp_api_modal_text 'Opm. loods'\r\nEXEC sp_api_modal_input @name='opmerking',@value = @opmerking OUT\r\nDECLARE @button nvarchar(128)\r\nEXEC sp_api_modal_button @name='button',@value = 'Toevoegen',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\r\nDECLARE @mapfustpartijregel int\r\n\r\n\tBEGIN\r\n\t\tIF dbo.str2dec(@prijs) > 100 BEGIN -- groter dan 100\r\n\t\tEXEC sp_api_modal_clear\t\r\n\t\tEXEC sp_api_modal_text 'LET OP! PRIJS IS GROTER DAN:','text-danger font-weight-bold text-center'\r\n\t\tEXEC sp_api_modal_text '100,00', 'text-danger font-weight-bold display-4 text-center'\r\n\t\tEXEC sp_api_modal_text 'DRUK (INSERT) OM TOCH DOOR TE GAAN OF VUL EEN ANDERE PRIJS IN:','text-danger font-weight-bold text-center'\r\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT,@focus=1,@select=1\r\n\t\tDECLARE @button2 nvarchar(128)\r\n\t\tEXEC sp_api_modal_button @name='button2',@value = 'Doorgaan',@valueout = @button2 OUT,@class = 'btn-danger',@key = 'Insert'\r\n\t\tEXEC sp_api_modal_text 'DRUK OP (ESC) OM DIT SCHERM TE VERLATEN','text-Secondary text-right blockquote-footer'\r\n\t\tIF @button2 IS NOT NULL BEGIN\r\n\t\t\tIF @button IS NOT NULL\r\n\t\t\tBEGIN\r\n\t\t\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') \r\n\t\t\t\tIF \t\tdbo.str2dec(@prijs) > 0 OR dbo.str2dec(@prijs) = 0 AND \r\n\t\t\t\t\t\tdbo.str2dec(@aantal) > 0 \r\n\t\t\t\t\t\tOR @FustSaldo is not NULL \r\n\t\t\t\t\tBEGIN\r\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs,@Logistic=@Opmerking, @User=@User\r\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\t\tEND\r\n\t\t\t\tELSE\r\n\t\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\t\t\t\tEND \t\t\r\n\t\t\tEND\r\n\t\tEND\r\n\r\n\t\tIF dbo.str2dec(@prijs) BETWEEN 0 AND 1 BEGIN -- kleiner dan 1\r\n\t\tEXEC sp_api_modal_clear\r\n\t\tEXEC sp_api_modal_text 'LET OP! PRIJS IS KLEINER DAN:','text-danger font-weight-bold text-center'\r\n\t\tEXEC sp_api_modal_text '1,00','text-danger font-weight-bold display-4 text-center'\r\n\t\tEXEC sp_api_modal_text 'DRUK (INSERT) OM TOCH DOOR TE GAAN OF VUL EEN ANDERE PRIJS IN:','text-danger font-weight-bold text-center'\r\n\t\tEXEC sp_api_modal_input @name='prijs',@value = @prijs OUT,@focus=1,@select=1\r\n\t\tDECLARE @button3 nvarchar(128)\r\n\t\tEXEC sp_api_modal_button @name='button3',@value = 'Doorgaan',@valueout = @button3 OUT,@class = 'btn-danger',@key = 'Insert'\r\n\t\tEXEC sp_api_modal_text 'DRUK OP (ESC) OM DIT SCHERM TE VERLATEN','text-Secondary text-right blockquote-footer'\r\n\t\tIF @button3 IS NOT NULL BEGIN\r\n\t\t\tIF @button IS NOT NULL\r\n\t\t\tBEGIN\r\n\t\t\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') \r\n\t\t\t\tIF \t\tdbo.str2dec(@prijs) > 0 OR dbo.str2dec(@prijs) = 0 AND \r\n\t\t\t\t\t\tdbo.str2dec(@aantal) > 0 \r\n\t\t\t\t\t\tOR @FustSaldo is not NULL \r\n\t\t\t\t\tBEGIN\r\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs,@Logistic=@Opmerking, @User=@User\r\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\t\tEND\r\n\t\t\t\tELSE\r\n\t\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\t\t\t\tEND \t\t\r\n\t\t\tEND\r\n\t\tEND\r\n\tEND\r\n\r\nIF @button IS NOT NULL AND dbo.str2dec(@prijs) BETWEEN 1 AND 100 -- tussen 1 en 100\r\n\t\t\tBEGIN\r\n\t\t\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- dit vertaalt een komma in een punt, waardoor iemand 123,85 kan intikken END ook 123.85\r\n\t\t\t\tIF \t\tdbo.str2dec(@prijs) > 0 AND \r\n\t\t\t\t\t\tdbo.str2dec(@aantal) > 0 \r\n\t\t\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\r\n\t\t\t\t\tBEGIN\r\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs,@Logistic=@Opmerking, @User=@User\r\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\t\tEND\r\n\t\t\t\tELSE\r\n\t\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\t\t\t\tEND\r\nIF @button IS NOT NULL AND @coretype in('CRATE','PALLET') -- fust\r\n\t\t\tBEGIN\r\n\t\t\t\tIF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- dit vertaalt een komma in een punt, waardoor iemand 123,85 kan intikken END ook 123.85\r\n\t\t\t\tIF \t\t--dbo.str2dec(@prijs) > 0 AND \r\n\t\t\t\t\t\tdbo.str2dec(@aantal) > 0 \r\n\t\t\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\r\n\t\t\t\t\tBEGIN\r\n\t\t\t\tSET @mapfustpartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\r\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs,@Logistic=@Opmerking, @User=@User,@mapctr_id=@mapfustpartijregel\r\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\t\tEND\r\n\t\t\t\tELSE\r\n\t\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\t\t\t\tEND\r\nIF @button IS NOT NULL AND dbo.str2dec(@aantal) > 0  AND dbo.str2dec(@prijs) is NULL -- aantal groter dan 0 en price niet ingevuld.\r\n\t\t\tBEGIN\r\n\t\t\t\t--IF @Prijs>N'' SET @Prijs=replace(@Prijs, ',', '.') -- dit vertaalt een komma in een punt, waardoor iemand 123,85 kan intikken END ook 123.85\r\n\t\t\t\tIF \t\t--dbo.str2dec(@prijs) > 0 AND \r\n\t\t\t\t\t\tdbo.str2dec(@aantal) > 0 \r\n\t\t\t\t\t\tOR @FustSaldo is not NULL -- 200921 Als het een selectie van LEEG FUST betreft, dan mag het aantal Negatief zijn!\r\n\t\t\t\t\tBEGIN\r\n\t\t\t\tSET @mapfustpartijregel=(select @main_db.dbo.FustIV_VTD(@FustID))\r\n\t\t\t\t\t\texec @main_db.dbo.CreateCTR @CTH_ID=@CTHID, @stock_ID=@ID,@Amount=@Aantal,@Price=@Prijs,@Pricetype='FIXED',@Logistic=@Opmerking, \t\t\t \r\n   \t\t\t\t\t\t@User=@User,@mapctr_id=@mapfustpartijregel\r\n\t\t\t\t\t\tselect @mes = 'Er zijn '+@Aantal+ ' colli '+ x.[Description]+' toegevoegd aan de order' from xstock x where x.id=@ID\r\n\t\t\t\t\t\texec sp_api_toast @mes\r\n\t\t\t\t\t\tEXEC sp_api_modal_clear\t\t\t\t\t\t\r\n\t\t\t\t\tEND\r\n\t\t\t\tELSE\r\n\t\t\t\t\tEXEC sp_api_modal_text 'Aantal of prijs niet geldig!','text-danger'\r\n\t\t\t\tEND",
            "action_id": 104,
            "action_name": "SelectAmountVerkoop",
            "source_table": "api_actions"
        },
        {
            "sql_source": "{[city]}",
            "action_id": 105,
            "action_name": "testgein",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @mainclass nvarchar(128) = N'm-4 text-muted'\n\t,@text nvarchar(max)\n\nEXEC sp_api_modal_text @text = N'Add a JSON field',@class = N'h4 text-muted'--, @translate = 1\nEXEC sp_api_modal_text @text = N'Choose a column which is the JSON data store',@class = @mainclass--, @translate = 1\n\nIF @tablename LIKE 'api[_]%'\n\tBEGIN\n\t\tSELECT id=name,name INTO #sys_columns_proj FROM sys.columns WHERE object_id = (SELECT object_id FROM sys.objects WHERE name = @basetable) AND max_length=-1\n\t\tSET @tmptable=N'#sys_columns_proj'\n\tEND\nELSE\n\tBEGIN\n\t\tSELECT id=name,name INTO #sys_columns FROM sys_columns WHERE object_id = (SELECT object_id FROM sys_objects WHERE name = @basetable) AND max_length=-1\n\t\tSET @tmptable=N'#sys_columns'\n\tEND\n\n\nDECLARE @json_column nvarchar(128),@json_key nvarchar(4000)\nEXEC sp_api_modal_select_table @tmptable=@tmptable,@value = @json_column OUT,@focus=1--,@select=1\n\nIF @json_column IS NULL RETURN\nDECLARE @sql nvarchar(max)\nCREATE TABLE #in_use (JSON nvarchar(max))\nSET @sql = CONCAT(N'INSERT #in_use SELECT ''[''+LEFT(',QUOTENAME(@json_column),',200)+'']'' FROM ',QUOTENAME(@tablename)\n\t\t,' WHERE ISJSON(',QUOTENAME(@json_column),') = 0 AND ',QUOTENAME(@json_column),'> '''' ORDER BY newid()')\nEXEC(@sql)\n--DECLARE @json nvarchar(max) = (SELECT * FROM #in_use FOR JSON AUTO, INCLUDE_NULL_VALUES)\n--EXEC sp_api_modal_text @json\n\nIF EXISTS(SELECT * FROM  #in_use)\n\tBEGIN\n\t\tEXEC sp_api_modal_text @text = N'\u26a0\ufe0f Some fields (top 25 shown) are in use as non-JSON. These will be over-written:',@class = @mainclass\n\t\tEXEC sp_api_modal_table @tmptable=N'#in_use',@orderby=N'ORDER BY 1 OFFSET 0 ROWS FETCH NEXT 25 ROWS ONLY'\n--\t\tEXEC sp_api_modal_clear\n\tEND\nCREATE TABLE #json_keys (id nvarchar(4000),name nvarchar(4000))\nSET @sql = CONCAT(N'INSERT #json_keys SELECT DISTINCT id = j.[key],name = j.[key] FROM ',QUOTENAME(@tablename)\n\t,' CROSS APPLY OPENJSON(',QUOTENAME(@json_column),') j WHERE ISJSON(',QUOTENAME(@json_column),') > 0')\nEXEC(@sql)\n\n\n/*\nEXEC sp_api_modal_text @text = N'Kies een optie met F-toetsen',@class = @mainclass\nDECLARE @button_choose nvarchar(128)\nEXEC sp_api_modal_choose @list = N'Predefined,Custom,wert,wertr,wywer,tqyer,twertq,ewrt',@value = @button_choose OUT\nEXEC sp_api_modal_text @button_choose\n\nEXEC sp_api_modal_text @text = N'Kies een optie met beginletter-toetsen (spatie = geen)',@class = @mainclass\nDECLARE @button_choose2 nvarchar(128)\nEXEC sp_api_modal_choose @list = N'Predefined,Custom, wert,wertr, wywer,tqyer, twertq,ewrt2',@value = @button_choose2 OUT,@startkey=NULL\nEXEC sp_api_modal_text @button_choose2\n*/\n\n--RETURN\nDECLARE @button_choose nvarchar(128) = 'Custom'\nIF EXISTS (SELECT * FROM #json_keys)\n\tBEGIN\n\t\tSET @button_choose = 'Predefined'\n\t\tEXEC sp_api_modal_choose @list = N'Predefined,Custom',@value = @button_choose OUT\n\t\tIF @button_choose = N'Predefined'\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text @text = N'Choose a predefined field name / JSON key:',@class = @mainclass\n\t\t\t\tEXEC sp_api_modal_select_table @tmptable=N'#json_keys',@value = @json_key OUT --,@select=1\n\t\t\tEND\n\tEND\n\nIF @button_choose = 'Custom'\n\tBEGIN\n\t\tEXEC sp_api_modal_text @text = N'Choose a custom field name / JSON key:',@class = @mainclass\n\t\tEXEC sp_api_modal_input @name='JSON key', @value= @json_key OUT,@class='' ,@focus=1,@select=1,@inline=1\n\t\tDECLARE @button1 nvarchar(128),@button_text1 nvarchar(128) = 'Validate'\n\t\tEXEC sp_api_modal_button @name='button1',@value = @button_text1, @valueout = @button1 OUT ,@class='btn-primary',@key='Enter'\n\tEND\n\nIF NULLIF(@json_key,'') IS NOT NULL\n\tBEGIN\n\t\t--DECLARE @field_name nvarchar(128) = N'json_' + @json_key,@detail_order INT,@detail_page INT\n\t\tDECLARE @field_name nvarchar(128),@detail_order INT,@detail_page INT\n\t\tSET @field_name = 'json_' + @json_key\n\t\tIF EXISTS (SELECT * FROM api_card_fields WHERE card_id = @card_id AND name = @field_name)\n\t\t\tBEGIN\n\t\t\t\tSET @text = N'\u26a0\ufe0f Field ['+@field_name+'] already exists'\n\t\t\t\tEXEC sp_api_modal_text @text,@class = @mainclass\n\t\t\tEND\n\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tSET @text = N'\u2714\ufe0f Field ['+@field_name+'] will be created'\n\t\t\t\tEXEC sp_api_modal_text @text,@class = @mainclass\n\t\t\t\tDECLARE @button2 nvarchar(128),@button_text2 nvarchar(128) = 'Create Field'\n\t\t\t\tEXEC sp_api_modal_button @name='button2',@value = @button_text2, @valueout = @button2 OUT,@class='btn-danger',@key='Insert'\n\t\t\t\tIF @button2 IS NOT NULL\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tSELECT @detail_order=detail_order,@detail_page = detail_page FROM api_card_fields WHERE card_id = @card_id AND id = @card_field_id\n\t\t\t\t\t\tIF @detail_order IS NULL SET @detail_order = 4\n\t\t\t\t\t\tIF @detail_page IS NULL SET @detail_page = 0\n\t\t\t\t\t\tSET @detail_order-=1\n\t\t\t\t\t\tINSERT api_card_fields (card_id,name,unparsed_sql,sql,detail_order,detail_page)\n\t\t\t\t\t\t\tVALUES(@card_id,@field_name,'dbo.json_get('+QUOTENAME(@json_column)+','\n\t\t\t\t\t\t\t+ dbo.escape_string(@json_key) + ')','dbo.json_get('+QUOTENAME(@json_column)+','\n\t\t\t\t\t\t\t+ dbo.escape_string(@json_key) + ')',@detail_order,@detail_page)\n\t\t\t\t\t\tDECLARE @new_field_id INT = SCOPE_IDENTITY()\n\t\t\t\t\t\tINSERT api_card_field_attributes (field_id,attr_id,unparsed_sql,sql)\n\t\t\t\t\t\tVALUES(@new_field_id,(SELECT id FROM api_attributes WHERE name = 'is_updateable'),'@is_updateable','@is_updateable')\n\t\t\t\t\t\t--EXEC sp_api_populate_card @card_id\n\t\t\t\t\tEND\n\n\t\t\tEND\n/*\n\t\t;WITH nums as (SELECT a = 1 UNION ALL SELECT a=a+1 FROM nums WHERE a < 100)\n\t\t\tSELECT TOP 1 @json_key+=dbo.nv(IIF(a=1,NULL,a)) FROM nums WHERE NOT EXISTS (SELECT * FROM api_card_fields WHERE card_id = @card_id AND name = @json_key+dbo.nv(a))\n\t\t\t\t ORDER BY a\n\t\tEXEC sp_api_modal_text @json_key\n*/\n\tEND\n\n\n\n\n\nIF @button1 IS NULL RETURN\n\nRETURN\n--EXEC sp_api_modal_input @name='Naam',@max=5, @value= @valueout OUT,@focus=1,@select=1 [,@hidden = 1]\n--EXEC sp_api_modal_date @name='Datum'@value= @valueout OUT,@focus=1\n--EXEC sp_api_modal_button @name='Sure',@value = 'Ja', @valueout = @valueout OUT,@class='btn-danger',@key='Enter'\n/*\nSELECT * INTO #jsontable FROM OPENJSON(NULL)\nSET @sql = ';WITH cte as (SELECT JSON FROM #in_use) INSERT INTO #jsontable SELECT * FROM OPENJSON(cte.JSON) JOIN cte ON 1=1'\nEXEC(@sql)\nEXEC sp_api_modal_table @tmptable=N'#jsontable'\n\n\nEXEC sp_api_modal_text @sql\n\n\n--SELECT dataset='table'\n--EXEC(@sql)\nRETURN\n\n\nDECLARE @field_name nvarchar(128) = N'gui_text_',@detail_order INT,@detail_page INT\n;WITH nums as (SELECT a = 1 UNION ALL SELECT a=a+1 FROM nums WHERE a < 100)\n\tSELECT TOP 1 @field_name+=dbo.nv(a) FROM nums WHERE NOT EXISTS (SELECT * FROM api_card_fields WHERE card_id = @card_id AND name = @field_name+dbo.nv(a)) ORDER BY a\n--SELECT @field_name+=dbo.nv(count(*)+1) FROM api_card_fields WHERE card_id = @card_id AND name LIKE @field_name+'%'\nSELECT @detail_order=detail_order,@detail_page = detail_page FROM api_card_fields WHERE card_id = @card_id AND id = @card_field_id\nIF @detail_order IS NULL SET @detail_order = 4\nIF @detail_page IS NULL SET @detail_page = 0\nSET @detail_order-=1\nINSERT api_card_fields (card_id,name,unparsed_sql,sql,detail_order,detail_page)\n\tVALUES(@card_id,@field_name,'''''','''''',@detail_order,@detail_page)\nDECLARE @new_field_id INT = SCOPE_IDENTITY()\nINSERT api_card_field_attributes (field_id,attr_id,unparsed_sql,sql)\nVALUES(@new_field_id,(SELECT id FROM api_attributes WHERE name = 'element'),'''Text''','''Text''')\nEXEC sp_api_populate_card @card_id\n\n*/",
            "action_id": 106,
            "action_name": "sys_gui_insert_json_field",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text 'Calculator',N'h2'\n--DECLARE @calc nvarchar(256) = '0',@button nvarchar(128),@result nvarchar(1000),@sql nvarchar(1000)\n--EXEC sp_api_modal_input_calculator @name='calc',@value = @calc OUT,@focus=1,@select=1\nEXEC sp_api_modal_input_calculator @value = @value OUT\nEXEC sp_api_modal_button @name='@button',@value = 'Bereken',@valueout = @button OUT,@class = 'btn-primary',@key = 'Enter'\nEXEC sp_api_modal_text @value\n/*\nRETURN\n\n\nBEGIN TRY\n\nDECLARE @KeepValues nvarchar(50) = N'%[^0-9+* /().-]%'\n    While PATINDEX(@KeepValues, @calc) > 0\n        Set @calc = Stuff(@calc, PatIndex(@KeepValues, @calc), 1, '')\n\tSET @result = @calc +' = '\n\tSET @sql = N'SET @calc = TRY_CAST((1.0*'+@calc+') as decimal(18,2))'\n\tSET @calc = 0\n\tEXEC sp_executesql @sql,N'@calc decimal(18,2) OUT',@calc OUT\n\tSET @result+= @calc\nEND TRY BEGIN CATCH\n\tSET @result+= 'Err'\n END CATCH\n*/",
            "action_id": 113,
            "action_name": "sys_calculator",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text N'Verstuur een bericht',N'h4 text-muted'\nEXEC sp_api_modal_select @card_name = N'api_user',@value = @to_user_id OUT,@focus = 1\nIF @to_user_id IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_input '@message_text',@message_text OUT,@focus = 1\n\t\tEXEC sp_api_modal_text @to_user_id\n\t\tEXEC sp_api_modal_text @message_text\n\t\tEXEC sp_api_modal_text @pathname\n\t\tEXEC sp_api_modal_text @search\n\t\tEXEC sp_api_modal_button N'@button1','Verstuur',@button OUT ,@class='btn-danger',@key='Enter'\n\tEND",
            "action_id": 124,
            "action_name": "sys_send_message",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--DECLARE @date nvarchar(128) = dbo.workDate()\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n--EXEC sp_api_modal_date @name='Date',@value = @date OUT,@focus = 1,@select=1 -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'Landfreight met afwijkend Transport',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tSELECT *\n\tINTO #TMPLF\n\tfrom @main_db.dbo.Check_LF_Met_Afwijkend_Transport() \n\tEXEC sp_api_modal_table @tmptable=N'#TMPLF',@print=1\n\nEND ",
            "action_id": 131,
            "action_name": "LF met afwijkend transport",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--DECLARE @date nvarchar(128) = dbo.workDate()\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n--EXEC sp_api_modal_date @name='Date',@value = @date OUT,@focus = 1,@select=1 -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'Voorraad Controle',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tSELECT *\n\tINTO #ColliVerkocht\n\tfrom @main_db.dbo.CheckSum_Stock_CTR(0) where sum_ctrAmount<> (stock+delayedIn+DelayedOut)\n\t\tEXEC sp_api_modal_table @tmptable=N'#ColliVerkocht',@print=1\nEND ",
            "action_id": 138,
            "action_name": "voorraad controle",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--DECLARE @date nvarchar(128) = dbo.workDate()\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n--EXEC sp_api_modal_date @name='Date',@value = @date OUT,@focus = 1,@select=1 -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'Vreemde Toewijzingen',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tselect inkoopdatum=vdate, inkoopnummer=VTH, vtd , leverancier=vtdtCounterparty , verkoopdatum=idate, FysiekAantal=LinkAantal * iv_stockmut , klantnaam=itdtCounterparty, verkoop_order =ITH, itd  \n\tINTO #tmptab\n\tfrom code_ivlink \n\t\twhere vdate > idate -- kan niet eerder verkocht dan ingekocht\n\t\torder by vth\n\tEXEC sp_api_modal_table @tmptable=N'#tmptab',@print=1\nEND \n",
            "action_id": 139,
            "action_name": "Vreemde toewijzingen",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_edit_actions @card_id",
            "action_id": 144,
            "action_name": "sys_edit_actions",
            "source_table": "api_actions"
        },
        {
            "sql_source": "update xtenant set forceToTestmodus = case when forceToTestmodus = 1 then 0 else 1 end where id=7",
            "action_id": 150,
            "action_name": "TestModus",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--DECLARE @date nvarchar(128) = dbo.workDate()\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n--EXEC sp_api_modal_date @name='Date',@value = @date OUT,@focus = 1,@select=1 -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'CTR_TOTALS_CONTROLE',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tSELECT *\n\tINTO #TDB\n\tfrom @main_db.dbo.ctr_with_incorrect_totals_iv()\n\t\tEXEC sp_api_modal_table @tmptable=N'#TDB',@print=1\nEND \n",
            "action_id": 151,
            "action_name": "ctr_totals_met_iv_fouten",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--DECLARE @date nvarchar(128) = dbo.workDate()\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n--EXEC sp_api_modal_date @name='Date',@value = @date OUT,@focus = 1,@select=1 -- zoek veld\n\nEXEC sp_api_modal_button @name='button',@value = 'Landfreight met afwijkend Transport',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tSELECT *\n\tINTO #TMPLF\n\tfrom @main_db.dbo.Check_LF_Met_Afwijkend_Transport() \n\tEXEC sp_api_modal_table @tmptable=N'#TMPLF',@print=1\n\nEND \n",
            "action_id": 152,
            "action_name": "LF_Met_Afwijkend_Transport",
            "source_table": "api_actions"
        },
        {
            "sql_source": "execute @main_db.dbo.Repair_ONE_IVLINK ",
            "action_id": 153,
            "action_name": "Repair_One_Overmapping",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--facturen waar de aantallen niet overeenstemmen met de ctr (door toewijsverchillen tijdens facturatie?)\nDECLARE @F1button nvarchar(128)= 'VCheck'\n\nEXEC sp_api_modal_text 'Check Functies:'\n\n\nEXEC sp_api_modal_button @name='button',@value = 'Vreemde facturen',@valueout = @F1button OUT,@class = 'btn-primary',@key = 'F1'\nEXEC sp_api_modal_print\n\nIF @F1button =  'VCheck'\nBEGIN\n\tselect T.TV_CompanyName, T.InvoiceNumber_F ,ctr.id,i.cth_id  as ctr_id,i.rowText , sum(i.colliAmount) AS FA ,ctr.Amount AS CA,ctr.stockMut   \n\tINTO #tmptab\nfrom xinvrow i \n\tinner join xTransactionDetail ctr on i.ctr_id =ctr.id\n\tinner join xInvoiceTotals T on i.Invoice_ID =T.Invoice_ID\n\twhere i.GroupCode =N'BASIS_AGF'\n\tgroup by i.ctr_id,ctr.Amount,ctr.stockMut ,T.TV_CompanyName,T.InvoiceNumber_F ,i.rowText ,ctr.id,i.cth_id\n\thaving sum(i.colliAmount)<>ctr.Amount \n\tEXEC sp_api_modal_table @tmptable=N'#tmptab',@print=1\nEND \n",
            "action_id": 154,
            "action_name": "Vreemde facturen",
            "source_table": "api_actions"
        },
        {
            "sql_source": "if @Transporter_ID is null set @Transporter_ID={[transporteur].ID}\nif @Transporter_ID is null set @Transporter_ID={[CompanyRole].Company_ID}\nif @Transporter_ID is null set @Transporter_ID={[adres].ID}\n\nif @Transporter_ID IS NULL \n\tbegin\n\t\texecute sp_api_modal_Alert N'Deze actie is alleen van toepassing op een bedrijf met een Transportrol'\n\t\texecute sp_api_modal_clear\n\t\treturn;\n\tend\nif @Transporter_ID IS NOT NULL\n\tbegin\n\t\tdeclare @Factor float\n\t\tselect\t@Companyname=companyname\n\t\t\t\t,@Factor =P120_Factor\n\t\t\t\t, @Ftxt=concat(N'Voor transporteur ',companyname,N' is geen vaste euro conversie factor ingesteld bij de CompayRole [TRANSPORT].') \n\t\tfrom Q_xcompanyRole where company_ID=@Transporter_ID and Role_ID= 4 --TRANSPORT\n\t\tif @companyname is null\n\t\t\tbegin\n\t\t\t\texecute sp_api_modal_alert N'De actie kan niet worden uitgevoerd. Deze is alleen voor Transporteurs bedoeld.'\n\t\t\t\texec sp_api_modal_clear;\n\t\t\t\treturn;\n\t\t\tend\t\n\t\t\t\t\n\t\t\n\t\tif @Factor is NULL execute sp_api_modal_alert @FTxt\n\t\telse\n\t\t\tbegin\n\t\t\t\tif @Factor=0 \n\t\t\t\t\tbegin\n\t\t\t\t\t\texecute sp_api_modal_Alert N'GEEN FACTOR'\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\tend\t\n\t\t\t\tif @Factor>1 \n\t\t\t\t\tbegin\n\t\t\t\t\t\texecute sp_api_modal_Alert N'Factor mag nooit groter zijn dan 1'\t\n\t\t\t\t\t\treturn;\n\t\t\t\t\tend\t\n\n\t\t\t\tif @Factor <=1 \n\t\t\t\t\tbegin\n\t\t\t\t\t\tset @ftxt = concat(N'U staat op het punt om het tarief voor Europallets opnieuw in te stellen. Voor ',@Companyname,N' geldt een omrekenfactor van ',@factor,N'. Met ENTER gaat u dit doorvoeren; Gebruik ESC als u wilt stoppen.')\n\t\t\t\t\t\texecute sp_api_modal_Alert @ftxt\n\n\t\t\t\t\t\t--kennelijk mogen we verder\n\t\t\t\t\t\tset @ftxt = concat(N'Bent u zeker? De Europallet tarieven voor ALLE staffels en ALLE Regions worden overschreven voor de transporteur',@companyname,N'. Laatste kans: Gebruik ESC als u wilt stoppen!')\n\t\t\t\t\t\texecute sp_api_modal_Alert @ftxt\n\t\t\t\t\t\t\n\t\t\t\t\t\t--210124\n\t\t\t\t\t\tdeclare @Res01 int\n\t\t\t\t\t\texecute @Res01=@main_db.dbo.Set_P96_For_RegionTariff @Transporter_ID=@Transporter_ID\n\t\t\t\t\t\tif @Res01\t=0 \n\t\t\t\t\t\t\tbegin\n\t\t\t\t\t\t\t\texecute sp_api_modal_Alert N'Het tarief voor de Europallets is opnieuw ingesteld.'\t\t\t\t\t\t\n\t\t\t\t\t\t\t\texecute sp_api_modal_clear\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tend\n\t\t\t\t\t\tif @Res01\t<0 \n\t\t\t\t\t\t\tbegin\n\t\t\t\t\t\t\t\texecute sp_api_modal_Alert N'Tarief wijzigen is niet gelukt.'\t\t\t\t\t\t\n\t\t\t\t\t\t\t\texecute sp_api_modal_clear\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tend\t\t\n\t\t\t\t\tend\t\n\n\t\t\tend\n\t\t\t\n\tend\t\t\n",
            "action_id": 158,
            "action_name": "Overschrijf_P96_Tarief",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_goto @path='/api_errors'\n",
            "action_id": 159,
            "action_name": "Api.Errors",
            "source_table": "api_actions"
        },
        {
            "sql_source": "if @Transporter_ID is null set @Transporter_ID={[transporteur].ID}\nif @Transporter_ID is null set @Transporter_ID={[CompanyRole].Company_ID}\nif @Transporter_ID is null set @Transporter_ID={[adres].ID}\n\nif @Transporter_ID is NOT NULL \n\texecute @R=@main_db.dbo.CopyRegions_From_To_transporter NULL, @Transporter_ID\nif @R=0 execute sp_api_Modal_Alert N'De rayonnen zijn gekopieerd naar deze transporteur.'\t\nexecute sp_api_modal_clear",
            "action_id": 160,
            "action_name": "Copy_Regions",
            "source_table": "api_actions"
        },
        {
            "sql_source": "SELECT @picklist_card_id = picklist_card_id, @card_field_name=name FROM api_card_fields WHERE id = @card_field_id\n\nIF @picklist_card_id IS NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_select @card_id = @picklist_card_id,@value = @picklist_value_id OUT,@focus = 1\n\t\tIF @picklist_value_id IS NOT NULL\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_post @card_name,@card_field_name,@picklist_value_id,@id\n\t\t\t\t--EXEC sp_api_modal_save N'api_card_templates',@id\n\t\t\t\tEXEC sp_api_modal_clear\n\t\t\tEND\n\tEND\n",
            "action_id": 184,
            "action_name": "sys_ajax_picklist",
            "source_table": "api_actions"
        },
        {
            "sql_source": "SELECT * INTO #icl FROM @main_db.dbo.IDEP_ICL WHERE Transactieperiode = '202101' ORDER BY Transactieperiode\nEXEC sp_api_modal_csv @tmptable=N'#icl',@ansi =1,@filename=N'icl_202101.csv',@orderby=N'ORDER BY Transactieperiode'",
            "action_id": 190,
            "action_name": "Naar ICL",
            "source_table": "api_actions"
        },
        {
            "sql_source": "id in (select id from xtenantkey)",
            "action_id": 198,
            "action_name": "TenantCompany",
            "source_table": "api_actions"
        },
        {
            "sql_source": "execute @main_db.dbo.fix_xCTH_Check",
            "action_id": 204,
            "action_name": "fix_CthCheck",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_toast 'Updated!',@seconds=1",
            "action_id": 212,
            "action_name": "sys_refresh",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_broker_request @type='update',@json='{}',@dataout = @dataout OUT,@wait=25000\nEXEC sp_api_toast @dataout\n\n",
            "action_id": 220,
            "action_name": "sys_update_dispatcher",
            "source_table": "api_actions"
        },
        {
            "sql_source": "----------------------------------------------------------------------\n--\tcontext xtransactionheader !!!\n--\t210325 rh\n--\tzet de geselecteerde CTH IDs een dag verder\n----------------------------------------------------------------------\nDECLARE @newDate datetime\nDECLARE @cursor_ids CURSOR,@cid INT, @tekst NVARCHAR(100)\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tSET @TEKST=CONCAT(N'Verschuif de datum voor order ',@cid)\n\t\tEXEC sp_api_toast @TEKST\n\n\t\t------------------single action---------------------------------------------------------------\n\t\tset @newDate=(select transactiondate from xtransactionheader where id=@cid) +1 -- 1 dag er bij\n\t\tif @newDate is not NULL \n\t\t\texecute @main_db.dbo.Set_CTH_plus_LF_Date @CTH = @cid, @Datum = @newDate\n\t\t----------------------------------------------------------------------------------------------\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n--wis als laatste alle markeringen\nEXEC sp_api_modal_select_all_clear \n",
            "action_id": 230,
            "action_name": "Dag_Verder",
            "source_table": "api_actions"
        },
        {
            "sql_source": "----------------------------------------------------------------------\n--\tcontext xtransactionheader !!!\n--\t210325 rh\n--\tzet de geselecteerde CTH IDs een dag verder\n----------------------------------------------------------------------\nDECLARE @newDate datetime\nDECLARE @cursor_ids CURSOR,@cid INT, @tekst NVARCHAR(100)\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tSET @TEKST=CONCAT(N'Verschuif de datum voor order ',@cid)\n\t\tEXEC sp_api_toast @TEKST\n\n\t\t------------------single action---------------------------------------------------------------\n\t\tset @newDate=(select DATEADD(DAY,-1,transactiondate) from xtransactionheader where id=@cid) ---1 -- 1 dag terug!\n\t\t--EXEC sp_api_toast @newDate\n\t\tif @newDate is not NULL \n\t\t\texecute @main_db.dbo.Set_CTH_plus_LF_Date @CTH = @cid, @Datum = @newDate\n\t\t----------------------------------------------------------------------------------------------\n\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n--wis als laatste alle markeringen\nEXEC sp_api_modal_select_all_clear \n",
            "action_id": 235,
            "action_name": "Dag_Terug",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--\t210325RH Wijzig de laadlokatie voor een directsales order.\n--\tDeze code kan draaien in de contexten: CTR1, CTR2, IV1 en IV2\n--------------------------------------------------------------------------------------------------------------------------------------------\nDECLARE @company_id nvarchar(32),@compLoc_id  nvarchar(32),@button nvarchar(128),@new_id nvarchar(32),@goto nvarchar(2000),@search nvarchar(2000)\n\t,@reducer nvarchar(256), @iv_id int, @ctr_id int,@realSupplier_ID int, @newLocation_id int\n\t,@button1 nvarchar(128) = N'Kies Laadlokatie'\n\n--komen we vanaf iv2?\nset @iv_id={[iv2].id}\n--probeer iv1\nif @iv_id is null \n\tset @iv_id={[iv1].id}\n\n\n--als we niet vanaf IV komen, komen we dan misschien vanaf een CTR?\t\t\nif @iv_id is null \n\tbegin\n\t\t--verkoop ctr?\n\t\tset @ctr_id={[ctr2].id}\n\t\t--inkoop ctr?\n\t\tif @ctr_id is null \n\t\t\tset @ctr_id={[ctr1].id}\n\t\t\n\t\t--hopelijk hebben we nu een ctr..\n\t\t--controleer of de (eventuele) ctr volledig is toegewezen met 1 IV\n\t\tif (select count(id) from xivlink where itd=@ctr_id or vtd=@ctr_id) <> 1\n\t\tbegin --fout!\n\t\t\texecute sp_api_modal_alert N'De regel moet volledig zijn toegewezen met 1 IVLINK. Controleer de eerst de toewijzing.'\n\t\t\texecute sp_api_modal_clear\n\t\t\treturn --kappen\n\t\tend\n\n\t\t--we komen hier, dus er bestaat precies 1 IV_ID, dus door.....\n\t\tset @iv_id=(select id from xivlink where itd=@ctr_id or vtd=@ctr_id) \n\tend\n\n--ok, we hebben nu zekerhet iv_id, dus haal de leverancier op van het artikel op uit ivlink...\nset @realSupplier_ID=(select vSupplier_id from @main_db.dbo.code_IVloc where iv_id=@iv_id) --itd=@ctr_id or vtd=@ctr_id)\n\n--controleer of de CTR volledig is toegewezen met 1 IV\nif @realSupplier_ID is null\n\tbegin --fout!\n\t\texecute sp_api_modal_alert N'De leverancier kan niet bepaald worden.'\n\t\texecute sp_api_modal_clear\n\t\treturn --kappen\n\tend\n\n--ok, verder\nset @reducer=concat(N'company_id=',@realSupplier_ID) \n\n--Kies een laadlokatie uit de werklokaties van de leverancier:\nexec sp_api_modal_text N'Typ de gewenste lokatie naam. Begin met een SPATIE om vrij zoeken te activeren...' -- @GB misschien beter een Project/Tenant-setting van maken??\nEXEC sp_api_modal_select @card_name = N'company_locations',@value = @compLoc_id OUT,@focus = 1, @reducer=@reducer, @top=100\nif @compLoc_id > 0\nbegin\n\t--execute sp_api_toast @compLoc_id\n\tselect @newLocation_id = location_id from @main_db.dbo.xcompanyxlocation where id=@compLoc_id\n\tif @newLocation_id >0 \n\t\tbegin\n\t\t\texecute @main_db.dbo.Change_DirectSales_Location @iv_id=@iv_id, @newLoc=@newLocation_id\n\t\t\texecute sp_api_toast N'Instructie ontvangen voor lokatiewijziging....'\n\t\tend\n\t execute sp_api_modal_clear --KLAAR!\nend\n\n",
            "action_id": 240,
            "action_name": "wijzig_directe_laadlokatie",
            "source_table": "api_actions"
        },
        {
            "sql_source": "id in (select ctr_id from @main_db.dbo.overmappedctr1() )",
            "action_id": 248,
            "action_name": "Overmapped_CTR1",
            "source_table": "api_actions"
        },
        {
            "sql_source": "id in (select ctr_id from @main_db.dbo.overmappedctr2() )",
            "action_id": 249,
            "action_name": "Overmapped_CTR2",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_text N'Search'\nEXEC sp_api_modal_input @name='@search', @value= @search OUT,@select=1\nEXEC sp_api_modal_text N'Replace'\nEXEC sp_api_modal_input @name='@replace', @value= @replace OUT,@select=1\nEXEC sp_api_modal_text N'Add comment at bottom'\nEXEC sp_api_modal_input @name='@comment', @value= @comment OUT,@select=1\nEXEC sp_api_modal_button @name='@button',@value = 'Search', @valueout = @button OUT,@class='btn-tracy',@key='Enter'\nEXEC sp_api_modal_button @name='@button',@value = 'Replace', @valueout = @button OUT,@class='btn-danger',@key='Insert'\nDECLARE @cursor CURSOR\n,@name nvarchar(128)\n,@def nvarchar(max)\n,@otype char(2)='V'\nSET @cursor = CURSOR FOR\n\tSELECT TOP 2 name =CONCAT(o.name,' -','-> ',o.type_desc COLLATE SQL_Latin1_General_CP1_CI_AS,' - ',o.type COLLATE SQL_Latin1_General_CP1_CI_AS),m.definition AS Object_Name\n\tFROM @main_db.sys.sql_modules m \n\tINNER JOIN @main_db.sys.objects o \n\tON m.object_id=o.object_id\n\tWHERE m.definition Like '%'+@search+'%' AND o.type IN(SELECT * FROM string_split(@otype,','))\n\tORDER BY o.name\n--GROUP BY o.name\nOPEN @cursor;\nFETCH NEXT FROM @cursor INTO @name,@def\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tIF @button = 'Search'\n\t\t\tBEGIN\n\t\t\t\tEXEC sp_api_modal_text @name,N'h4 text-muted'\n\t\t\t\tEXEC sp_api_modal_text @def,N'code',@highlight=@search\n\t\t\t\tRETURN\n\t\t\tEND\n\t\tELSE\n\t\t\tBEGIN\n\t\t\t\tSET @def = REPLACE(@def,@search,@replace)+IIF(@comment IS NULL,'',CHAR(10)+CHAR(13)+@comment)\n\t\t\t\tSET @def = REPLACE(@def,N'CREATE VIEW',N'ALTER VIEW')\n\t\t\t\t--SET @tmpsql = N'USE @main_db;'+CHAR(10)+CHAR(13)+@def\n\t\t\t\tEXEC sp_executesql N'USE @main_db;EXEC(@def);',N'@def nvarchar(max)',@def\n\t\t\t\t--EXEC(@tmpsql);\n\t\t\t\t--EXEC sp_api_modal_text @name,N'h4 text-danger'\n\t\t\t\t--EXEC sp_api_modal_text @tmpsql,N'code',@highlight=@replace\n\t\t\t\tSET @button = 'Search'\n\t\t\tEND\n\t\tFETCH NEXT FROM @cursor INTO @name,@def\n\tEND\nCLOSE @cursor;\nDEALLOCATE @cursor;\n",
            "action_id": 253,
            "action_name": "sys_views_search_and_replace",
            "source_table": "api_actions"
        },
        {
            "sql_source": "-----Context CTH-----\n--SET CHECKED & MAP !\n---------------------\n--210422 SP MAP Aangepast, er worden geen regels met delayed geselecteerd om te mappen..\n\nDECLARE @cursor_ids CURSOR,@cid INT, @tekst NVARCHAR(100),@sqltask nvarchar(max)\nSET @cursor_ids = CURSOR LOCAL FAST_FORWARD FOR SELECT value FROM string_split(@ids,',')\nOPEN @cursor_ids;\nFETCH NEXT FROM @cursor_ids INTO @cid\nWHILE @@FETCH_STATUS = 0\n\tBEGIN\n\t\tSET @TEKST=CONCAT(N'Toewijzen order ',@cid)\n\t\tEXEC sp_api_toast @TEKST\n\t\t/*\n\t\t------------------single action---------------------------------------------------\n\t\texec @main_db.dbo.SP_CURSED_MAPPER_CTH @CTH_ID =@cid ,@MAPINKOOP =1,@MAPVERKOOP =1\n\t\t--zet tevens landfreight op checked\n\t\texec @main_db.dbo.SP_CURS_SetChecked_CTH @cid\n\t\t--@onlySameDay =1 --210324 VGI alleen dezelfde dag..\n\t\t--@sameDayOrOlder = 1 --210324 VGI alleen dezelfde dag of eerder..\n\t\t----------------------------------------------------------------------------------\n\t\t*/\n\t\tSET @sqltask = CONCAT(N'\n\t\texec @main_db.dbo.SP_CURSED_MAPPER_CTH @CTH_ID =',@cid,' ,@MAPINKOOP =1,@MAPVERKOOP =1, @sameDayOrOlder =1\n\t\texec @main_db.dbo.SP_CURS_SetChecked_CTH ',@cid)\n\t\tEXEC sp_api_add_sql_task @sql=@sqltask,@description=@TEKST --N'Verstuur facturen'\n\t\tFETCH NEXT FROM @cursor_ids INTO @cid\n\tEND\nCLOSE @cursor_ids;\nDEALLOCATE @cursor_ids;\n\n--wis als laatste alle markeringen\nEXEC sp_api_modal_select_all_clear \n\n\n\n\n",
            "action_id": 254,
            "action_name": "MAP_ALL",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_toggle_isam_search",
            "action_id": 255,
            "action_name": "sys_toggle_isam_search",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_view_performance @card_id",
            "action_id": 256,
            "action_name": "sys_view_performance",
            "source_table": "api_actions"
        },
        {
            "sql_source": "declare @j nvarchar(512)\nEXEC tracy_translate.dbo.translate N'Eet smakelijk',N'NL',N'FR',@J OUT\nexec sp_api_modal_alert @j",
            "action_id": 257,
            "action_name": "eet smakelijk",
            "source_table": "api_actions"
        },
        {
            "sql_source": "if @ID=@IDS execute @main_db.dbo.FlashxStock @ID -- alleen de geselecteerde regel\nif @ID<>@IDS execute @main_db.dbo.FlashxStock 0 -- alles",
            "action_id": 258,
            "action_name": "Flash_Stock",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_file_upload @card_name, @user_name, @path, @id, @name ,@mimetype ,@modified ,@filesize ,@description",
            "action_id": 262,
            "action_name": "sys_file_upload",
            "source_table": "api_actions"
        },
        {
            "sql_source": "SET @alert_text=CONCAT('Eerst dit, dan: ',@alert_text,@card_name)\nif @sub_Text is NULL Set @Sub_Text=N'TEST123'\nEXEC sp_api_modal_alert @alert_text,@sub_text\nEXEC sp_api_email @to='rick@tracy.nu',@subject=@sub_text,@body=@alert_text\n",
            "action_id": 263,
            "action_name": "#alert",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @menu_id nvarchar(max),@reducer nvarchar(max)\nEXEC sp_api_modal_text N'Quick menu',N'h1 font-weight-light text-primary'\nSET @reducer=N'in_main_menu = 1'\nEXEC sp_api_modal_select @card_name=N'menu',@value = @menu_id OUT,@focus=1,@placeholder=N'Zoek...',@no_isam=1\n\t,@modalRouteSql = N'''/'' + name'\n\t--,@reducer=@reducer\n\nIF @path='/' EXEC sp_api_modal_button @name='@button',@value='Home',@valueout=NULL,@class='btn-tracy',@key='Escape'\n\nIF @menu_id IS NULL RETURN\nEXEC sp_api_modal_clear\nSELECT @path = CONCAT('/',name) FROM api_card WHERE id = @menu_id\nEXEC sp_api_modal_pathname @path,NULL\n",
            "action_id": 264,
            "action_name": "#sys_quick_menu",
            "source_table": "api_actions"
        },
        {
            "sql_source": "declare @Mess nvarchar(200)\ndeclare @current nvarchar(50)\ndeclare @isOK bit\n\n\tbegin\n\t\t--verzet de fase als dat kan\n\t\texecute @main_db.dbo.Fase_Guard @ID=@ID ,@Fase= N'openPurchase',@StateOK=@isOK OUT,@Context =N'CTH' ,@CurrentFase=@Current OUT ,@Message=@Mess OUT\n\t\tif @isOK=1 execute sp_api_toast N'OKe'\n\t\tif @isOK =0 execute sp_api_toast @Mess\n\tend\n",
            "action_id": 265,
            "action_name": "reOpenCTH1",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_add_column @basetable,@card_id",
            "action_id": 266,
            "action_name": "sys_add_column",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_add_table",
            "action_id": 267,
            "action_name": "sys_add_table",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_file_download @card_name,@id,@file_id",
            "action_id": 268,
            "action_name": "sys_file_download",
            "source_table": "api_actions"
        },
        {
            "sql_source": "declare @json nvarchar(2048)\nexec sp_api_places_search @Search=N'abc 666 poeldijk',@json=@json OUT\nexec sp_api_modal_Alert @json",
            "action_id": 269,
            "action_name": "test adres",
            "source_table": "api_actions"
        },
        {
            "sql_source": "/*\n-- GENEREER EEN INKOOP EN KOSTENREGISTRATIE --\nselect * from lfctr_breakdown(11637,0)\n\n*/\nexec @main_db.dbo.create_demo_1 ",
            "action_id": 270,
            "action_name": "test_inkoop_en_kosten",
            "source_table": "api_actions"
        },
        {
            "sql_source": "--\t-----------------------------------------------------------------------------\n--\tinstant_report: BREAKDOWN_CTH1\n--\ttoont een overzicht van de partijkosten en verkoopopbrengsten\n--\tpre declare: @buttonmore,@buttonmore2, @mt\n--\t-----------------------------------------------------------------------------\nEXEC sp_api_modal_modal @class=N'w100',@printStyle=N'font-size:70%',@landscape=1\n\ndeclare @CTHID int={[inkoop].id}\nif @CTHID is null set @CTHID={[verkoop].id}\n\nexec sp_api_toast N'kosten'\n\n--exec @main_db.dbo.create_demo_1 \nif @CTHID IS NULL\n\tbegin\n\t\texecute sp_api_modal_alert_new N'Breakdown heeft een Inkoop of verkoop nodig.'\n\t\treturn;-- afkappen\n\tend\n--210830 totalen bovenaan even tonen in EURO!\ndeclare @LFC float=--(\tselect sum(isnull(nullif(cost,0),0)*isnull(nullif(xrate,0),1)) from @main_db.dbo.xCostReg_ALL_CTH(@CTHID) where landfreight_id>0)\n\t\t\t\t\t(\tselect sum(eurbedrag) from @main_db.dbo.xCostReg_ALL_CTH(@CTHID) where landfreight_id>0)\nif @lfc is not null\n\tbegin\n\t\tdeclare @lfctext nvarchar(512)=concat('Totaal op Landfreight geboekt: ',@lfc)\t\n\t\texec sp_api_modal_text @lfctext\n\tend\n\ndeclare @CTHC float=(\tselect sum(isnull(nullif(cost,0),0)*isnull(nullif(xrate,0),1)) from xcostregistration where transaction_id=@CTHID) \nif @CTHC is not null\n\tbegin\n\t\tdeclare @CTHCtext nvarchar(512)=concat('Totaal op CTH geboekt: ',@cthc)\t\n\t\texec sp_api_modal_text @CTHCtext\n\tend\n\ndeclare @CTRC float=(\tselect sum(isnull(nullif(cost,0),0)*isnull(nullif(xrate,0),1)) from xcostregistration \nwhere ctr_id in (select id from xtransactiondetail where transactionheader_id=@CTHID) )\nif @CTRC is not null\n\tbegin\n\t\tdeclare @CTRCtext nvarchar(512)=concat('Totaal op CTR(s) geboekt: ',@ctrc)\t\n\t\texec sp_api_modal_text @CTRCtext\n\tend\n\t\n--SELECT --lfctr_ctr_part,C_Part_CTR_CTH,\nselect ctr_id,lfctr_colli as [lfctrColli@:2],rpCTH_Costs_P as [CTHP@:2],lfctr_Pal,cth_PCost as CTH_P,LFCTRcosts_C as [CTHC@:2]\n, CTH_CCost as CTH_C,ctr_dirkosten * lfctr_ctr_part as [CTRDIRECT@:2],LFP as [LFP@:2]\n--,P_Part_LFCTR_LF as lfctr_lf_deel@ -- LFCTR deel van de LF (optellen per LF moet 1 zijn)\n, CP_CostLF as LF_P, lfctr_ccc as colPrijs, Lfctr_CCPP ,lfctr_ColliKosten as colTot, [regeltotaal@:2]=lfctr_colli * lfctr_collikosten\n--, ctr_totalCosts_C\n--,isnull(cth_PCost,0)+ isnull(CTH_CCost,0) as CTH\n--,CTR_COL\n--,ctr_cth_Cost   \nINTO #BreakDown FROM @main_db.dbo.lfctr_breakdown(@CTHID,0)          \n\nexec sp_api_modal_print -- zet de print button boven (=BROWSER CTRL-P)\nset @mt=concat(N'Dit is de kostenverdeling van de geboekte kosten op partij ',{[inkoop].Lotnumber})\nexec sp_api_modal_text @mt , @class='h2', @PrintOnly=1\nEXEC sp_api_modal_table @tmptable=N'#BreakDown', @PRINT=1\n\n\n--MORE? PREDECLARE @buttonmore\nIF @buttonmore IS NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'',N'm-4'\n\t\tEXEC sp_api_modal_button @name='@buttonmore',@value = 'Meer info...', @valueout = @buttonmore OUT,@class='btn-tracy',@key='PageDown'\n\t\tRETURN\n\tEND\n\nselect costReg_ID,suppliercode,costdate, eurbedrag as [Eurobedrag@:2], [description] \n\t\t\t,invoicenumber,gl_number,dateinvoice --inv en gl er bij 211125RH\nINTO #CostReg FROM @main_db.dbo.xCostReg_ALL_CTH(@CTHID)          \nexec sp_api_modal_text N'Geregistreerde kosten:' , @class='h5', @Print=1\nEXEC sp_api_modal_table @tmptable=N'#costReg', @PRINT=1\n\nselect ctr_id, [aantal@]=sum(lfctr_col), [niet_ingedeeld@:2]=sum([0]), [agf@:2]=sum([1]), [rabat@:2]=sum([2]), [transport@:2]=sum([3]),\n\t\t\t\t\t\t[overig@:2]=sum([4]), [sum5@:2]=sum([5]) \n\tinto #piv1\tfrom piv_xcostregistration where cth_id=@CTHID group by ctr_id\nexec sp_api_modal_text N'Kosten kolommen:' , @class='h5', @Print=1\nEXEC sp_api_modal_table @tmptable=N'#piv1', @PRINT=1\n\n\n--MORE? PREDECLARE @buttonmore2 VERKOOP OPBRENGST ( ALLEEN BIJ INKOOPBREAKDOWN )\nIF @buttonmore2 IS NULL AND {[inkoop].id} is NOT NULL\n\tBEGIN\n\t\tEXEC sp_api_modal_text N'',N'm-4'\n\t\tEXEC sp_api_modal_button @name='@buttonmore2',@value = 'Toon de verkoopopbrengst', @valueout = @buttonmore OUT,@class='btn-tracy',@key='PageDown'\n\t\tRETURN\n\tEND\n\n--210901 Toon verkoop opbrengst en kosten voor partijuitmelding\n/*\nselect * from SalesResultCTH1(13237)\n*/\nselect lotrefrowid as [ctr1~col-sm-1-2],(select D from @main_db.dbo.ctr_description_prod(lotrefrowid)) as [prod*]\n\t,(select D from @main_db.dbo.ctr_description(lotrefrowid)) as [artikel], TV_CODE as Customer,cth2 as [order~col-sm-1-2],\tctr_id as [ctr2~col-sm-1-2]\n\t,\tLFDate as [Date~col-sm-1],\tcolli_gefactureerd as [Colli@~col-sm-1-2],\tgemiddeld as [SalesCol:2~col-sm-1-2],\tomzet as [NetSales@:2~col-sm-1]\n\t,\tbookedcosts as [SalesCosts@:2~col-sm-1]\n\t, bookedcosts/nullif(colli_gefactureerd,0) as [CostCol:2~col-sm-1-2]\n\t,isnull(gemiddeld,0)-isnull(bookedcosts/nullif(colli_gefactureerd,0),0) as [NETT_COL:2]\nINTO #SalesRes FROM @main_db.dbo.[RowResultEUR_CTH1_perCTR2](@CTHID) --order by lotrefrowid\nexec sp_api_modal_text N'Geregistreerde verkoop opbrengsten:' , @class='h5', @Print=1\nEXEC sp_api_modal_table @tmptable=N'#SalesRes', @PRINT=1,@orderby='ORDER BY 1'-- maak alles het printbaar \n--@PRINTONLY=1 (hidden op scherm, maar wel op printer)--,@orderby=N'ORDER BY [wawa*],lalaDescription ASC'\n\n-- PARTIJ-RESULTAAT\nselect CTR1_ID,\tleverancier,\tklant,CTH2_ID,\tCTR2_ID, Orderdatum,\t\n\t\tAantal as [Aantal@]\n\t\t,-1 * I_PRIJS as [I_PRIJS@:2],\t-1 * (I_RABAT+\tI_TRANSP+\tI_OVERIG) as [I_KOST@:2]\n\t\t,-1 * V_PRIJS as [V_PRIJS@:2],\t-1 * V_RABAT as [V_RABAT@:2],\t-1* V_TRANSP as [V_TRANSP@:2],\t-1 * V_OVERIG as [V_OVERIG@:2]--\tV_AMT_CTR\tI_AMT_CTR\n\t\t, rowresult as [Resultaat@:2]\n\tinto #ivresult\n\tFROM @main_db.dbo.[IV_RESULT] where CTH1_ID =@CTHID\nexec sp_api_modal_text N'Partij resultaatregels :' , @class='h5', @Print=1\nEXEC sp_api_modal_table @tmptable=N'#ivresult', @PRINT=1\n\n\n",
            "action_id": 271,
            "action_name": "ctr_breakdown",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_api_modal_alert N'Lock Layouts, prevent master update',N'This will lock all list, form en handler layouts (list_order/detail_order/handler_order) from all cards. Unlocking per card can be done in \"Model differences\"'\nEXEC sp_sys_card_lock_layouts",
            "action_id": 272,
            "action_name": "sys_card_lock_layouts",
            "source_table": "api_actions"
        },
        {
            "sql_source": "DECLARE @rawdata varbinary(max) = (SELECT * FROM OPENROWSET(BULK 'C:\\Windows\\explorer.exe', SINGLE_BLOB) as f)\n\t\tEXEC sp_api_modal_download @rawdata=@rawdata,@filename=N'abc.zip'",
            "action_id": 273,
            "action_name": "file_from_host",
            "source_table": "api_actions"
        },
        {
            "sql_source": "----------------------------------------------------------------------------\n--\tfunction: \t\tir_transit\n--\tdescription:\ttoon het actuele douanesaldo en zorg dat dit geprint kan worden\n--\tpre declare:\t@Mailbutton\n----------------------------------------------------------------------------\nexec sp_api_modal_text N'Actueel douanesaldo'\nselect *  INTO #IR_TransitoVoorraad from @main_db.dbo.DouaneSaldo_ctr1(0,0) \nEXEC sp_api_modal_table @tmptable=N'#IR_TransitoVoorraad' ,@print=1\n\n--mailen??\nEXEC sp_api_modal_button @name='@mailbutton',@value = 'Mail', @valueout = @Mailbutton OUT,@class='btn-warning',@key='M'\nif @Mailbutton='Mail'\nbegin\n\n\tDECLARE @subject nvarchar(255) = N'Tracy actual Transito stock'\n\tDECLARE @body nvarchar(max),@html nvarchar(max),@list_select nvarchar(max),@list_select_cache nvarchar(max)\n\tSELECT @list_select_cache = list_select_cache FROM api_card WHERE id = @card_id\n\tSET @list_select=N'\n\t\tSELECT * INTO #tmptable FROM @main_db.dbo.DouaneSaldo_ctr1(0,0) tbl\n\t\tEXEC sp_api_html_table N''#tmptable'',N''ORDER BY 2'',@html OUT'\n\tEXEC sp_executesql @list_select,N'@html nvarchar(max) OUT',@html OUT\n\n\n\t--wrap er een table omheen: / *\n\tSET @html = N'<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n\t<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t <head>\n\t  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t  <title>Demystifying Email Design</title>\n\t  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n\t</head><body style=\"margin: 0; padding: 0;\">\n\t <table border=\"3\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n\t  <tr>\n\t   <td><h3>Export</h3>'+ @html +N'</td>\n\t  </tr>\n\t </table>\n\t</body></html>'\n\t--* /\n\n\tEXEC sp_api_email @user,@subject,@body = N'Geen html support',@html = @html -- html in @HTML !\n\tEXEC sp_api_toast N'Sent mail to:'\n\tEXEC sp_api_toast @user\n\texec sp_api_modal_clear-- afkappen na mailen..\n\nend",
            "action_id": 274,
            "action_name": "IR_Transit",
            "source_table": "api_actions"
        },
        {
            "sql_source": "declare @main_text nvarchar(512) = concat(N'You''re at ', @hostname, ' ', '@main_db')\nexec sp_api_modal_alert_new @main_text",
            "action_id": 275,
            "action_name": "main_db",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_parent_cards @card_id",
            "action_id": 276,
            "action_name": "sys_parent_cards",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_convert_to_type_table @card_id",
            "action_id": 277,
            "action_name": "sys_convert_to_type_table",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_edit_attributes @card_id",
            "action_id": 278,
            "action_name": "sys_edit_attributes",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_list_classes @card_id = @card_id , @is_form = @is_form",
            "action_id": 279,
            "action_name": "sys_list_classes",
            "source_table": "api_actions"
        },
        {
            "sql_source": "EXEC sp_sys_insert_todo @card_name,@user_name",
            "action_id": 280,
            "action_name": "sys_insert_todo",
            "source_table": "api_actions"
        }
    ]
}